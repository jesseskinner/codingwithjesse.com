var GeoLocation={location:!1,get:function(a){if(this.location)a(this.location);else{this.add_script();var b=setInterval(function(){GeoLocation.location&&(clearInterval(b),a(GeoLocation.location))},500)}},add_script:function(){if(!this.script_added){this.script_added=!0;var a=document.createElement("script");a.type="text/javascript";a.src="http://j.maxmind.com/app/geoip.js";a.defer=!0;$("head")[0].appendChild(a);var b=setInterval(function(){"function"==typeof geoip_region_name&&(clearInterval(b),GeoLocation.location=
{geoip_country_code:geoip_country_code(),geoip_country_name:geoip_country_name(),geoip_city:geoip_city(),geoip_region:geoip_region(),geoip_region_name:geoip_region_name(),geoip_latitude:geoip_latitude(),geoip_longitude:geoip_longitude(),geoip_postal_code:geoip_postal_code()})},500)}}},AjaxUser={call:function(a,b,c,d,f){$.ajax({url:"/ajax/?method=user."+a,data:b,dataType:f||"json",type:"POST",success:c&&function(a){d&&!a?d(a):c(a)},error:d})},start:function(a,b){this.call("prep");this.call("start",
{},a,b)}};pbUser=function(a){this.accounts={};this.favourites=[];this.owner_accounts={};this.active={};for(key in a)this[key]=a[key];window.tagCollection&&(this.tags=new tagCollection)};
pbUser.prototype={id:0,hub:0,username:"Guest",hubname:"",sm_bw_photo:"",accounts:!1,favourites:!1,tags:!1,ownerisviewer:!0,owner_username:"",owner_accounts:!1,loadingProfile:!1,owner_extids:function(a){a=[];var b={},c;for(c in this.accounts)for(var d in this.accounts[c]){var f=this.accounts[c][d];1==f.shared&&!b[f.ext_id]&&(a[a.length]=f.ext_id,b[f.ext_id]=!0)}return a},shared_keywords:function(a){var b="";$.each(this.accounts[a],function(a,d){1==d.shared&&$.each(d.owner,function(a,d){if(d.data){var c=
parseJSON(d.data);c.assigned&&(b+=c.assigned.join(" ").replace(/[\s,]+/g," "))}})});return b},start:function(a){var b=this;b.loadingProfile=!0;window.active_start?(this.start_data(window.active_start),a&&a(window.active_start)):AjaxUser.start(function(c){window.active_start=c;b.start_data(c);a&&a(window.active_start)},function(){Popup.close(null,"#loader");b.loadingProfile=!1;alert("Error in loading the user profile. Twitter could be not responding at the moment")})},start_data:function(a){window.EC&&
Popup.close(null,"#loader");this.loadingProfile=!1;this.tags&&this.initTags(a.tags);this.set_user_data(a);"in"!=window.PB_APP_NAME&&this.get_fb_pages();window.prefs&&a.prefs&&(window.user_prefs=new prefs(a.prefs))},set_user_data:function(a){this.id=a.id;this.data=a;this.accounts=a.accounts;window.active_account?this.active=window.active_account:this.set_active_account();$(document).trigger("login",this)},set_active_account:function(){var a,b;for(a in this.accounts)for(b in this.accounts[a])if("undefined"!==
typeof this.accounts[a][b].loginID){this.active=this.accounts[a][b];return}},get:function(a,b,c,d){var f=[],e="";this.accounts[a]&&$.each(this.accounts[a],function(a,h){if(!d||!parseInt(h.shared))c?parseInt(h.ext_id)==parseInt(c)&&(e="undefined"!=typeof h[b]?h[b]:""):"undefined"!=typeof h[b]&&f.push(h[b])});return c?e:f},build_avatars_list:function(a,b){function c(a){$.each(a,function(a,c){"object"!=typeof b?parseInt(c.ext_id)==parseInt(b)&&"undefined"!=typeof c[g]&&(e=!0):-1<$.inArray(c.ext_id,b)&&
"undefined"!=typeof c[g]&&(e=!0);parseInt(c.status)&&("email"!=c.source&&c.source)&&(d+='<img src="'+(c.avatar_url?c.avatar_url:f)+'" class="inline_avatar '+(e?"fadein":"fadeout")+'" title="'+c.source+"/"+c.username+'" extid="'+c.ext_id+'" onerror="this.src=\''+f+"'\"/>");e=!1})}var d="",f="/templates/iloli/images/comms_icon_friend.png",e=!1,g="avatar_url";"all"==a?$.each(this.accounts,function(a,b){c(b)}):this.accounts[a]&&c(this.accounts[a]);return d},hasTwPerm:function(a,b){$.ajax({url:"/ajax/?method=user.hasTwPerm",
dataType:"json",type:"POST",data:{perm:a,callbackUrl:window.location.href},success:function(a){a&&(a.pass?b&&b():window.confirm("You are about to get extra permissions from Twitter. Do you want to do this now?")&&(window.location=a.url))}})},has_account:function(a){return 0>=this.id?!1:!a||"all"==a||"any"==a?!0:!this.accounts||(!this.accounts[a]||!this.accounts[a].length)||1==this.accounts[a].length&&0==this.accounts[a][0].status?!1:!0},require_account:function(a){debug.log("call to has_account",
a);if(this.has_account(a))return!0;window.Popup?this.id&&a?Popup.open({type:"add_account",source:a}):Popup.open({type:"not_logged"}):window.tools&&window.login_fb_external&&tools.isWidget()&&"facebook"==a?window.login_fb_external():window.launch&&("twitter"==a&&(launch.addLoggingInAlert(),launch.oauth_login("twitter",!0,"http://"+window.location.host)),window.launch.add_ids());return!1},get_usernames:function(){var a={},b;for(b in this.accounts)for(var c in this.accounts[b]){var d=this.accounts[b][c];
a[d.ext_id]=d.username}return a},get_accounts_index:function(){var a={},b;for(b in this.accounts)for(var c in this.accounts[b]){var d=this.accounts[b][c];a[d.ext_id+""]=d}return a},postable_accounts:function(a,b,c){var d=this.get_accounts_index();c||(c=[],this.active&&this.active.ext_id&&(c=[this.active.ext_id]));var f={twitter:{plain_name:"twitter",label:"Twitter",icon_name:"twitter",action:"status"},facebook_status:{plain_name:"facebook",label:"Facebook status",icon_name:"facebook",action:"status"},
linkedin:{plain_name:"linkedin",sys_name:"linkedin",label:"LinkedIn",icon_name:"linkedin",action:"comment"}},e=[],g,h;for(g in f){h=f[g];var l=this.get(h.plain_name,"ext_id"),q="/templates/iloli/images/icons/"+h.icon_name+"."+($.browser.msie?"jpg":"png");if(!(a&&-1!=$.inArray(h.plain_name,a)))if(l.length){var r=window.tools&&tools.isWidget();$.each(l,function(a,b){var f=-1!==$.inArray(b,c)&&!r,g=h.label;b&&d[b]&&(g=("twitter"==h.label?"@":"")+d[b].username+" ("+h.label+")");e.push({label:g,checked:f,
name:h.plain_name,icon_url:q,data:h,account:d[b],action:h.action,extid:b})})}else e.push({label:h.label,icon_url:q,name:h.plain_name,data:h,action:h.action,extid:""})}if(b){b=this.get("facebook","pages")||[];var k=[];$.each(b,function(a,b){k=k.concat(b)});$.each(k,function(a,b){e.push({label:b.name,name:(b.asAdmin?"pageadmin":"pageid")+"_"+b.page_id,icon_url:"/templates/iloli/images/icons/facebook.png",extra:!0,data:b,action:"status_update",extid:""})})}return e},get_fb_pages:function(){var a=this;
$.ajax({url:"/ajax/?method=fb.get_fanpages",dataType:"json",type:"POST",success:function(b){b&&$.each(b,function(b,d){$.each(a.accounts.facebook,function(a,e){0!=e.status&&parseInt(e.foreign_uid)==b&&(e.pages=d)})});$(function(){$(document).trigger("login")})}})},client_accounts:function(){var a=[],b;for(b in this.accounts)for(var c in this.accounts[b]){var d=this.accounts[b][c];d.clients&&d.clients.length&&(a[a.length]=d)}return a},isDraftOnly:function(a){var b=0,c;for(c in this.accounts.twitter){var d=
this.accounts.twitter[c];d.ext_id==a&&d.owner&&(console.log("found:",d),d.owner[0].data&&(d=parseJSON(d.owner[0].data),"undefined"!=typeof d.draftonly&&(b=d.draftonly)))}return b},initTags:function(a){"undefined"!=typeof a&&0<a.length&&this.tags.addTags(a)},add_tag:function(a,b,c,d){if(this.data&&this.data.tags){for(var f=this.data.tags.length-1;0<=f;f--)if(this.data.tags[f].tag_id==b)return;this.data.tags.push({priv:d,"private":d,tag_id:b,text:a,type:c})}}};
$(function(){window.logged_usr&&logged_usr.id&&logged_usr.start()});
var Trial={days_left:30,hasInvite:0,isPremium:0,trialID:0,kwd_history:[],FREE_SEARCHES:9,user_location:"",init:function(){var a=$.cookie("kwd_history");a&&(this.kwd_history=parseJSON(a));this.updateSearchesLeft();1E5==this.days_left&&(this.isPremium=1);logged_usr.id&&($("#trial_left_days").text(this.days_left),1>this.isPremium&&(1==this.hasInvite?0<this.days_left?Popup.open({type:"trial_update"}):Popup.open({type:"trial_expired"}):1>this.hasInvite&&Popup.open({type:"trial_expired"})))},canSearch:function(){var a=
$.cookie("kwd_history");a&&(this.kwd_history=parseJSON(a));this.updateSearchesLeft();if(1>this.isPremium)if(logged_usr.id)switch(this.hasInvite){case -1:case 0:return Popup.open({type:"trial_expired"}),!1;case 1:if(0>=this.days_left)return Popup.open({type:"trial_expired"}),!1}else switch(this.hasInvite){case -1:case 0:if(this.kwd_history.length<=this.FREE_SEARCHES)Popup.open({type:"free_trial_update"});else return Popup.open({type:"trial_expired"}),!1}return!0},updateSearchesLeft:function(){if(this.hasInvite)$("#search_left").hide();
else{$("#search_left").show();var a=Math.max(0,this.FREE_SEARCHES-this.kwd_history.length);$("#search_left_count").text(a)}}},Session={check:function(){var a=this;window.top==window&&(a.sessionT&&clearTimeout(a.sessionT),a.sessionA&&a.sessionA.abort(),a.sessionT=setTimeout(function(){logged_usr?(console.log("checking session"),logged_usr.id&&(a.sessionA=$.ajax({url:"/ajax/?method=utility.isLogged",dataType:"json",data:{uid:logged_usr.id},type:"POST",success:function(b){0==b?(alert("Someone might be using this account. Please login again."),
window.location.href=window.location.href):a.check()}}))):a.check()},15E3))}};$(function(){});
var Popup={regSubmit:!1,init:function(){var a=this;a.init_login();!1===$("body").is(".unkredible")&&Popup.init_kredible();$(".info-buttons #login-close,  .info-buttons #subscribe-close").live("click",function(){a.close()});$("#log_out .cancel,#kr_logout .cancel, #perks_logout .cancel, #trial_update .get-started, #confrim-yes, #confrim-no").live("click",function(){a.close()});$("#rs_form_overlay, #rs_result_overlay, #va_home_overlay, #ec_home_overlay, #gr_home_overlay, #va_fb_help_overlay").live("click",function(){a.close()});
$(".kr_popup_close, .kr-verify-close, .kr-pop-close, .popup-close, .kr_close_link").live("click",function(){a.close()});$("#post_effect #post_effect_close").live("click",function(){a.closeTweetEffect()});$(".post-effect").live("click",function(){var a=$(this).closest(".post_container").data("data");Popup.openTweetEffect(a.fmsgid,a)});$("#closeChart").live("click",function(){Popup.closeBitlyChart()});$("#close_button, .close").live("click",function(){if(window.Influence){if($("#ifr_popup_view").find("#email_verify_popup")&&
(a.close(),1==window.KR_LOG_COUNT&&($("#ifr_popup_view").find("#email_verify_popup").remove(),window.verifiedUser=1,InfluenceViral.init())),$("#ifr_popup_view").find("#dotkred-identity-popup")||$("#ifr_popup_view").find("#dotkred-community-popup")||$("#ifr_popup_view").find("#dotkred-payment-popup")||$("#ifr_popup_view").find("#dotkred-share-popup"))a.close(),$.cookie("netkred_flow_cancelled","1"),$.ajax({type:"post",url:"/ajax/?method=utility.set_user_flag",async:!1,data:{flagname:"netkred_sign_flow",
flagval:"0"}})}else a.close()});$("a.contactus, .contactus").live("click",function(){Popup.open({type:"cross_app_contact"});return!1});$("#contactSend").live("click",function(){var a=$("#cross_app_contact"),c=$(this).parents("form"),d=$(this),f=!0;c.find(":input.required").each(function(){""==$(this).val()&&(f=!1,$(this).addClass("missing"),$(this).change(function(){$(this).removeClass("missing");$(this).unbind("change")}))});if(!1===f)return a.find(".msg").html('<p class="alert">Please fill in all the required fields</p>'),
!1;c=c.serialize();$.post("/ajax/?method=utility.contactUs",c,function(c){var f="";c?(f="<p>Thank you for your interest. We'll contact you shortly.</p>",d.fadeTo(800,0).css("pointer","inherit").die("click")):f="<p class='alert'>Please try again</p>";a.find(".msg").html(f)});return!1});$("#ifr_popup > #frame, #ifr_popup_view .close").live("click",function(){if($("#ifr_popup .open").hasClass("modal-popup"))return!1;Popup.close});$("#ifr_popup").click(function(a){if(a.target===this){if($("#ifr_popup .open").hasClass("modal-popup"))return!1;
Popup.close()}})},init_kredible:function(){$(".kredible").live("click",function(a){var b=$(this);a=$(a.target);b=b.closest(".kredible");b.parent().is(".kredible")&&(b=b.parent());if(!(0<b.closest(".unkredible").length))return b=b.find(".kredible").html()||b.text(),b=b.replace(/^@/,""),a.is(".shield, .scores")?Popup.open({type:"infl-kred",uid:b}):"EC"in window?window.EC.load_stack({source:"twitter",post:"from:"+b}):window.open("http://twitter.com/"+b),!1});$(window).bind("message.kredpopup",function(a){var b;
a=a.originalEvent.data;"kredpopupclose"===a?Popup.close():(b=/^kredpopup:(.*)$/.exec(a))&&Popup.open({type:"infl-kred",uid:b[1]})})},openTweetEffect:function(a,b){this.closeTweetEffect();if(a){$("#post_effect_tmpl").tmpl().appendTo("body");b&&($("#post_effect_tweet img").attr("src",b.user.avatar),$("#post_effect_tweet_text").text(b.post));this.getTweetEffectCounters(a,b);var c=this;$("#pe_clicks .pe_counter_label").unbind();b.entities&&b.entities.urls.length&&$("#pe_clicks .pe_counter_label").click(function(){c.openBitlyChart(b.entities.urls[0].url)})}},
openBitlyChart:function(a){html="<div id='bitlyChart'><div id='closeChart'>Close Chart</div><iframe src='?option=com_pages&view=bitly_chart&js_compress_off=true&uri="+encodeURIComponent(a)+"'/></div>";this.closeBitlyChart();$(html).insertBefore("#post_effect_boxes")},closeBitlyChart:function(){$("#bitlyChart").remove()},closeTweetEffect:function(){$("#post_effect_wrapper").remove()},getTweetEffectCounters:function(a,b){$.ajax({url:"/ajax/?method=utility.getPostEffect",dataType:"json",type:"POST",
data:{postid:a,post_data:toJSON(b)},success:function(a){a&&($.each(a.counters,function(a,b){$("#pe_"+a+" .pe_counter").text(0<=b?b:"n.a.")}),$("#pe_loading").text(""),a.post&&($("#post_effect_tweet img").attr("src",a.post.user.avatar),$("#post_effect_tweet_text").text(a.post.post)))},error:function(a){Popup.closeTweetEffect()}})},openPopupIndex:1,popups:{},addPopup:function(a,b,c){c=c||0;var d=Popup.popups;console.log("addPopup",a,b,c,d);if(d[a]){var f=d[a].element,e=f.parent();"ifr_popup"==e.id&&
e.hide();f.remove()}d[a]={element:b,priority:c};(b=b.find("#close_button"))&&b.click(function(b){Popup.removePopup(a)});Popup.sortAndShow()},removePopup:function(a){var b=Popup.popups,c=b[a];console.log("removePopup",a,c,b);if(c){var c=c.element,d=c.parent();"ifr_popup"==d.id&&d.hide();c.remove()}delete b[a];Popup.sortAndShow()},sortAndShow:function(){var a=Popup.popups;console.log("sortAndShow",a);var b=[];$.each(a,function(a,d){b.push(d)});b.length&&(b.sort(function(a,b){return b.priority-a.priority}),
$.each(b,function(a,b){var f=b.element,e=f.parent();0==a?("ifr_popup"==e.id&&e.show(),console.log("sortAndShow:show",a,b),f.show()):("ifr_popup"==e.id&&e.hide(),console.log("sortAndShow:hide",a,b),f.hide())}))},open:function(a){var b=Popup.load_popup(a);$("#iframe_popup").removeAttr("src");var c=$("<div/>").addClass("ifr_layer");$("#ifr_popup_view").append(c);var d=++this.openPopupIndex;c.css("zIndex",d);b.children("div, iframe").filter(":not(.open, .close)").remove();b=$(b);b.show().appendTo(c);
$("#ifr_popup").height(document.height+100);a.priority=a.priority||d;Popup.addPopup(a.type,b,a.priority)},load_popup:function(a){var b=a.url,c=$("#ifr_popup").removeClass("nouveau").removeClass("spaces"),d=c.children("#content").clone(!0),f=$("#featureName"),e=[720,500],g=100;as_iframe=!0;content_id=!1;backgr_col="#fff";fullsize=!1;modal_popup=close_button=!0;d.removeClass("nobackground");switch(a.type){case "need_subscription":f.text(a.featureName);e=[835,440];g=120;as_iframe=!1;content_id="#need_subscription";
break;case "alert":e=!1;g=120;as_iframe=!1;content_id="#alert";break;case "postbox":e=window.Influence||window.Perks||window.KR_Leaderboards?[630,380]:[350,405];as_iframe=!1;close_button=!0;g=55;content_id="#postbox_popup";break;case "trial_update":e=[835,440];as_iframe=!1;content_id="#trial_update";break;case "trial_extend_info":e=[835,440];as_iframe=!1;content_id="#trial_extend_info";break;case "trial_extended":e=[835,440];as_iframe=!1;content_id="#trial_extended";break;case "log_out":e=[368,342];
g=100;as_iframe=!1;content_id="#log_out";break;case "trial_expired":e=[835,440];as_iframe=!1;content_id="#trial_expired";window.TD&&($("#trial_expired .pp").remove(),$("#onemore").remove());break;case "free_trial_update":e=[368,342];g=100;as_iframe=!1;content_id="#free_trial_update";break;case "about_t2":e=[1035,500];g=50;b="/components/com_pages/views/td/tmpl/about.php";backgr_col="#696969";break;case "faq_T2":e=[1035,500];g=50;b="/components/com_pages/views/td/tmpl/faq.php";backgr_col="#696969";
break;case "core_feature":e=[800,500];g=50;b="/components/com_pages/views/td/tmpl/core_feature.php#"+a.anchor;backgr_col="#696969";break;case "cross_app_contact":e=[387,520];g=25;as_iframe=!1;content_id="#cross_app_contact";c.addClass("nouveau");break;case "not_logged":case "cross_app_login":e=[368,342];g=100;as_iframe=!1;content_id="#cross_app_login";break;case "new_user_ask":e=[520,200];g=100;as_iframe=!1;content_id="#new_user_ask";break;case "reset_password":e=[350,295];g=100;as_iframe=!1;content_id=
"#reset_password";break;case "confirm":e=[550,250];g=100;as_iframe=!1;content_id="#confirm";msg=a.msg;d.find(".confirm-message").html(msg);break;case "add_account":e=[835,440];g=100;as_iframe=!1;content_id="#add_account";break;case "pb_email_collector":e=[728,430];g=100;as_iframe=!1;content_id="#pb_email_collector";logged_usr.id&&(modal_popup=!0,close_button=!1);break;case "kr_step2":case "kr_step2_tw":case "kr_step2_fb":case "kr_step4":case "kr_step5":case "kr_email_collector":e=window.location.href.toString().match(/multisteps_registration/)?
"kr_step2"==a.type?[800,500]:[645,400]:[800,545];g=100;as_iframe=!1;content_id="#"+a.type;c.children("#frame").unbind("click");d.find(".close").unbind("click");close_button=!1;break;case "kr_step3_tw":close_button=!1;e=[600,550];g=100;as_iframe=!1;content_id="#"+a.type;c.children("#frame").unbind("click");d.find(".close").unbind("click");break;case "perks_email_collector":e=[800,510];g=100;as_iframe=!1;content_id="#perks_email_collector";c.children("#frame").unbind("click");d.find(".close").unbind("click");
close_button=!1;break;case "pb_app_popup":e=[728,430];g=100;as_iframe=!1;content_id="#pb_app_popup";break;case "choose_mono_search":e=[867,262];g=10;as_iframe=!1;content_id="#choose_mono_search";backgr_col="#f7f7f7 !important";$("#ifr_popup").addClass("spaces");break;case "infl-kred":case "kred":e=[368,365];g=10;as_iframe=!1;content_id="#infl-kred";backgr_col="#fff";a.uid&&setTimeout(function(){InfluencePopup.init(a.uid);c.addClass("krazyklose");var b=$("#content").position().left+160;$("#close_button").prependTo(".ifr_layer").css({height:39,
width:39,position:"absolute",left:b,top:0,background:'transparent url("/components/com_pages/views/images/ifr_popup/kr_pop_close.png") no-repeat 0 0',"z-index":10,cursor:"pointer"})},1);f=function(){window.Influence&&Influence.getFlags(a.uid,!0)};c.children("#frame").unbind("click").click(f);d.find(".close").unbind("click").click(f);$("#close_button").prependTo("#content");break;case "wish-open":content_id="div#wopup-wish";case "wish":e=[732,344];as_iframe=g=!1;content_id=content_id||"#wopup-wish";
backgr_col="#fff";f=function(){$("#falsebottom #system_log").remove()};d.find("#frame").unbind("click").click(f);d.find(".close").unbind("click").click(f);break;case "wish-info":e=[732,1];content_id="#wopup-info";g=10;as_iframe=!1;backgr_col="#fff";break;case "community_add_popup":e=[387,480];g=25;as_iframe=!1;content_id="#community_add_popup";c.addClass("nouveau");break;case "bigChart":b="/index.php?option=com_pages&view=analyticly_preview&kwd="+a.kwd+"&source="+(a.source||"twitter")+"&callback=analyticly_callback";
as_iframe=!0;e=[980];g=50;break;case "loader":e=[300,65];g=100;as_iframe=!1;content_id="#loader";break;case "url":as_iframe=!0;e=a.width&&a.height?[a.width,a.height]:[980,520];g=50;break;case "kred-url":as_iframe=!0;e=[700,600];g=50;break;case "rs_form_overlay":case "rs_result_overlay":case "va_home_overlay":case "ec_home_overlay":case "gr_home_overlay":case "va_fb_help_overlay":g=0;fullsize=!0;as_iframe=!1;content_id="#"+a.type;backgr_col="none";d.addClass("nobackground");modal_popup=!1;break;case "chart_selector":e=
[500,350];g=100;as_iframe=!1;content_id="#chart_selector";break;case "kr_welcome_popup":case "kr_welcomeback_popup":case "kr_influence_changed_popup":"kr_welcomeback_popup"==a.type?e=[768,410]:(e=[615,280],d.addClass("roundcorner"));g=100;as_iframe=!1;content_id="#"+a.type;close_button=!0;break;case "kr_outreach_changed_popup":e=[615,380];g=100;as_iframe=!1;content_id="#"+a.type;d.addClass("roundcorner");close_button=!0;break;case "kr_offline_click_popup":e=[615,280];g=100;as_iframe=!1;content_id=
"#kr_offline_click_popup";d.addClass("roundcorner");close_button=!0;break;case "email_verify_popup":e=[615,180];g=100;as_iframe=!1;content_id="#email_verify_popup";d.addClass("roundcorner");break;case "perks_logout":case "kr_logout":e=[800,510];g=100;as_iframe=!1;content_id="#"+a.type;c.children("#frame").unbind("click");d.find(".close").unbind("click");close_button=!1;break;case "kr-ohno-popup":case "kr-ohno-thanks-popup":case "kr-verify-popup":case "kr-verify-popup-link":e=[768,410];g=100;as_iframe=
!1;close_button=!0;content_id="#"+a.type;c.children("#frame").unbind("click");close_button=!1;break;case "merging_in_progress":e=[768,180];g=100;as_iframe=!1;content_id="#"+a.type;c.children("#frame").unbind("click");close_button=!0;break;case "us_elections":e=[770,435];g=100;as_iframe=!1;content_id="#"+a.type;c.children("#frame").unbind("click");close_button=!0;break;case "kred_identity":as_iframe=!0;e=[642,450];g=50;break;case "message_box":e=[830,180];g=100;as_iframe=!1;content_id="#"+a.type;msg=
a.msg;d.find(".message-prompt").html(msg);close_button=!0;break;case "login_brands":e=[450,395];g=100;as_iframe=!1;content_id="#"+a.type;close_button=!0;break;case "kb_signup_step1":e=[850,695];g=20;as_iframe=!1;content_id="#"+a.type;close_button=!0;break;case "kb_signup_step2":e=[850,950];g=20;as_iframe=!1;content_id="#"+a.type;close_button=!0;break;case "kb_signup_step3":e=[850,1E3];g=20;as_iframe=!1;content_id="#"+a.type;close_button=!0;break;case "kb_account_setting_step1":e=[850,300];g=20;as_iframe=
!1;content_id="#"+a.type;close_button=!0;break;case "kb_account_setting_step2":e=[800,0];g=20;as_iframe=!1;content_id="#"+a.type;close_button=!0;break;case "catalyst_contact":e=[612,455];g=20;as_iframe=!1;content_id="#"+a.type;close_button=!0;break;case "collect_email_for_rewards":e=[800,460];g=100;as_iframe=!1;content_id="#"+a.type;close_button=!1;break;case "finalcollect_email_for_rewards":e=[800,290];g=100;as_iframe=!1;content_id="#"+a.type;close_button=!1;break;case "kr_FB_skip_confirm":case "kr_FB_step1":"kr_FB_step1"==
a.type&&(e=[680,580]);"kr_FB_skip_confirm"==a.type&&(e=[680,318]);g=100;as_iframe=!1;content_id="#"+a.type;close_button=!1;break;case "dotceo_congrats":e=[440,310];g=100;as_iframe=!1;content_id="#"+a.type;close_button=!0;break;case "dotkred-email-collector":e=[590,505];g=100;as_iframe=!1;content_id="#"+a.type;c.children("#frame").unbind("click");d.find(".close").unbind("click");close_button=!1;break;case "dotkred-identity-popup":e=[590,505];g=100;as_iframe=!1;content_id="#"+a.type;close_button=!0;
break;case "dotkred-community-popup":e=[590,405];g=20;as_iframe=!1;content_id="#"+a.type;close_button=!0;break;case "dotkred-payment-popup":e=[590,595];g=100;as_iframe=!1;content_id="#"+a.type;close_button=!0;break;case "dotkred-share-popup":e=[590,275],g=100,as_iframe=!1,content_id="#"+a.type,close_button=!0}a.width&&(e[0]=a.width);a.height&&(e[1]=a.height);f={"background-color":a.backgr_col||backgr_col};"#infl-kred"===content_id&&(f.overflow="hidden");a.offset_top&&(g=a.offset_top);if(as_iframe||
g)f.marginTop=g+"px";e&&!fullsize&&(f.width=e[0]+"px",f.height=e[1]?e[1]+"px":"auto",f.marginLeft=-1*(e[0]/2+5)+"px");fullsize&&(f.width="100%",f.height="100%",f.marginLeft="0px");d.find("#close_button").toggle(close_button);d.css(f);c.show();d.find(".static_html").hide().removeClass("open");as_iframe?(d.find("iframe").addClass("open").attr("src",b).show(),/spaces/.test(b)&&c.addClass("spaces")):(d.find("iframe").removeClass("open").hide(),"#wopup-wish"===content_id?d.css("margin-top","-99em"):"div#wopup-wish"===
content_id&&($.fx.off=!0),modal_popup&&d.find(content_id).addClass("modal-popup"),d.find(content_id).addClass("open").show(),!1===g&&($(window).bind("resize.popup",function(){if(!c.is(":hidden")){var a=parseInt($(window).height()),b=parseInt(c.find("#content").height()),a=(a-b)/2-100;0>a&&(a=10);"#wopup-wish"===content_id?d.animate({"margin-top":a},500):d.css("margin-top",a)}}),$(window).trigger("resize.popup")));a.source&&d.find(".source").text(a.source);a.html&&d.find("#text").html(a.html);e||(d.css({width:"auto",
height:"auto"}),(b=d.outerWidth())&&d.css("marginLeft",1-parseInt(b/2)));$.fx.off=!1;return d},close:function(a,b){var c=$("#ifr_popup_view");$layer=this!==Popup?$(this).closest(".ifr_layer"):b?c.find("#"+b):c.children(":last");$layer.fadeOut(function(){$(this).remove();0===c.children().length&&c.parent().hide();"function"===typeof a&&a()});$(window).trigger("popup_close")},init_login:function(){function a(a,b){var c=a.find("form"),g=c.find("input[name=firstname]");g.val();var h=c.find("input[name=lastname]");
h.val();var l=c.find("input[name=email]"),q=l.val(),r=c.find("input[name=email_verify]");r.val();var k=c.find("input[name=pwd]"),m=k.val(),n=c.find("input[name=pwd_verify]"),v=n.length?n.val():"",u=c.find("input[name=phone]").val(),p=a.find(".error_msg");c.find("input, select, div").removeClass("error");p.hide();$("#kb_signup_frm_step1").removeClass("alternativeLogins");$("#alternativeLogins").attr("class","");if(Popup.regSubmit)return!1;console.log("FORM SUBMITTED");u&&1>u.length&&$("#phone").val("0");
switch(b){case "email_collector_only":$inputs=[l];break;case "basic_collector":$inputs=[g,h,l];break;default:$inputs=[g,h,l,k,n]}var s=!1;$.each($inputs,function(a,b){b&&""==b.val()&&(b.addClass("error"),p.text("Field(s) missing").show(),s=!0)});if(s)console.log("FAILED!");else if(!1==/^[^@\s]+@[^@\s]+\.[a-z]{2,}$/.test(q))l.addClass("error"),r&&r.addClass("error"),p.text("Invalid email address!").show();else{var t={email:$.trim(q)};if(k.length){if(n.length&&m!=v){k.addClass("error");n.addClass("error");
p.text("passwords don't match!").show();return}t.pwd=$.trim(m)}if(s)console.log("FAILED!");else return Popup.regSubmit=!0,$.ajax({url:"/ajax/?method=user.logincheck",dataType:"text",type:"POST",data:t,success:function(g){console.log("logincheck: ",g);console.log("mode: ",b);switch(b){case "kred_brand_login":case "login":switch($.trim(g)){case "ok":c.submit();break;case "bad_pwd":k.addClass("error");p.text("Bad Password. Try Again.").fadeIn();Popup.regSubmit=!1;break;case "no_email":"kred_brand_login"==
b?(p.text("Email not found").fadeIn(),Popup.regSubmit=!1):Popup.close(function(){Popup.open({type:"new_user_ask"})});Popup.regSubmit=!1;break;default:l.addClass("error"),k.addClass("error"),p.text("Oops, Try Again").fadeIn(),Popup.regSubmit=!1}break;case "kred_brand_user_data_collector":switch($.trim(g)){case "your_email":c.submit();break}case "basic_collector":case "email_collector_only":case "user_data_collector":switch($.trim(g)){case "ok":case "bad_pwd":case "email_used":if(l.addClass("error"),
"kred_brand_user_data_collector"==b){p.html("Email already registered.").show();$("#kb_signup_frm_step1").addClass("alternativeLogins");$.ajax({url:"/ajax/?method=user.getlinkedaccounts",data:{email:t.email},dataType:"json"}).done(function(a){a&&$.each(a,function(a,b){$("#alternativeLogins").addClass("show_"+b)})});Popup.regSubmit=!1;break}else if(p.text("email already registered").show(),!window.confirm("This email address has been already used, do you want to proceed merging the accounts?")){Popup.regSubmit=
!1;break}case "no_email":console.log("submitting form: ",a);c.submit();break;default:Popup.regSubmit=!1,l.addClass("error")}}},error:function(a){l.addClass("error");Popup.regSubmit=!1}}),!1}}"#signup"==location.hash&&(Popup.open({type:"pb_email_collector"}),location.hash="");var b=$("#loginPopup").attr("twoauth"),c=$("#signupbar").attr("twoauth");$(".login-via-twitter a").attr("href",b);$("#tw_signin a").attr("href",b);$("#tw_create a").attr("href",c);$("#notify_signup, #new_user_ask_signup").live("click",
function(){Popup.close(function(){Popup.open({type:"pb_email_collector"})})});$(".etl-score, .kr-tech-score, .kr-bg, .kr-bg-tech").live("click",function(){Popup.open({type:"infl-kred"})});$(".forgot-password").live("click",function(){Popup.close(function(){Popup.open({type:"reset_password"})})});$(".free-trial-box a").live("click",function(){Popup.open({type:"pb_email_collector"})});$("#loginPopup, #login_popup .login-ok, #broken_popup, #free_trial_update .login-ok, #new_user_ask_login").click(function(){if($(this).closest(".kr-invite-body").length){var a=
$("#loginPopup").attr("twoauth");window.location=a}else return!window.logged_usr||!logged_usr.id?Popup.open({type:"cross_app_login"}):alert("you are already logged in"),!1});$("#signupbar").live("click",function(a){a.preventDefault();Popup.open({type:"pb_email_collector"})});$(".platform_guide").live("click",function(a){a.preventDefault();Popup.open({type:"pb_email_collector"})});$("#pb_email_collector #loginFormReg span").click(function(){$(this).parent().find("input").focus()});$("#pb_email_collector #loginFormReg input").focus(function(){$(this).parent().find("span").hide()}).blur(function(){""==
$(this).val()&&$(this).parent().find("span").show()});$("#pb_email_collector .skip-link").live("click",function(a){$("#pb_email_collector #create_acct").click()});$("#pb_email_collector #create_acct").live("click",function(){console.log("email reg");$(this).addClass("active");$("#pb_email_collector #use_twitter ").removeClass("active");$("#account-details-div").show();$("#twitter-details-div, community-details-div").hide()});$("#pb_email_collector #use_twitter").live("click",function(){console.log("tab:",
this);$(this).addClass("active");$("#pb_email_collector #create_acct ").removeClass("active");$("#account-details-div, community-details-div").hide();$("#twitter-details-div").show()});"undefined"!==typeof window.active_account&&"twitter"!=window.active_account.source&&$(".follow_checkbox").hide();$("#cross_app_login #checkCredentials").live("click",function(){a($("#cross_app_login"),"login")});$("#pb_email_collector #checkCredentialsReg").live("click",function(){a($("#pb_email_collector"),"user_data_collector")});
$("#kr_email_collector #checkCredentialsReg").live("click",function(){a($(this).closest("#kr_email_collector"),"user_data_collector")});$("#dotkred-email-collector #checkCredentialsReg").live("click",function(){$root=$(this).closest("#dotkred-email-collector");var b=$root.find("#fullname").val();if(0<b.length){var c=b.split(" "),b=c[0],c="undefined"==typeof c[1]?"":c[1];$root.find("#firstname").val(b);$root.find("#lastname").val(c)}a($(this).closest("#dotkred-email-collector"),"basic_collector")});
$("#perks_email_collector #checkCredentialsReg").live("click",function(){a($("#perks_email_collector"),"user_data_collector")});$("#collect_email_for_rewards #checkCredentialsReg").live("click",function(){a($("#collect_email_for_rewards"),"email_collector_only")});$("#finalcollect_email_for_rewards #checkCredentialsReg").live("click",function(){a($("#finalcollect_email_for_rewards"),"email_collector_only")});$("#kb_signup_step1 .kb_signup_step1_submit").live("click",function(){a($("#kb_signup_step1"),
"kred_brand_user_data_collector")});$("#login_brands .kb_login_submit").live("click",function(){a($("#login_brands"),"kred_brand_login")});$(".tw-email-collector #checkCredentialsReg").live("click",function(b){b.preventDefault();a($(".tw-email-collector"),"basic_collector")})}};$(function(){Popup.init()});
var Revenue=function(){var a=this;this.plansSummary={};this.perms=[];this.whitelisted="Export Widget;Export HTML;Export RSS;Export CSV;Live Stats;Export Retweet;Assign;Custom Stats Filter;export_csv;30 Days Search;Assing a Tweet;Assign a Post;Unlimited Stacks".split(";");this.isAvailable=function(b){if(-1<$.inArray(b,a.whitelisted))return!0;if(!window.logged_usr||!logged_usr.id)return a.pleaseLogin(b),!1;if(-1<$.inArray(b,a.perms))return!0;a.becomeMember(b);return!1};this.pleaseLogin=function(b,c){$("#ifr_popup").length?
Popup.open({type:"not_logged"}):window.alert('"'+a.capitaliseFirstLetter(b)+" is a premium feature.\n You must be logged in to access it.")};this.newUserAsk=function(){$("#ifr_popup").length?Popup.open({type:"new_user_ask"}):window.alert('"'+a.capitaliseFirstLetter(featureName)+" is a premium feature.\n You must be signed in to access it.")};this.openPricingPage=function(){window.open({type:"url",url:"http://"+window.location.host+"/?option=com_pages&view=pricing"})};this.capitaliseFirstLetter=function(a){return a.charAt(0).toUpperCase()+
a.slice(1)};this.becomeMember=function(a){$("#ifr_popup").length?Popup.open({type:"need_subscription",featureName:a}):window.confirm('"'+this.capitaliseFirstLetter(a)+'" is a Premium Feature. Do you want to Sign Up or upgrade your subscripion now?')&&this.openPricingPage();return!1};this.upgradePrmTrans=function(){window.confirm("No more transactions/mo available for this plan. Do you want to upgrade now?")&&this.openPricingPage();return!1};this.upgradeAnalyticsKwdLimit=function(){window.confirm("You have reached the limit of searched for the past 30 days. Do you want to upgrade now?")&&
this.openPricingPage();return!1};this.requirePremium=function(a,c){return 0===Trial.isPremium?this.pleaseLogin(a,c):!0}};revenue=new Revenue;var prefs=function(a,b){this.canSave=!0;this.inverseCallback=!1;this.all_sources=b;this.init(a)};
prefs.prototype={modes:["Lite","Advanced","Business"],defaults:{top_tabs:{twitter:"on",facebook:"on",friendfeed:"on",blogsearch:"on",plaxo:"on",rss:"on",url:"on",flickr:"on",youtube:"on",seesmic:"on",identica:"on",linkedin:"on",digg:"on",photobucket:"on",myspace:"on",peoplebrowsr:"on"},allsources_list:{twitter:"on",flickr:"on",youtube:"on",seesmic:"on",friendfeed:"on",identica:"off",linkedin:"on",facebook:"off",email:"off",digg:"on",photobucket:"on"},panels:{right:"off",left:"off"},heliStack:{},view:"grid",
balloons:"off",num_cols:4,num_colsModes:{lite:4,advanced:4,business:4},refreshStacks:12E4,refreshNum:20,tile_size:70,last_search:"",keywords:[],level:2,rels:"orizzontal",no_split:0,show_locationModes:{lite:0,advanced:1,business:1},show_replyButton:1,show_tweetsourceModes:{lite:0,advanced:1,business:1},tw_colors:0,extra_replies:1,auto_updates:0,news_overlay:1,pb_news:0,autopause:1,dm_via_email:0,vip_listsModes:{lite:0,advanced:1,business:1},fontsizeModes:{lite:13,advanced:13,business:10},themeModes:{lite:"default",
advanced:"default",business:"outlook"},vipbuttons:1,addressbookModes:{lite:0,advanced:1,business:0},ppModes:{lite:0,advanced:1,business:1},tagsModes:{lite:0,advanced:1,business:1},prioritiesModes:{lite:0,advanced:1,business:1},emailModes:{lite:0,advanced:1,business:1},plaxoModes:{lite:0,advanced:1,business:1},rateModes:{lite:0,advanced:0,business:0},pbloveModes:{lite:0,advanced:1,business:0},profile_stacks:1,profile_PBID:1,todo_list:0,rate_post:0,absolute_timesModes:{lite:0,advanced:0,business:0},
mark_post_as_readModes:{lite:0,advanced:1,business:1},hide_read:0,flash_scroll:0,post_to_extids:[],assign_recent:[],assign_postModes:{lite:0,advanced:0,business:1},assign_notify:0,compressModes:{lite:0,advanced:0,business:1},active_mode:2,welcome_message:!1,camera_service:"twitpic",inline_flw:1,hashtag_autocomplete:1,shiftclick:1,bcc_target:"",bcc_active:1,learner_mode:0,past_tweets:[],audit_infoModes:{lite:0,advanced:0,business:1},show_real_names:0,views_prefs:{}},init:function(a){this.data=$.extend({},
this.defaults,a||{});a&&this.init_settings()},refresh:function(){var a=Controller.get_settings("all");"undefined"!=typeof a&&0<a.length&&(this.data=a)},get:function(a,b){var c=this.data;"undefined"!=typeof a&&(c=c[a]);"undefined"!=typeof b&&c&&(c=c[b]);return c},get_bool:function(a,b){var c=this.get(a,b);return 1===parseInt(c)},set:function(a,b,c,d,f){if(this.canSave||f){var e=this.data;b?(e[a]=e[a]||{},e[a][b]=c):e[a]=c;b=function(b){b?b[a]=e[a]:custom_alert("Error saving settings");d&&d(b)};c="number"==
typeof e[a]||"string"==typeof e[a]?e[a]:toJSON(e[a]);logged_usr.id?this.save_setting(a,c,b):b("true")}},save_setting:function(a,b,c){$.ajax({type:"POST",url:"/ajax/?method=user.save_setting",data:{type:a,settings:b},dataType:"json",success:c})},reset:function(a){var b=this,c=this.defaults,d="number"==typeof c[a]||"string"==typeof c[a]?c[a]:toJSON(c[a]);b.save_setting(a,d,function(c){b.data[a]=d})},set_tooltips_on:function(){this.set("tooltips",null,"on",function(a){a?window.TopRow&&TopRow.display_tooltips():
custom_alert("error saving preferences")})},set_tooltips_off:function(){this.set("tooltips",null,"off",function(a){a?window.TopRow&&TopRow.hide_tooltips():custom_alert("error saving preferences")})},init_toprow:function(){if(window.TopRow){var a=this.get("allsources_list"),b=[];$.each(a,function(a,d){"on"==d&&b.push(a)});TopRow.set_active_allsources(b);switch(this.get("tooltips")){case "on":tools.isSubdomain("sxsw")||TopRow.display_tooltips();break;case "off":TopRow.hide_tooltips()}window.BALLOONS=
this.get("balloons");switch(window.BALLOONS){case "on":TopRow.display_balloons();break;case "off":TopRow.hide_balloons()}TopRow.sendTo_init();a=this.get("keywords");"object"!=typeof a&&(a=[]);$.each(a.reverse(),function(a,b){TopRow.addToLastSearch(b)})}},init_settings:function(){if(window.launch){var a=this,b=a.get("active_mode");a.pb_mode=["lite","advanced","business"][b];b=a.get("themeModes")[a.pb_mode];window.searchView||Theme.selectPreset(b,!0);1===parseInt(a.get("assign_postModes")[a.pb_mode])?
($("body").removeClass("assign-disabled"),launch.init_post_status(1)):($("body").addClass("assign-disabled"),launch.init_post_status(0));0===parseInt(a.get("mark_post_as_readModes")[a.pb_mode])?$("body").addClass("mark_as_read-disabled"):$("body").removeClass("mark_as_read-disabled");0===parseInt(a.get("show_tweetsourceModes")[a.pb_mode])?$("body").addClass("hide_tweetsource"):$("body").removeClass("hide_tweetsource");0===parseInt(a.get("inline_flw"))&&$("body").addClass("hide_inline_flw");a.get("panels");
b=a.get("num_colsModes");"string"==typeof b&&(a.data.num_colsModes=a.defaults.num_colsModes);b=a.get("num_colsModes")[a.pb_mode];b=parseInt(b);"undefined"!=typeof b&&(null!=b&&!isNaN(b))&&"undefined"==typeof multistream&&(multistream={},multistream.columns_per_screen=b);(b=a.get("fontsizeModes")[a.pb_mode])&&$("#Hblog").css("font-size",b+"px");launch.active_account=tools.getLoggedInAcct();b=launch.active_account?launch.active_account.source:"twitter";if(launch.active_account)if(launch.active_extid=
[],b&&"email"!=b&&(launch.active_extid[0]=launch.active_account.ext_id),window.TopRow&&TopRow.display_avatar(b),"undefined"!=typeof logged_usr.accounts[b]){var c=launch.active_account.avatar_url;$(".pers_info_avatar").show().attr("src",c);$("#pers_info_name").text(launch.active_account.username);$("#pers_info_avatar, #pers_info_name").click(function(){engine.find_any_tile(launch.active_account.ext_id)});$(".pers_info_favicon").css("background-image","url("+IMAGEPATH+"/icons/squared/small/"+b+".png)");
"twitter"==b&&(launch.active_account.followers&&launch.active_account.friends)&&$('<span id="pers_info_counts">'+(0<launch.active_account.followers?'<span title="followers">'+launch.active_account.followers+"</span>":"")+(0<launch.active_account.friends?'/<span title="following">'+launch.active_account.friends+"</span>":"")+"</span>").appendTo($("#pers_info_name"));window.TopRow&&TopRow.resize_postbox()}else $("#pers_info_avatar").hide();window.TopRow&&(TopRow.set_source(b),this.init_toprow());launch.autopause=
!(window.Air&&Air.active)&&parseInt(a.get("autopause"));b=[];b.push({type:"inputbox",label:"Default Post Refresh",active:function(){return a.get("refreshNum")},callback:function(){var b=parseInt($("#"+this.id).val());b?99<b?b=99:20>b&&(b=20):b=20;$("#"+this.id).val(b);a.set("refreshNum",null,b)}},{type:"inputbox",label:"Refresh Interval (mins)",active:function(){var b=a.get("refreshStacks"),c=parseInt(b),e=3;b&&c&&(window.TopRow&&(TopRow.refreshInterval=c),e=c/6E4);return e},callback:function(){var b=
6E4*$("#"+this.id).val();window.TopRow&&(TopRow.refreshInterval=parseInt(b));a.set("refreshStacks",null,parseInt(b))}},{label:"Split Long Posts",descr:"want to write posts longer than 140ch? PeopleBrowsr will split them for you",active:function(){return 0===parseInt(a.get("no_split"))},callback:function(){this.active()?a.set("no_split",null,1):a.set("no_split",null,0)}},{type:"group",label:"Tools"},{label:"Twitter via Email",descr:"Want to reply to DMs and @replies via Email?",active:function(){return 1===
parseInt(a.get("dm_via_email"))},callback:function(){revenue.isAvailable("Twitter via Email")&&(this.active()?(Controller.disableDMviaEmail(),a.set("dm_via_email",null,0)):(launch.add_ids("postbox"),a.set("dm_via_email",null,1)))}},{label:"Email Alert Settings",descr:"Make changes to your email settings.",no_opt:!0,callback:function(){if(revenue.isAvailable("Twitter via Email")){if(1!==parseInt(a.get("dm_via_email")))return alert("You must first enable 'Twitter via Email'.");launch.add_ids("postbox")}}},
{label:"Sync Following/Followers",descr:"Force PeopleBrowsr to synchronize its records of your Following/Followers with Twitter.",no_opt:!0,callback:function(){Controller.syncRels(function(){custom_alert("Synchronization complete.")})}},{type:"group",label:"Set Your Options"},{label:"Auto Refresh",descr:"want your stacks to autorefresh when new posts arrive?",active:function(){return 0===parseInt(a.get("auto_updates"))},callback:function(){this.active()?(a.set("auto_updates",null,1),$.each(multistream.panels,
function(a,b){b.view.tx.master_controller="pause";b.view.tx.pause()})):(a.set("auto_updates",null,0),$.each(multistream.panels,function(a,b){b.view.tx.master_controller="play";b.view.tx.play()}))}});b.push({label:"@Reply (icon) in DM Stack",descr:"do you want to send public messages from your DM stack?",active:function(){return 1===parseInt(a.get("show_replyButton"))},callback:function(){this.active()?a.set("show_replyButton",null,0):a.set("show_replyButton",null,1);multistream.update_panels({source:"twitter",
relationship:["dm"]})}},{label:"@name in new stack",active:function(){return 1===parseInt(a.get("profile_stacks"))},callback:function(){this.active()?a.set("profile_stacks",null,0):a.set("profile_stacks",null,1)}},{label:"@name select PBID",active:function(){return 1===parseInt(a.get("profile_PBID"))},callback:function(){this.active()?a.set("profile_PBID",null,0):a.set("profile_PBID",null,1)}},{label:"Show inline @Replies",descr:"want your reply stack to show all post containing your @username, even when inline?",
active:function(){return 1===parseInt(a.get("extra_replies"))},callback:function(){this.active()?(a.set("extra_replies",null,0),$('.label_text[rel="xreplies"]').parent().hide(),$('.label_text[rel="replies"]').parent().show()):(a.set("extra_replies",null,1),$('.label_text[rel="xreplies"]').parent().show(),$('.label_text[rel="replies"]').parent().hide())}},{label:"Flash Scroll",active:function(){return 1===parseInt(a.get("flash_scroll"))},callback:function(){this.active()?a.set("flash_scroll",null,
0):a.set("flash_scroll",null,1)}},{label:"Inline Flw button",active:function(){return 1===parseInt(a.get("inline_flw"))},callback:function(){this.active()?(a.set("inline_flw",null,0),$("body").addClass("hide_inline_flw")):(a.set("inline_flw",null,1),$("body").removeClass("hide_inline_flw"))}},{label:"Hashtag Autocomplete",active:function(){return 1===parseInt(a.get("hashtag_autocomplete"))},callback:function(){var b=$("#quickPostTextArea, #t_keyword");this.active()?(a.set("hashtag_autocomplete",null,
0),tools.make_autocomplete(b,!1,!1)):(a.set("hashtag_autocomplete",null,1),tools.make_autocomplete(b,!1,!0))}},{label:"ShiftClick Tooltip",active:function(){return 1===parseInt(a.get("shiftclick"))},callback:function(){this.active()?a.set("shiftclick",null,0):a.set("shiftclick",null,1);alert("This option will be available after a page refresh")}},{label:"Bcc active",active:function(){return 1===parseInt(a.get("bcc_active"))},callback:function(){this.active()?a.set("bcc_active",null,0):a.set("bcc_active",
null,1)}},{label:"Learner Mode",active:function(){return 1===parseInt(a.get("learner_mode"))},callback:function(){this.active()?a.set("learner_mode",null,0):a.set("learner_mode",null,1)}},{label:"Show real names",active:function(){return 1===parseInt(a.get("show_real_names"))},callback:function(){this.active()?a.set("show_real_names",null,0):a.set("show_real_names",null,1);alert("This option will be available after a page refresh")}},{label:"Themes",no_opt:!0,extraclass:"themes-link",callback:function(){$("#settings_control").click();
Theme.showPicker("dashboard")}});window.OptionsBox&&(launch.settingsBox=new OptionsBox({id:"settings_box",options:b}));window.TopRow&&(TopRow.refreshInterval=parseInt(a.get("refreshStacks")));$("#settings_control").toggle(function(){var a=$(this).parent(),b='<div class="settings_wrapper"><div class="tabs fg1"><div class="general active border">General</div><div class="custom border">'+$("#selectedMode").text()+'</div><div class="border multistream-close"></div></div></div>',c=$(b);c.appendTo(a);launch.settingsBox.append_to(c);
launch.customBox.append_to(c);launch.customBox.element().hide();c.find(".multistream-close").click(function(){c.remove()});c.find(".general, .custom").click(function(){$(this).is(".general")?(launch.settingsBox.element().show(),launch.customBox.element().hide()):(launch.settingsBox.element().hide(),launch.customBox.element().show());$(this).parent().children().removeClass("active");$(this).addClass("active")});$(".refreshStacks").unbind("click").click(function(){multistream.refresh_all()});c.children("ul").match_height();
return!1},function(){$(".settings_wrapper").remove();return!1});custom_options=[{type:"group",label:"Add/Remove Functions"}];$.each([{label:"Addressbook",name:"addressbook"},{label:"PeopleProfile",name:"pp"},{label:"Groups",name:"tags"},{label:"Priorities",name:"priorities"},{label:"Email Tweet",name:"email"},{label:"Link Tw/Plaxo",name:"plaxo"},{label:"Rate a Post",name:"rate"}],function(b,c){0===parseInt(a.get(c.name+"Modes")[a.pb_mode])?$("body").addClass(c.name+"Modes-disabled"):$("body").removeClass(c.name+
"Modes-disabled");custom_options.push($.extend({active:function(){return 1===parseInt(a.get(c.name+"Modes")[a.pb_mode])},callback:function(){var b=a.inverseCallback?!this.active():this.active();a.set(c.name+"Modes",a.pb_mode,b?0:1);b?$("body").addClass(c.name+"Modes-disabled"):$("body").removeClass(c.name+"Modes-disabled")}},c))});custom_options.push({label:"VIP Lists",descr:"want a one click VIP tag, to quickly create your VIP list? A VIP button will be added to your posts actions",active:function(){return 1===
parseInt(a.get("vip_listsModes")[a.pb_mode])},callback:function(){var b=a.inverseCallback?!this.active():this.active();a.set("vip_listsModes",a.pb_mode,b?0:1);b?$("body").addClass("vip_listsModes-disabled"):$("body").removeClass("vip_listsModes-disabled")}},{label:"Notify Assign via DM",descr:"Send DM notification to post assignees.",active:function(){return 1===parseInt(a.get("assign_notify"))},callback:function(){var b=a.inverseCallback?!this.active():this.active();a.set("assign_notify",null,b?
0:1)}},{type:"group",label:"Show/Hide Information"},{label:"Show Tweet Source",descr:"want to see which application users are posting from?",active:function(){return 1===parseInt(a.get("show_tweetsourceModes")[a.pb_mode])},callback:function(){var b=a.inverseCallback?!this.active():this.active();a.set("show_tweetsourceModes",a.pb_mode,b?0:1);b?$("body").addClass("hide_tweetsource"):$("body").removeClass("hide_tweetsource")}},{label:"Show Location",descr:"want to see users locations in each post?",
active:function(){return 1===parseInt(a.get("show_locationModes")[a.pb_mode])},callback:function(){var b=a.inverseCallback?!this.active():this.active();a.set("show_locationModes",a.pb_mode,b?0:1)}},{label:"Show Absolute Times",descr:"Display absolute date and time intead of relative times. STACKS REFRESH NEEDED.",active:function(){return 1===parseInt(a.get("absolute_timesModes")[a.pb_mode])},callback:function(){var b=a.inverseCallback?!this.active():this.active();a.set("absolute_timesModes",a.pb_mode,
b?0:1)}},{type:"group",label:"Other"},{label:"Compressed Stack",active:function(){return 1===parseInt(a.get("compressModes")[a.pb_mode])},callback:function(){}},{label:"Mark as Read",active:function(){return 1===parseInt(a.get("mark_post_as_readModes")[a.pb_mode])},callback:function(){var b=a.inverseCallback?!this.active():this.active();a.set("mark_post_as_readModes",a.pb_mode,b?0:1);b?$("body").addClass("mark_as_read-disabled"):$("body").removeClass("mark_as_read-disabled")}},{label:"Reset unread counts",
no_opt:!0,callback:function(){a.inverseCallback||confirm("Are you sure you wish to reset your unread counts?\n(This will mark your recent replies and DMs as read.)")&&Controller.resetUnreadCounts(function(a){})}},{label:"Hide Read Posts",active:function(){return 1===parseInt(a.get("hide_read"))},callback:function(){var b=a.inverseCallback?!this.active():this.active();a.set("hide_read",null,b?0:1);b?$("div.post_container").filter(".read").show():$("div.post_container").filter(".read").hide()}},{label:"Font Size",
type:"slider",descr:"Change font size",no_opt:!0,callback:function(){}});window.OptionsBox&&(launch.customBox=new OptionsBox({id:"custom_box",options:custom_options}));$(".close_tooltip").click(function(){$(this).parent().is(".custom_tooltip")?$(this).parent().fadeOut():$(this).parent().parent().fadeOut()});b=parseInt(a.get("num_cols"));c=Math.floor(100*(1/b));window.tx&&(tx.post_width=c,tx.num_cols=b)}}};window.user_prefs=new prefs;
if(!window.InfluencePopup){$.fn.tipTip=$.fn.tipTip||function(){return this};var InfluencePopup={atname_cache:[],init:function(a){this.initEvents_done||this.initEvents();this.resetData();this.getFlags(a);this.getData(a);this.updateUI(a)},initEvents_done:!1,initEvents:function(){this.initEvents_done||(this.init_kredAnywhere(),this.init_badge_flip(),$("#kr-expand").live("click",function(){var a=$(this).hide();$("#kr-shrink").tipTip();$("#km-flags").hasClass("flagged")?$("#km-flags").tipTip({content:"Click to unflag"}).attr("title",
""):$("#km-flags").tipTip({content:"Flag/unflag this person for spam"}).attr("title","");$("#kr-kredentials-title").fadeIn();var b={width:729,height:578,"margin-left":-364};569>$(window).height()&&(b.height-=52,$("#km-claim").slideUp());var c=(parseInt($(window).height())-b.height)/2;0>c&&(c=0);b["margin-top"]=c;a.closest("#content").animate(b,600).addClass("expanded");$("#close_button").animate({left:"+=187px",top:c-10},600);return!1}),$("#kr-shrink").live("click",function(){var a=$(this);$("#kr-expand").show();
$("#kr-kredentials-title").fadeOut();var b={width:368,height:365,"margin-left":-184};$("#km-claim").slideDown();var c=(parseInt($(window).height())-b.height)/2;0>c&&(c=0);b["margin-top"]=c;a.closest("#content").animate(b,600).removeClass("expanded");$("#close_button").animate({left:"-=187px",top:c-10},600);return!1}),$("#kr-lists a.more").live("click",function(){$(this).closest(".kr-list").find("ul").addClass("expanded");$(this).closest(".kr-more").siblings(".kr-less").andSelf().toggle()}),$("#kr-lists a.less").live("click",
function(){$(this).closest(".kr-list").find("ul").removeClass("expanded");$(this).closest(".kr-less").siblings(".kr-more").andSelf().toggle()}),$(".current-community a.more").live("click",function(){$(this).closest("span").prevAll("ul.communities-list").slideDown();$(this).closest("span").hide().siblings(".kr-less").show()}),$(".current-community a.less").live("click",function(){$(this).closest("span").prevAll("ul.communities-list").slideUp();$(this).closest("span").hide().siblings(".kr-more").show()}),
$("#kr-most-mentioned a.more").live("click",function(){var a=$(".mmslider"),b=parseInt(a.css("margin-left"),10),c=a.find("img").length;b>-(33*(c-16))?a.animate({marginLeft:"-=296px"}):a.animate({marginLeft:0})}),$(".kred-dogear").live("click",function(a){if($(a.target).is(".kred-dogear"))return InfluencePopup.addKredShare(this),!1}),$(".kred-share-close").live("click",function(){$(this).closest(".kred-share").fadeOut();return!1}),$(".kred-share-link").live("click",function(){var a="http://kred.com/"+
$(this).closest(".tabcontent, #infl-kred").attr("uid");if(window.Banner&&Banner.postbox.length)return Banner.openPostbox("See my Kredentials here "+a+" #kred"),InfluencePopup.close(),!1;this.href=a}),this.initBadgeEvents(),this.initEvents_done=!0)},initBadgeEvents:function(){$(".communities-list li").live("click",function(a){a=$(this);var b=a.closest(".infl-kred"),c=a.data("scores"),d=c,f=a.text();console.log(d);b.find(".influencer-communities, ul.communities").find(".active").removeClass("active").end().find(":contains("+
f+")").addClass("active");a.is(".allcommunities")?(b.find("#kid-inf-count").text(b.find("#kid-inf-count").data("orig")),b.find("#kid-out-count").text(b.find("#kid-out-count").data("orig"))):(b.find("#kid-inf-count").text(d.user_inf),b.find("#kid-out-count").text(d.user_out));f=a.text();"Global Kred"===f?(b.find(".top_community_score").show(),b.find(".global_score").hide()):(b.find(".top_community_score").hide(),b.find(".global_score").show());b.find(".kid-kred .current-community span.name").text(f);
b.find(".kid-badge.stars-profile .specificcommunity").text(f);var e=b.find(".k_uid:first").text();window.Influence&&Influence.votes&&Influence.votes[e]&&Influence.votes[e][d.id]?(b.find(".thanks").remove(),b.find(".stars").addClass("votedone"),b.find(".vote").hide(),b.find(".stars span:lt("+Influence.votes[e][d.id]+")").addClass("selected"),b.find(".kid-badge .descripty").css("opacity",1).find(".starcount").text(Influence.votes[e][d.id])):(b.find(".thanks").remove(),b.find(".stars.votedone").removeClass("votedone"),
b.find(".vote").show(),c||(c={}),c.vote||(c.vote={votes:0,count:0}),c.vote.stars=c.vote.count?Math.round(c.vote.sum/c.vote.count):5,b.find(".stars-profile .votes").text(c.vote.count),b.find(".stars-profile .starcount").text(c.vote.stars),b.find("span.stars span").removeClass("dim selected").eq(c.vote.stars-1).nextAll("span").addClass("dim"));a.closest(".current-community").find(".kr-less .less").trigger("click");a.closest("#infl-kred").find(".switcher a:first:not(.current)").trigger("mouseenter");
InfluencePopup.updatePreferredCommunities(e,f)});$(".offline-profile a.certificate").live("click",function(a){a.stopImmediatePropagation();a.stopPropagation();a=$(this).attr("href");var b=$(window).width(),c=$(window).height();$("<img />",{src:a}).wrap('<div class="certviewer" />').parent().css({width:b,height:c}).prepend('<div class="veil" />').appendTo("body");return!1});$(".certviewer").live("click",function(a){var b=$(this);b.fadeOut(function(){b.remove()})});$(".kid_badge.offline-profile").live("click",
function(a){a.stopImmediatePropagation();a.stopPropagation();a=$(this);var b=a.closest(".tabcontent, .landing").find(".k_uid:first").text();b||(b="timoreilly");0<a.find("ul.tell").length?(Banner.postbox.one("onAfterPosting",function(){InfluencePopup.init(b)}),Banner.openPostbox("@"+b+" add your offline achievements to #Kred to increase your Influence and Outreach scores http://kred.com/"),InfluencePopup.close()):window.location="/"+b+"/getmore#offline";return!1});$(".kid-badge.stars-profile .opener").live("click",
function(a){a.stopImmediatePropagation();$("#infl-kred .current-community .kr-more a.more").trigger("click")});$(".kid-badge.stars-profile .addpluskr").live("click",function(a){a.stopImmediatePropagation();var b=$(this).closest(".infl-kred"),c=b.find(".k_uid:first").text();a=b.find(".kid-kred").data("numeric_id");var d=b.find(".specificcommunity:first").text(),b=(b=b.find("ul.communities-list li:contains("+d+"):first").data("scores"))&&b.id?b.id:0;"Global Kred"===d&&(b=0);$.post("/ajax/?method=influence.saveCommunityPlus",
{comm_id:b,numeric_id:a,source:"twitter",clickfrom:"starprofile"},function(a){a=parseInt(a);-1===a?alert("You have already given this user +Kred in this community"):1<a?(InfluencePopup.close(),a=["I gave @",c," +Kred in ",d," community influence http://kred.com/?pkid=",a].join(""),Banner.openPostbox(a),_gaq.push(["_trackEvent","+Kred Click","starprofile"])):alert("There has been a problem awarding this +kred. Please try again.")})});$(".kid-badge.stars-profile .vote").live("click",function(a){a.stopImmediatePropagation();
a=$(this);var b=a.closest(".stars-profile").find(".stars .selected:last").index()||0,c=a.closest("#kid-kred").find(".current-community ul.communities-list li").filter(".active").eq(0).data("scores").id,d=a.closest(".stars-profile").find(".votes"),f=~~d.text(),e=a.closest(".infl-kred"),g=e.find(".k_uid:first").text(),h=e.find(".specificcommunity:first").text();if(0>~~b)return!1;"Global Kred"===h&&(c=0);d.text(1+f);$.get("/ajax/",{method:"influence.saveCommunityVote",comm_id:c,ext_id:e.find(".kid-kred").data("ext_id"),
vote:++b});InfluencePopup.close();Banner.openPostbox("I voted @"+g+" "+b+" stars "+h+" on #Kred http://kred.com/"+g);a.closest(".stars-profile").find(".stars").addClass("votedone");a.hide().after('<p class="thanks">'+(f+1)+" votes</p>");window.Influence||(window.Influence={});Influence.votes||(Influence.votes={});Influence.votes[g]||(Influence.votes[g]={});Influence.votes[g][c]=b});$(".stars span").live("mouseenter",function(a){a.stopImmediatePropagation();a=$(this);if(a.closest(".votedone").length||
a.closest(".stars").find(".lit").removeClass("lit").end().find(".selected").length)return!1;$(this).prevAll().andSelf().addClass("lit")});$(".stars").live("mouseout",function(a){$(this).find(".lit").removeClass("lit")});$(".stars span").live("click",function(a){a.stopImmediatePropagation();if($(this).closest(".votedone").length)return!1;$(this).closest(".big_shield").find(".vote .copy").addClass("prompt");a=$(this).index();$(this).closest(".big_shield, .kid-badge").find(".descripty").css("opacity",
1).find(".starcount").text(1+a);$(".stars span.selected").removeClass("selected");$(".stars span.dim").removeClass("dim");$(this).prevAll("span").andSelf().addClass("selected")})},getPreferredCommunity:function(a,b,c){c&&c(void 0)},getPreferredCommunities:function(){var a=$.cookie("preferredcommunities");return a?parseJSON(a):{}},savePreferredCommunities:function(a){$.cookie("preferredcommunities",toJSON(a))},updatePreferredCommunities:function(a,b){var c=this.getPreferredCommunities();c[a]=b;this.savePreferredCommunities(c)},
updateUI:function(a){$("#km-activity a").attr("href","http://kred.com/"+a+"/activity");$("#infl-kred .k_uid").text(a);$("#infl-kred").attr("uid",a);$("#infl-kred .stars span").replaceWith('<span title="Click on the number of stars you want to give @'+a+' and then click on vote">&#9733;</span>');$("#infl-kred .stars span").tipTip()},resetData:function(a){a=a||$("#infl-kred");a.find("#tiptip_holder:visible").hide();a.find("#km-claim .commonalities").hide();a.removeClass("comparing").find(".uncommon").removeClass("uncommon");
a.find(".top_community_score, .global_score").find(".community-name, .influence-score, .outreach-score").text("");a.find("#kr-expand").show().tipTip();a.find("#kr-kredentials-title").hide();a.find(".k_uid, .counter").text("");a.find("#km-user-img img").attr("src","");a.find("#kid-kred .current-community span.name, #km-user-name, #kr-bio, #kr-loc").text("");a.find(".kr-more, #kr-most-mentioned .more, #kr-most-mentioned .more-info-header, .kr-less").hide();a.find("select.compare option:gt(0)").empty();
a.find(".expanded").removeClass("expanded")},getFlags:function(a){var b=this,c=$("#infl-kred");$("#km-flags").hasClass("flagged")?$("#km-flags").tipTip({content:"Click to unflag"}).attr("title",""):$("#km-flags").tipTip({content:"Flag/unflag this person for spam"}).attr("title","");a=a.toLowerCase();$("#user-flags",c).empty();$.ajax({url:"/ajax/?method=influence.getFlags",dataType:"json",type:"POST",data:{username:a},success:function(d){5<d.counts&&$("#user-flags",c).html($("<div />",{"class":"flag_score"}).text(d.counts));
d.flagged_by_you?($("#km-user").addClass("flagged"),$("#km-flags").addClass("flagged").find("span").text("Flagged Spam"),$("#km-flags").tipTip({content:"Click to unflag"}).attr("title",""),$("#km-flags").unbind("click").click(function(){var c=$(this);c.find("span").text("Spam");c.closest("#km-flags").removeClass("flagged");$("#km-user").removeClass("flagged");$("#km-flags").tipTip({content:"Flag/unflag this person for spam"}).attr("title","");$.ajax({url:"/ajax/?method=influence.removeFlag",dataType:"json",
type:"POST",data:{username:a},success:function(c){b.getFlags(a)}})})):($("#km-user").removeClass("flagged"),$("#km-flags").removeClass("flagged").find("span").text("Spam"),$("#km-flags").tipTip({content:"Flag/unflag this person for spam"}).attr("title",""),$("#km-flags").unbind("click").click(function(){var c=$(this);c.find("span").text("Flagged Spam");c.closest("#km-flags").addClass("flagged");$("#km-flags").tipTip({content:"Click to unflag"}).attr("title","");$.ajax({url:"/ajax/?method=influence.addFlag",
dataType:"json",type:"POST",data:{username:a,type:"spam"},success:function(c){alert("You have now flagged @"+a+" as a spammer. When 5 or more people have flagger @"+a+" as spam it will be revealed in the kred profile.");b.getFlags(a)}})}))}})},getData:function(a){function b(b){console.warn("populateKredentials: cloud from proxy: ",b);if(b&&b.count){var c=/:\/\/\w+/,d=$("#infl-kred #kr-most-clicked .mostclicked").empty();$.each(b.links,function(a,b){d.prev("h2").show();c.test(b[0])&&$("<a />",{text:b[0],
href:b[0],target:"_blank"}).wrap("<li />").parent().appendTo(d)});3<d.find("li").length&&d.prev("h2").find(".kr-more").show();var e=$("#infl-kred #kr-most-mentioned .mostmentioned .mmslider").empty();$.each(b.names,function(a,b){e.prev("span").show();$("#kr-most-mentioned a.more:hidden, #kr-most-mentioned .more-info-header").show();var c=b[0].replace("@",""),c=$("<img />",{"class":"twicon-b",uid:c,src:"/ajax/?method=user.gettwavatar&size=mini&screen_name="+c,title:"@"+c+", "+b[1]+" mentions",error:function(){$(this).remove()}}).appendTo(e);
$.fn.tipTip&&c.tipTip({delay:100})});10<b.names.length?e.closest(".mostmentioned").next(".more").show():e.closest(".mostmentioned").next(".more").hide();e.find("img.twicon-b").click(function(){var a=$("#infl-kred .k_uid:first").text();InfluencePopup.atname_cache.push(a);a=$(this).attr("uid");InfluencePopup.init(a)});var f=$("#infl-kred #kr-most-used .mostused").empty();$.each(b.tags,function(b,c){f.prev("h2").show();var d=$('<li title="Click to see Stream"><a target="_blank" href="'+encodeURI("http://rs.kred.ly/?xlinksearch=from:"+
a.toLowerCase()+" "+c[0]).replace("#","%23")+'">'+c[0]+"</a></li>").appendTo(f);$.fn.tipTip&&d.tipTip({delay:100})});3<f.find("li").length&&f.prev("h2").find(".kr-more").show();$("#infl-kred .wordcloud").empty();var k="";$.each(b.words,function(a,b){16>a&&(4>a&&(b[0]='<span class="freq'+(a+1)+'">'+b[0]+"</span>"),0>b[0].indexOf("@")&&(k+=b[0]+(15>a?", ":" ")))});$("#kr-word-cloud").html(k)}}$("#km-user-img img").attr("src","/ajax/?method=user.gettwavatar&size=mini&screen_name="+a);a=$.trim(a);this.getBadgeData(a);
$("#infl-kred .scrolling").removeClass("scrolling");$("#infl-kred .mostclicked").empty().prev("h2").hide();$("#infl-kred .mostmentioned .mmslider").empty().prev("span").hide();$(".mmslider").css("margin-left",0);$("#kr-most-mentioned, #kr-mutual-mentioned").find(".kr_more").hide();$("#infl-kred .mostused").empty().prev("h2").hide();$("#kr-word-cloud").empty().prev(".more-info-header").hide();for(var c=~~((new Date).getTime()/1E3),c=[null,c-2592E3,c-5184E3],d=[],f=0;f<c.length;f++){var e={username:a.toLowerCase(),
version:2};c[f]&&(e.month=c[f]);e=$.ajax({url:"//kredapi.peoplebrowsr.com/kredproxy/get_clouds",dataType:"jsonp",jsonp:"jsonp_callback",type:"POST",data:e,error:function(a){console.log("error:",a)}});d.push(e)}$.when.apply(null,d).then(function(){for(var a={count:!0,links:[],names:[],words:[],tags:[]},c={},d={},e={},f={},k=0;k<arguments.length;k++){var m=arguments[k][0];$.each(m.links,function(b,d){d[0]in c||(a.links.push(d),c[d[0]]=!0)});$.each(m.names,function(b,c){c[0]in d||(a.names.push([c[0],
c[1][0]]),d[c[0]]=!0)});$.each(m.words,function(b,c){c[0]in e||(a.words.push(c),e[c[0]]=!0)});$.each(m.tags,function(b,c){c[0]in f||(a.tags.push(c),f[c[0]]=!0)})}b(a)});window.logged_usr&&(logged_usr.active&&a!==logged_usr.active.foreign_uid)&&$.ajax({url:"/ajax/?method=influence.getCommonClouds",dataType:"json",type:"POST",data:{username_a:a,username_b:logged_usr.active.foreign_uid},success:function(b){function c(a){var b=$("#infl-kred #kr-top-comm .communities-list li").map(function(){return $(this).text()}),
d={};$.each(b,function(a,b){d[b]=!0});a=$.map(a,function(a){if(a.name in d)return a});var e=$("#kr-mutual-comm .communities-list").empty();$.each(a,function(a,b){$("<li />",{text:b.name}).appendTo(e).data("scores",b)});0===e.find("li").length&&e.closest("div").addClass("uncommon")}var d=!1;window.logged_usr.active.communities?c(window.logged_usr.active.communities,[]):Influence.getCommunities(window.logged_usr.active.foreign_uid,10,function(a){window.logged_usr.active.communities=a;c(a,[])});var e=
/:\/\/\w+/,f=$("#infl-kred #kr-mutual-clicked ul.mostclicked").empty();b.links&&$.each(b.links,function(a,b){d=!0;f.prev("h2").show();e.test(b[0])&&$("<a />",{text:b[0],href:b[0],target:"_blank"}).wrap("<li />").parent().appendTo(f)});0===f.find("li").length?f.closest("div").addClass("uncommon"):3<f.find("li").length?f.prev("h2").find(".kr-more").show():f.prev("h2").find(".kr-more").hide();var k=$("#infl-kred #kr-mutual-mentioned .mostmentioned .mmslider").empty();$.each(b.names,function(a,b){d=!0;
k.prev("span").show();$("#kr-mutual-mentioned a.more:hidden, #kr-mutual-mentioned .more-info-header").show();var c=b[0].replace("@",""),c=$("<img />",{"class":"twicon-b",uid:c,src:"/ajax/?method=user.gettwavatar&size=mini&screen_name="+c,title:b[0],error:function(){$(this).remove()}}).appendTo(k);$.fn.tipTip&&c.tipTip({delay:100})});10<b.names.length?k.closest(".mostmentioned").next(".more").show():k.closest(".mostmentioned").next(".more").hide();k.find("img.twicon-b").click(function(){var a=$("#infl-kred .k_uid:first").text();
InfluencePopup.atname_cache.push(a);a=$(this).attr("uid");InfluencePopup.init(a)});var m=$("#infl-kred #kr-mutual-used .mostused").empty();$.each(b.tags,function(b,c){d=!0;m.prev("h2").show();var e=$('<li title="Click to see Stream"><a target="_blank" href="'+encodeURI("http://rs.kred.ly/?xlinksearch=from:"+a.toLowerCase()+" "+c[0]).replace("#","%23")+'">'+c[0]+"</a></li>").appendTo(m);$.fn.tipTip&&e.tipTip({delay:100})});0===m.find("li").length?m.closest("div").addClass("uncommon"):3<m.find("li").length?
m.prev("h2").find(".kr-more").show():m.prev("h2").find(".kr-more").hide();var n="";$.each(b.words,function(a,b){d=!0;4>a&&(b[0]='<span class="freq'+(a+1)+'">'+b[0]+"</span>");16>a&&0>b[0].indexOf("@")&&(n+=b[0]+(15>a?", ":" "))});$("#kr-mutual-word-cloud").html(n);d&&$("#km-claim .commonalities").show().unbind("click").bind("click",function(){$(this).closest("#infl-kred").toggleClass("comparing")})}})},getBadgeData:function(a,b){b=b||$("#infl-kred");b.find(".kid-inf, .kid-out").hide();b.find(".kr").show();
b.find(".recalc").remove();a=$.trim(a);this.ajax_get_users(a,"twitter","combined",function(a){var d=b;d.find(".k_uid").text(a.userhash.us);$.each({links:"links_out",followers:"flwrs_in",friends:"flwrs_out",reply_in:"reply_in",reply_out:"reply_out",rt_in:"rt_in",rt_out:"rt_out"},function(b,e){d.find("."+e).find(".counter").text(InfluencePopup.humanise(a.values[b]))});d.find(".tot_in").text(InfluencePopup.humanise(a.values.mention_in));d.find(".tot_out").text(InfluencePopup.humanise(a.values.mention_out));
d.find(".tot_out, .tot_in").css("fontSize",1E6<=a.values.mention_in?29:40);top_comm={id:0,name:"Global Kred",user_inf:"object"==typeof a.group?a.group.score:a.values.score,user_out:"object"==typeof a.group?a.group.level:a.values.level};a.comms[0]=top_comm;d.find(".kid-kred").data("ext_id",0);d.find(".kid-kred").data("source",a.userhash.source);d.find(".kid-kred").data("numeric_id",a.userhash.f_id);if(top_comm.user_inf){d.find(".kid-badge .kr").hide().end().find(".kid-inf, .kid-out").show();var f=
InfluencePopup.humanise(parseInt(top_comm.user_inf)),e=InfluencePopup.humanise(parseInt(a.values.outreach));d.find(".inf-count").text(f);d.find(".out-count").text(e);d.find(".top_community_score h4.community-name").text(top_comm.name).tipTip();d.find(".top_community_score .influence-score").text(top_comm.user_inf);d.find(".top_community_score .outreach-score").text(top_comm.user_out)}d.find(".inf-count").data("orig",a.values.influence);d.find(".out-count").data("orig",a.values.outreach);d.find(".global_score .influence-score").text(a.values.score);
d.find(".global_score .outreach-score").text(a.values.level);a.userhash?(f=d.find("#kr-bio"),d.find("#kr-word-cloud"),a.userhash.bio&&"None"!==a.userhash.bio&&f.html("<b>Bio:</b> "+a.userhash.bio),d.find("#km-user-name").text(a.userhash.u_nm),a.userhash.loc&&"None"!==a.userhash.loc&&d.find("#kr-loc").text(a.userhash.loc)):console.error("error loading user profile info");d.find(".communities-list").empty().prev("h2").hide();var g=d.find(".communities-list").empty();g.prev("h2").show();if(a.comms){var h=
[];$.each(a.comms,function(a,b){h.push([a,b.user_inf])});h.sort(function(a,b){return b[1]-a[1]});var h=h.splice(0,10),l=null;$.each(h,function(b,d){l=a.comms[d[0]];var e=$("<li />",{text:l.name,comm_id:l.id,title:"Influence:"+d[1]}).data("scores",l);"Global Kred"===l.name?e.prependTo(g):e.appendTo(g);l.id==top_comm.id&&e.addClass("preferred")})}d.find("#kr-lists .communities-list :contains(Global Kred)").remove();3<g.find("li").length&&(g.prev("h2").find(".kr-more").show(),g.next(".kr-more").show());
0===g.find("li.preferred").trigger("click").length&&g.find("li:first").trigger("click")});$.ajax({url:"/ajax/?method=influence.getOfflineTransactions",dataType:"json",type:"POST",data:{username:a},success:function(c){var d=b.find(".kid-badge .offline").empty();c&&c.length&&d.empty().removeClass("tell");(c&&c.length||window.logged_usr&&logged_usr.id)&&b.find(".switcher .offlinekred").show();var f=!1,e=0;$.each(c,function(a,b){if(1<e)f=!0;else if("assigned"===b.status){var c=new Date(b.ts);[c.getMonth(),
c.getDay(),c.getYear()].join("/");c=$("<span />",{text:b.name,title:b.name,"class":"titlespan"}).wrap("<p />").parent();"1"!==b["private"]&&b.filename?$("<a />",{target:"_blank",href:"/?option=com_pages&view=kr_offline&filename="+b.filename,"class":"certificate",html:'<img src="http://pbcdn.peoplebrowsr.com/components/com_pages/views/images/kred/certificate.png" title="Click to see certificate" />'}).prependTo(c):c.prepend('<img src="http://pbcdn.peoplebrowsr.com/components/com_pages/views/images/kred/certificate.png" title="Waiting for certificate" />');
c=$("<li />").prepend(c);d.append(c);e++}});f&&d.append('<li><p class="seemore" title="Click to see more">See more...</li></p>');d.find("li p span.titlespan").tipTip();d.find("li p img").tipTip();0===d.find("li").length&&(window.logged_usr&&b.find(".k_uid:first").text()===logged_usr.active.foreign_uid?c="<li>Add your Kred Kred Moments!</li>":(c='<li class="unkredible">Ask @'+a+" to add Kred Moments</li>",d.append(c).addClass("tell")))}})},ajax_get_users:function(a,b,c,d){var f={fetch:c?c:"combined"};
"twitter"==b?f.usernames=a.toLowerCase():f.nids=a.toLowerCase();return $.ajax({url:"//kredapi.peoplebrowsr.com/kredproxy/get_users",dataType:"jsonp",jsonp:"jsonp_callback",type:"GET",data:f,success:function(a){console.log("Direct call to Proxy for /get_user:",f,a);for(var b in a)console.log("UID:",b),parseInt(b),d(a[b],b)}})},humanise:function(a){void 0===a&&(a="-");return(a+"").replace(/[0-9]+[.,0-9]*[0-9]*/g,function(a){a=a.replace(/,/,"");var c=(a+"").split(".");a=c[0];for(var c=1<c.length?"."+
c[1]:"",d=/(\d+)(\d{3})/;d.test(a);)a=a.replace(d,"$1,$2");return a+c})},kredAnywhere_timeout:null,init_kredAnywhere:function(){},rKredAnywhere:/(^|\W)(@[a-zA-Z0-9_-]+)('s|[\.,"']+|)/g,rKredAnywhereIgnore:/^@(replies|reply|name)$/i,kredAnywhereIgnoreModify:!1,kredAnywhere:function(a,b,c){InfluencePopup.kredAnywhereIgnoreModify=!0;a||(a="*");a=$(a,c).not(".kredible");b&&(a=a.not(b));a.length&&$.fn.replaceText&&a.replaceText(this.rKredAnywhere,function(a,b,c,g){a=c.toLowerCase();return"@replies"===
a||"@reply"===a||"@name"===a||"@mentions"===a?b+c+g:b+'<span class="kredible"><span class="kredible">'+c+"</span>"+g+'<span class="shield"></span></span>'});InfluencePopup.kredAnywhereIgnoreModify=!1},init_badge_flip:function(){var a=!1;if("WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix&&"getComputedStyle"in window){var b=$('<div class="webkit-transform-test"/>').appendTo("body").get(0),a=3===parseInt(getComputedStyle(b,null).marginTop);document.body.removeChild(b)}a&&!1===/2d/.test(location.hash)?
($(window).load(function(){$("html").addClass("allow-3d-css")}),$(".switcher a").live("mouseenter click",function(a){a=$(this);var b=a.attr("data-index"),f=$(this).closest(".switcher").siblings(".cube_flip_stage");a.siblings().removeClass("current");a.addClass("current");f.find(".cube_flip").removeClass("flip0 flip1 flip2 flip3 flip4").addClass("flip"+b);f.find(".addpluskr").hide();f.find(".addpluskr").show();return!1})):$(".switcher a").live("mouseenter click",function(){var a=$(this),b=a.attr("data-index"),
f=$(this).closest(".switcher").siblings(".cube_flip_stage");a.siblings().removeClass("current");a.addClass("current");f.data("flip",b).children().children().css("zIndex",1).filter(".side"+b).css("zIndex",2);return!1})},addKredShare:function(a){var b=$(a).find(".kred-share");0===b.length&&(b=$("#kred-share").tmpl().appendTo(a));b.fadeToggle()},close:function(){window.Popup?Popup.close():window.close()}};$(function(){InfluencePopup.initEvents()})}
(function(a){"$:nomunge";a.fn.replaceText=function(b,c,d){return this.each(function(){var f=this.firstChild,e,g,h=[];if(f){do 3===f.nodeType&&(e=f.nodeValue,g=e.replace(b,c),g!==e&&(!d&&/</.test(g)?(a(f).before(g),h.push(f)):f.nodeValue=g));while(f=f.nextSibling)}h.length&&a(h).remove()})}})(jQuery);
$(function(){function a(){Popup.close();$.cookie("kreddomain")?Popup.open({type:"dotkred-identity-popup"}):(post="I have just signed up for @Kred - the leader in community influence. See where you are influential at Kred.com #Kred",Banner.openPostbox(post))}$("#kr_step2 .next-step").live("click",function(){Popup.close();var a="twitter"==window.USER_ORIGIN?"@"+window.active_account.username:window.fb_name;$("#kr_step4 .hello_name").text("Hello "+a+",");Popup.open({type:"kr_step4"})});$("#kr_step4 .next-step").live("click",
function(){Popup.close();Popup.open({type:"kr_step5"})});$("#kr_step5 .next-step").live("click",function(){Popup.close();"twitter"==window.USER_ORIGIN&&(post="I have just signed up for Kred, See how you compare at Kred.com",Banner.openPostbox(post),$("#postboxCell #pb_inner").css("top","200"))});$("#kr_FB_skip_confirm .skip").live("click",function(){a()});$("#kr_FB_step1 .skip").live("click",function(){Popup.close();window.Popup.open({type:"kr_FB_skip_confirm"})});$("#kr_FB_skip_confirm .add-all, #kr_FB_step1 .continue, #kr_FB_step1 .add-all").live("click",
function(){function b(){var g=e.splice(0,49);FB_invite_friends_specific(c,g,function(c){console.log("FACEBOOK",c);c&&c.to&&e.length?b():a()})}var c="Please check out http://kred.com",e=$("#kr_FB_skip_confirm .fr_not_on_kred").val().split(",");b()});$("#dotkred-identity-popup .next-step").live("click",function(){Popup.close();Popup.open({type:"dotkred-community-popup"})});$("#dotkred-community-popup .next-step").live("click",function(){Popup.close();Popup.open({type:"dotkred-payment-popup"});var a=
$.cookie("kreddomain");a&&($("#dotkred-payment-popup #order_domain").val(a),$("#dotkred-payment-popup .selected-domain").text(a))});$("#dotkred-community-popup .go-back").live("click",function(){Popup.close();Popup.open({type:"dotkred-identity-popup"})});$("#dotkred-payment-popup .go-back").live("click",function(){Popup.close();Popup.open({type:"dotkred-community-popup"})});$("#dotkred-share-popup .skip-step").live("click",function(){Popup.close()});$("#dotkred-share-popup .tw_button").live("click",
function(){var a="http://kred.com",b=($(window).width()-575)/2,c=($(window).height()-400)/2,a="http://twitter.com/share?text="+encodeURIComponent("I just reserved my spot in the DotKred Network!")+"&url="+encodeURIComponent(a);window.open(a,"twitter","status=1,width=575,height=400,top="+c+",left="+b);return!1});$("#dotkred-share-popup .fb_button").live("click",function(){var a="http://www.facebook.com/sharer.php?s=100&p[url]="+encodeURIComponent("http://kred.com")+"&p[title]="+encodeURIComponent("I just reserved my spot in the DotKred Network! ")+
"&p[summary]="+encodeURIComponent("http://kred.com");window.open(a,"sharer","toolbar=0,status=0,width=626,height=436");return!1});$("#dotkred-payment-popup .next-step").live("click",function(){Popup.close();Popup.open({type:"dotkred-share-popup"})});var b=$.cookie("kreddomain");if(2==window.REG_STEP)if($(window).unload(function(){$.ajax({type:"post",url:"/ajax/?method=utility.trackexit",async:!1,data:{url:window.location.href}})}),window.Influence||window.inviteKR||window.Perks)"facebook"==window.active_account.source?
window.Popup.open({type:"kr_FB_step1"}):b||window.NETKRED_DOMAIN?(window.Popup.open({type:"dotkred-email-collector"}),$("#dotkred-email-collector #kreddomain").val(b)):window.Popup.open({type:"kr_email_collector"});else{console.log("step 2...");var b=window.LOGIN_LINK,c=window.SIGNUP_LINK;window.Popup.open({type:"pb_email_collector"});$("#pb_email_collector #use_twitter").removeClass("active");$("#pb_email_collector #create_acct ").addClass("active");$("#pb_email_collector").show();$("#pb_email_collector #account-details-div").show();
$("#pb_email_collector #twitter-details-div").hide();$(".login-via-twitter a").attr("href",b);$("#tw_signin a").attr("href",b);$("#tw_create a").attr("href",c)}else if(c=$.cookie("netkred_flow_cancelled"),"undefined"==typeof c||"1"!==c)if("2"==window.NETKRED_STEP&&b)Popup.open({type:"dotkred-identity-popup"});else if(b)switch(window.active_account.source){case "twitter":window.Popup.open({type:"dotkred-email-collector"});$("#dotkred-email-collector #kreddomain").val(b);break;case "facebook":window.Popup.open({type:"dotkred-identity-popup"})}window.merging_wip&&
Popup.open({type:"merging_in_progress"});0==window.verifiedUser&&(window.Influence?(b="kred.com",c="kr"):window.Perks?(b="kred.com",c="krw"):(b="peoplebrowsr.com",c="pb"),b="<a href='http://"+b+"/index.php?option=com_pages&view=emailverify&resend=1&app="+c+"' target='_blank'>Send me the verification email again</a>",$("#email_verify_popup").find("#email_resend_link").html(b),$("#kr-verify-popup-link").find("#email_resend_link").html(b),window.Influence?(console.log("rev kr log count:",window.KR_LOG_COUNT),
2==window.KR_LOG_COUNT&&(0==window.optinUser?Popup.open({type:"kr-ohno-popup"}):InfluenceViral.showWelcome()),3==window.KR_LOG_COUNT&&"2"!=window.KRED_STEP?window.Popup.open({type:"kr-verify-popup"}):3<window.KR_LOG_COUNT&&"2"!=window.KRED_STEP&&window.Popup.open({type:"kr-verify-popup-link"})):window.Perks?1==window.KR_LOG_COUNT&&"2"==window.KRED_STEP?window.Popup.open({type:"kr-verify-popup"}):2<=window.KR_LOG_COUNT&&"2"!=window.KRED_STEP&&window.Popup.open({type:"kr-verify-popup-link"}):window.Popup.open({type:"email_verify_popup"}))});
