(function(b){b.fn.extend({autocomplete:function(a,c){var f="string"==typeof a;c=b.extend({},b.Autocompleter.defaults,{url:f?a:null,data:f?null:a,delay:f?b.Autocompleter.defaults.delay:10,max:c&&!c.scroll?10:150},c);c.highlight=c.highlight||function(c){return c};c.formatMatch=c.formatMatch||c.formatItem;return this.each(function(){new b.Autocompleter(this,c)})},result:function(a){return this.bind("result",a)},search:function(a){return this.trigger("search",[a])},flushCache:function(){return this.trigger("flushCache")},
setOptions:function(a){return this.trigger("setOptions",[a])},hideSelect:function(){return this.trigger("hideselect")},unautocomplete:function(){return this.trigger("unautocomplete")}});b.Autocompleter=function(a,c){function f(){var a=t.selected();if(!a)return!1;var b=a.result;s=b;if(c.multiple){var f=d(p.val());1<f.length&&(b=f.slice(0,f.length-1).join(c.multipleSeparator)+c.multipleSeparator+b);b+=c.multipleSeparator}p.val(b);e();p.trigger("result",[a.data,a.value]);return!0}function g(a,b){if(v==
n.DEL)t.hide();else{var d=p.val();if(!(p.caret()<d.length)&&(b||d!=s))s=d,d=h(d),d.length>=c.minChars?(p.addClass(c.loadingClass),c.matchCase||(d=d.toLowerCase()),k(d,m,e)):(p.removeClass(c.loadingClass),t.hide())}}function d(e){if(!e)return[""];e=e.split(c.multipleSeparator);var a=[];b.each(e,function(c,e){b.trim(e)&&(a[c]=b.trim(e))});return a}function h(e){if(!c.multiple)return e;e=d(e);return e[e.length-1]}function e(){var e=t.visible();t.hide();clearTimeout(q);p.removeClass(c.loadingClass);c.mustMatch&&
p.search(function(e){e||(c.multiple?(e=d(p.val()).slice(0,-1),p.val(e.join(c.multipleSeparator)+(e.length?c.multipleSeparator:""))):p.val(""))});e&&b.Autocompleter.Selection(a,a.value.length,a.value.length)}function m(d,f){if(f&&f.length&&l){p.removeClass(c.loadingClass);t.display(f,d);var k=f[0].value;c.autoFill&&(h(p.val()).toLowerCase()==d.toLowerCase()&&v!=n.BACKSPACE)&&(p.val(p.val()+k.substring(h(s).length)),b.Autocompleter.Selection(a,s.length,s.length+k.length));t.show()}else e()}function k(e,
d,f){if(c.mustMatchRegExp&&c.mustMatchRegExp instanceof RegExp&&!1==c.mustMatchRegExp.test(e))f(e);else{c.matchCase||(e=e.toLowerCase());var k=r.load(e);if(k&&k.length)d(e,k);else if("string"==typeof c.url&&0<c.url.length){var m={timestamp:+new Date};b.each(c.extraParams,function(c,e){m[c]="function"==typeof e?e():e});b.ajax({mode:"abort",port:"autocomplete"+a.name,dataType:c.dataType,url:c.url,data:b.extend({q:h(e),limit:c.max},m),success:function(a){var f;if(!(f=c.parse&&c.parse(a))){f=[];a=a.split("\n");
for(var k=0;k<a.length;k++){var m=b.trim(a[k]);m&&(m=m.split("|"),f[f.length]={data:m,value:m[0],result:c.formatResult&&c.formatResult(m,m[0])||m[0]})}}r.add(e,f);d(e,f)}})}else t.emptyList(),f(e)}}var n={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8},p=b(a).attr("autocomplete","off").addClass(c.inputClass),q,s="",r=b.Autocompleter.Cache(c),l=0,v,w={mouseDownOnSelect:!1},t=b.Autocompleter.Select(c,a,f,w),x;b.browser.opera&&b(a.form).bind("submit.autocomplete",
function(){if(x)return x=!1});p.bind((b.browser.opera?"keypress":"keydown")+".autocomplete",function(e){v=e.keyCode;switch(e.keyCode){case n.UP:t.visible()?(e.preventDefault(),t.prev()):g(0,!0);break;case n.DOWN:t.visible()?(e.preventDefault(),t.next()):g(0,!0);break;case n.PAGEUP:t.visible()?(e.preventDefault(),t.pageUp()):g(0,!0);break;case n.PAGEDOWN:t.visible()?(e.preventDefault(),t.pageDown()):g(0,!0);break;case c.multiple&&","==b.trim(c.multipleSeparator)&&n.COMMA:case n.TAB:case n.RETURN:if(f())return e.preventDefault(),
x=!0,!1;break;case n.ESC:t.hide();break;default:clearTimeout(q),q=setTimeout(g,c.delay)}}).focus(function(){l++}).blur(function(){l=0;w.mouseDownOnSelect||(clearTimeout(q),q=setTimeout(e,200))}).click(function(){1<l++&&!t.visible()&&g(0,!0)}).bind("search",function(){function e(a,b){var d;if(b&&b.length)for(var f=0;f<b.length;f++)if(b[f].result.toLowerCase()==a.toLowerCase()){d=b[f];break}"function"==typeof c?c(d):p.trigger("result",d&&[d.data,d.value])}var c=1<arguments.length?arguments[1]:null;
b.each(d(p.val()),function(c,a){k(a,e,e)})}).bind("flushCache",function(){r.flush()}).bind("setOptions",function(e,a){b.extend(c,a);"data"in a&&r.populate()}).bind("unautocomplete",function(){t.unbind();p.unbind();b(a.form).unbind(".autocomplete")}).bind("hideselect",function(){t.hide()})};b.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:!1,matchSubset:!0,matchContains:!1,mustMatchRegex:!1,cacheLength:10,max:100,mustMatch:!1,
extraParams:{},selectFirst:!0,formatItem:function(a){return a[0]},formatMatch:null,autoFill:!1,width:0,multiple:!1,multipleSeparator:", ",highlight:function(a,c){return a.replace(RegExp("(?![^&;]+;)(?!<[^<>]*)("+c.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:!0,scrollHeight:180,parse:null};b.Autocompleter.Cache=function(a){function c(e,c){a.matchCase||(e=e.toLowerCase());var b=e.indexOf(c);return-1==b?!1:0==b||a.matchContains}
function f(c,b){e>a.cacheLength&&d();h[c]||e++;h[c]=b}function g(){if(!a.data)return!1;var e={},c=0;a.url||(a.cacheLength=1);e[""]=[];for(var d=0,g=a.data.length;d<g;d++){var h=a.data[d],h="string"==typeof h?[h]:h,s=a.formatMatch(h,d+1,a.data.length);if(!1!==s){var r=s.charAt(0).toLowerCase();e[r]||(e[r]=[]);h={value:s,data:h,result:a.formatResult&&a.formatResult(h)||s};e[r].push(h);c++<a.max&&e[""].push(h)}}b.each(e,function(e,c){a.cacheLength++;f(e,c)})}function d(){h={};e=0}var h={},e=0;setTimeout(g,
25);return{flush:d,add:f,populate:g,load:function(d){if(!a.cacheLength||!e)return null;if(!a.url&&a.matchContains){var f=[],g;for(g in h)if(0<g.length){var p=h[g];b.each(p,function(e,a){c(a.value,d)&&f.push(a)})}return f}if(h[d])return h[d];if(a.matchSubset)for(g=d.length-1;g>=a.minChars;g--)if(p=h[d.substr(0,g)])return f=[],b.each(p,function(e,a){c(a.value,d)&&(f[f.length]=a)}),f;return null}}};b.Autocompleter.Select=function(a,c,f,g){function d(){function e(){for(var a=b(c);0<a.length;)if(a=a.parent(),
a.is("body")){setTimeout(e,500);return}r&&r.remove()}s&&(r=b("<div/>").hide().addClass(a.resultsClass).css("position","absolute").appendTo(document.body),l=b("<ul/>").appendTo(r).mouseover(function(e){h(e).nodeName&&"LI"==h(e).nodeName.toUpperCase()&&(n=b("li",l).removeClass(m.ACTIVE).index(h(e)),b(h(e)).addClass(m.ACTIVE))}).click(function(e){b(h(e)).addClass(m.ACTIVE);f();c.focus();return!1}).mousedown(function(){g.mouseDownOnSelect=!0}).mouseup(function(){g.mouseDownOnSelect=!1}),0<a.width&&r.css("width",
a.width),s=!1,e())}function h(e){for(e=e.target;e&&"LI"!=e.tagName;)e=e.parentNode;return!e?[]:e}function e(e){k.slice(n,n+1).removeClass(m.ACTIVE);n+=e;0>n?n=k.size()-1:n>=k.size()&&(n=0);e=k.slice(n,n+1).addClass(m.ACTIVE);if(a.scroll){var c=0;k.slice(0,n).each(function(){c+=this.offsetHeight});c+e[0].offsetHeight-l.scrollTop()>l[0].clientHeight?l.scrollTop(c+e[0].offsetHeight-l.innerHeight()):c<l.scrollTop()&&l.scrollTop(c)}}var m={ACTIVE:"ac_over"},k,n=-1,p,q="",s=!0,r,l;return{display:function(e,
c){d();p=e;q=c;l.empty();for(var f=a.max&&a.max<p.length?a.max:p.length,g=0;g<f;g++)if(p[g]){var h=a.formatItem(p[g].data,g+1,f,p[g].value,q);!1!==h&&(h=b("<li/>").html(a.highlight(h,q)).addClass(0==g%2?"ac_even":"ac_odd").appendTo(l)[0],b.data(h,"ac_data",p[g]))}k=l.find("li");a.selectFirst&&(k.slice(0,1).addClass(m.ACTIVE),n=0);b.fn.bgiframe&&l.bgiframe()},next:function(){e(1)},prev:function(){e(-1)},pageUp:function(){0!=n&&0>n-8?e(-n):e(-8)},pageDown:function(){n!=k.size()-1&&n+8>k.size()?e(k.size()-
1-n):e(8)},hide:function(){r&&r.hide();k&&k.removeClass(m.ACTIVE);n=-1},visible:function(){return r&&r.is(":visible")},current:function(){return this.visible()&&(k.filter("."+m.ACTIVE)[0]||a.selectFirst&&k[0])},show:function(){var e=b(c).offset();r.css({width:"string"==typeof a.width||0<a.width?a.width:b(c).width(),top:e.top+c.offsetHeight,left:e.left}).show();if(a.scroll&&(l.scrollTop(0),l.css({maxHeight:a.scrollHeight,overflow:"auto"}),b.browser.msie&&"undefined"===typeof document.body.style.maxHeight)){var d=
0;k.each(function(){d+=this.offsetHeight});e=d>a.scrollHeight;l.css("height",e?a.scrollHeight:d);e||k.width(l.width()-parseInt(k.css("padding-left"))-parseInt(k.css("padding-right")))}},selected:function(){var e=k&&k.filter("."+m.ACTIVE).removeClass(m.ACTIVE);return e&&e.length&&b.data(e[0],"ac_data")},emptyList:function(){l&&l.empty()},unbind:function(){r&&r.remove()}}};b.Autocompleter.Selection=function(a,c,b){if(a.createTextRange){var g=a.createTextRange();g.collapse(!0);g.moveStart("character",
c);g.moveEnd("character",b);g.select()}else a.setSelectionRange?a.setSelectionRange(c,b):a.selectionStart&&(a.selectionStart=c,a.selectionEnd=b);a.focus()}})(jQuery);
(function(b){b.fn.tipTip=function(a){var c=b.extend({activation:"hover",keepAlive:!1,maxWidth:"200px",edgeOffset:3,defaultPosition:"bottom",delay:100,fadeIn:200,fadeOut:200,attribute:"title",content:!1,enter:function(){},exit:function(){}},a);if(0>=b("#tiptip_holder").length){var f=b('<div id="tiptip_holder" style="max-width:'+c.maxWidth+';"></div>'),g=b('<div id="tiptip_content"></div>'),d=b('<div id="tiptip_arrow"></div>');b("body").append(f.html(g).prepend(d.html('<div id="tiptip_arrow_inner"></div>')))}else f=
b("#tiptip_holder"),g=b("#tiptip_content"),d=b("#tiptip_arrow");return this.each(function(){var a=b(this),e=c.content?c.content:a.attr(c.attribute);if(""!=e){c.content||a.removeAttr(c.attribute);var m=!1;"hover"==c.activation?(a.hover(function(){k()},function(){c.keepAlive||n()}),c.keepAlive&&f.hover(function(){},function(){n()})):"focus"==c.activation?a.focus(function(){k()}).blur(function(){n()}):"click"==c.activation&&(a.click(function(){k();return!1}).hover(function(){},function(){c.keepAlive||
n()}),c.keepAlive&&f.hover(function(){},function(){n()}));var k=function(){c.enter.call(this);g.html(e);f.hide().removeAttr("class").css("margin","0");d.removeAttr("style");var k=parseInt(a.offset().top),n=parseInt(a.offset().left),s=parseInt(a.outerWidth()),r=parseInt(a.outerHeight()),l=f.outerWidth(),v=f.outerHeight(),w=Math.round((s-l)/2),t=Math.round((r-v)/2),x=Math.round(n+w),y=Math.round(k+r+c.edgeOffset),u="",z="",A=Math.round(l-12)/2;"bottom"==c.defaultPosition?u="_bottom":"top"==c.defaultPosition?
u="_top":"left"==c.defaultPosition?u="_left":"right"==c.defaultPosition&&(u="_right");var B=w+n<parseInt(b(window).scrollLeft()),C=l+n>parseInt(b(window).width());if(B&&0>w||"_right"==u&&!C||"_left"==u&&n<l+c.edgeOffset+5)u="_right",z=Math.round(v-13)/2,A=-12,x=Math.round(n+s+c.edgeOffset),y=Math.round(k+t);else if(C&&0>w||"_left"==u&&!B)u="_left",z=Math.round(v-13)/2,A=Math.round(l),x=Math.round(n-(l+c.edgeOffset+5)),y=Math.round(k+t);n=k+r+c.edgeOffset+v+8>parseInt(b(window).height()+b(window).scrollTop());
s=0>k+r-(c.edgeOffset+v+8);if(n||"_bottom"==u&&n||"_top"==u&&!s)u="_top"==u||"_bottom"==u?"_top":u+"_top",z=v,y=Math.round(k-(v+5+c.edgeOffset));else if(s|("_top"==u&&s)||"_bottom"==u&&!n)u="_top"==u||"_bottom"==u?"_bottom":u+"_bottom",z=-12,y=Math.round(k+r+c.edgeOffset);if("_right_top"==u||"_left_top"==u)y+=5;else if("_right_bottom"==u||"_left_bottom"==u)y-=5;if("_left_top"==u||"_left_bottom"==u)x+=5;d.css({"margin-left":A+"px","margin-top":z+"px"});f.css({"margin-left":x+"px","margin-top":y+"px"}).attr("class",
"tip"+u);m&&clearTimeout(m);m=setTimeout(function(){f.stop(!0,!0).fadeIn(c.fadeIn)},c.delay)},n=function(){c.exit.call(this);m&&clearTimeout(m);f.fadeOut(c.fadeOut)}}})}})(jQuery);$.fn.tipTip=$.fn.tipTip||function(){return this};
var Influence={multiSources:0,ajaxExtraParams:{},ajaxRequests:{act_statement:[],offline:[],friends_act_statement:[],communities:[],generic:[]},username:"",logged_user:"",addTab:function(){return $("")},statement_paging_days:11,userTabWidth:100,uids:[],newfreshcontent:!0,ajaxTabs:!0,stressTest:0,statement_start_ts:0,statement_end_ts:0,widget_mode:!1,offline_tab_click:0,leaders:{1:{id:1,name:"Marketing",leaders:["@portergale","@markwschaefer","@wadds","@Hyken"]},285:{id:285,name:"C-Suite Execs",leaders:["@JeffreyHayzlett",
"@TheCMOclub"]},188:{id:188,name:"Sustainability",leaders:["@Zem"]},12:{id:12,name:"Social Media",leaders:"@2morrowknight jkcallas @Gabriellenyc @petershankman @Ekaterina @LeeBogner".split(" ")},251:{id:251,name:"Music",leaders:["@jessicanorthey"]},287:{id:287,name:"CelebrityNews",leaders:["@shiralazar","@JoshEstrin"]},233:{id:233,name:"Health",leaders:["@DrAndyBaldwin","@johnnosta"]},7:{id:7,name:"Travel",leaders:["@anntran_","@CharlesYap"]},18:{id:18,name:"Comedy",leaders:["@BenTheMorrison"]},186:{id:186,
name:"Artists",leaders:["@Gaby407"]},294:{id:294,name:"Nonprofit",leaders:[{leader:"@hardlynormal",avatar:"/components/com_pages/views/images/kred/hardlynormal.png",bio:"In 2008, Mark Horvath, now known to many as @hardlynormal, set out to film the stories of America's homeless and share them with as many people as possible on InvisiblePeople.tv. Since then, he has become an internationally recognized activist and ambassador for the millions of individuals and families who reside in shelters, motels, tents along the streets and under highway bridges across the country."}]},
1105:{id:1105,name:"Education",leaders:[{leader:"angelamaiers",avatar:"/components/com_pages/views/images/kred/angelamaiers.png",bio:"Angela Maiers is an educator, speaker, consultant, and professional trainer known for her work in literacy, leadership and global communications. She has spent more than 20 years working in elementary, middle, and university settings as a classroom teacher, reading specialist, coach, special programs facilitator, and university professor. Angela believe that these 2 words can change the world - You Matter."}]},
234:{id:234,name:"Tech",leaders:["@shiraabel","@zaibatsu"]},185:{id:185,name:"Radio",leaders:["@Barzhini","@tonyahallradio"]},1364:{id:1364,name:"Personal Development",leaders:["@lorimoreno"]},14:{id:14,name:"Bloggers",leaders:["@kodakCB"]},189:{id:189,name:"Advertising",leaders:["@LeeBogner"]}},leadernames:[],init:function(){console.log("ATN: init");var b=this;$.browser.mozilla&&$("body").addClass("mozilla");$.ajaxSetup({data:b.ajaxExtraParams});$.each(Influence.leaders,function(a,c){$.each(c.leaders,
function(c,a){"string"!==typeof a&&(a=a.leader);Influence.leadernames.push(a.replace(/@/,"").toLowerCase())})});this.init_events();this.init_tabs();b.stressTest&&this.startTest();2>~~($.cookie("kredshieldcallout")||0)?$(".homepage-kred-popup").fadeIn():$(".homepage-kred-popup").fadeOut();$("#ajaxMsg").ajaxError(function(a,c,f,g){console.log("exception: ",g);if("abort"!=g){var d=$("#ajaxMsg");b.removeAjaxErrorTimeout&&clearTimeout(b.removeAjaxErrorTimeout);d.html("<p>- Server Busy -</p>").show();b.removeAjaxErrorTimeout=
setTimeout(function(){d.fadeOut()},1E4)}})},init_tabs_events:function(){var b=this;$("#search-at-name form").submit(function(a){a.preventDefault();a=$(this).find('input[name="another-name"]');var c=a.val().replace("@","");a.val("");b.search(c);return!1});$("#txt-container").click(function(a){$(a.target).is("input")||$("#search-at-name form").trigger("submit")});$(".top-user-name .tab_label").live("click",function(){var a=$(this).closest(".top-user-name"),c=a.attr("source");b.showAvailableSubtabs(c);
$(".top-user-name").not(a).removeClass("current");a.addClass("current");b.multiSources?$.cookie("NlastUidIndex",a.index()):$.cookie("lastUidIndex",a.index());$(".tabcontent.active").removeClass("active");a=a.attr("uid");c=$('.tabcontent[uid="'+a+'"]');c.length?c.addClass("active"):b.addTab(a).addClass("active")});$(".top-user-name .close").live("click",function(){var a=$(this).closest(".top-user-name"),c=a.attr("uid"),f=a.attr("source");if(b.multiSources){var g=b.NgetLastUidIndex(),d=b.Nuids[g].uid,
h=-1;$.each(b.Nuids,function(e,c){-1==h&&c.uid==d&&(h=e)})}else g=b.getLastUidIndex(),d=b.uids[g],h=$.inArray(c,b.uids);a.remove();$('.tabcontent[uid="'+c+'"]').remove();h==g?h==(b.multiSources?b.Nuids.length-1:b.uids.length-1)?$(".top-user-name").eq(h-1).find(".tab_label").click():$(".top-user-name").eq(h).find(".tab_label").click():$('.top-user-name[uid="'+d+'"]').find(".tab_label").click();$("#tiptip_holder:visible").hide();b.multiSources?b.NremoveUid(c,f):b.removeUid(c);b.squeezeTabs()})},init_tabs:function(){console.log("ATN: init_tabs");
var b=this;b.show_moremenu();if(b.multiSources){this.NgetSavedUids();var a=b.NgetLastUidIndex();if(window.active_account){var c=window.active_account.foreign_uid,f=window.active_account.source,g=window.active_account.username;"facebook"==f&&(c="fb"+c);var d=-1;$.each(b.Nuids,function(e,a){a.uid==c&&a.source==f&&(d=e)});-1==d&&(b.NaddUid(c,f,g),a=0)}var h;$.each(b.Nuids,function(e,c){var d=b.addTabLabel(c.uid,c.source,c.name);if(b.subpage)switch(b.subpage){case "more":logged_usr.id?window.active_account&&
c.uid==window.active_account.foreign_uid&&(b.addTab(c.uid),d.find(".tab_label").trigger("click"),h=c.uid):e==a&&(b.addTab(c.uid),d.find(".tab_label").trigger("click"),h=c.uid);break;default:e==a&&(b.addTab(c.uid),d.find(".tab_label").trigger("click"),h=c.uid)}})}else{this.getSavedUids();var e=b.getLastUidIndex();window.active_account&&(c=window.active_account.foreign_uid,-1==$.inArray(c,b.uids)&&(b.addUid(c),e=0));$.each(b.uids,function(c,a){var d=b.addTabLabel(a,"twitter");if(b.subpage)switch(b.subpage){case "more":logged_usr.id?
window.active_account&&a==window.active_account.foreign_uid&&(b.addTab(a),d.find(".tab_label").trigger("click"),h=a):c==e&&(b.addTab(a),d.find(".tab_label").trigger("click"),h=a);break;default:c==e&&(b.addTab(a),d.find(".tab_label").trigger("click"),h=a)}})}setTimeout(function(){if("landing"!=b.subpage&&b.subpage){var e=$.inArray(h,b.uids),c=b.uids.slice(0);c.splice(e,1);$.each(c,function(e,c){setTimeout(function(){0==$('.tabcontent[uid="'+c+'"]').length&&(b.addTab(c),console.log("preload: "+c))},
3E3*e)})}},5E3);b.squeezeTabs()},updateStatementsTs:function(b){function a(){var c,a=new Date;c=a.getMonth()+1;var g=a.getDate(),d=a.getFullYear(),h=a.getHours(),a=a.getMinutes();c=c+"/"+g+"/"+d+" "+(12!=h?h%12:h)+":"+(10>a?"0"+a:a)+" "+(11<h?"PM":"AM");$(".statements",b).data("paging");$(".activity_update",b).html("<span>Updated: "+c+"</span>")}a();this.updateInt&&clearInterval(this.updateInt);this.updateInt=setInterval(a,6E4)},squeezeTabs:function(){var b=$("#overview-top").width(),a=$("#search-at-name").outerWidth(),
b=(b-a-40)/$(".top-user-name").length;this.setTabsWidth(b-10-15-15)},setTabsWidth:function(b){b=Math.min(b,140);50>b?$("#overview-top").addClass("squished"):$("#overview-top").removeClass("squished");$(".top-user-name").css("width",b+"px")},getSavedUids:function(){var b=$.cookie("uids");b&&(this.uids=parseJSON(b));$.isArray(this.uids)||(this.uids=[this.uids])},saveUids:function(){$.cookie("uids",toJSON(this.uids))},addUid:function(b){-1==$.inArray(b,this.uids)&&(window.active_account&&b==window.active_account.foreign_uid?
this.uids.unshift(b):this.uids.push(b),this.saveUids())},removeUid:function(b){b=$.inArray(b,this.uids);-1<b&&(this.uids.splice(b,1),this.saveUids())},getLastUidIndex:function(){var b=$.cookie("lastUidIndex");return b?parseInt(b):this.uids.length-1},NgetSavedUids:function(){var b=$.cookie("Nuids");b&&(this.Nuids=parseJSON(b));$.isArray(this.Nuids)||(this.Nuids=[])},NsaveUids:function(){$.cookie("Nuids",toJSON(this.Nuids))},NaddUid:function(b,a,c){var f=-1;c||(c="");$.each(this.Nuids,function(c,d){d.uid==
b&&d.source==a&&(f=c)});-1==f&&a&&(this.Nuids.push({uid:b,source:a,name:c}),this.NsaveUids())},NremoveUid:function(b,a){var c=-1;$.each(this.Nuids,function(f,g){g.uid==b&&g.source==a&&(c=f)});-1<c&&(this.Nuids.splice(c,1),this.NsaveUids())},NgetLastUidIndex:function(){var b=$.cookie("NlastUidIndex");return b?parseInt(b):this.Nuids.length-1},getUserLocation:function(b){window.GeoLocation&&window.GeoLocation.get(function(a){"UK"==a.geoip_country_code?($(".celebs li[location=all]").hide(),$(".celebs li[location=uk]").show()):
($(".celebs li[location=all]").show(),$(".celebs li[location=uk]").hide());b&&b()})},init_landing:function(){console.log("ATN: init_landing");var b=this;b.getUserLocation(function(){function c(){window.logged_usr&&window.logged_usr.active&&window.logged_usr.active.foreign_uid?b.showCeleb(window.logged_usr.active.foreign_uid):setTimeout(c,200)}$(".celebs li:visible").eq(0).attr("uid");c()});try{if(logged_usr.id&&window.active_account){var a=window.active_account.username;"twitter"==window.active_account.source&&
(a="@"+a);$(".landing_atname").text(a)}}catch(c){}this.addTab=function(){return $("")};this.showCeleb=function(c){$("#inside-container").empty();$("#landing_profile").length&&$("#landing_profile").tmpl({name:c}).attr("uid",c).prependTo("#inside-container").find(".tabcontent").addClass("active");var a=!1;window.logged_usr&&window.logged_usr.active&&(a=window.logged_usr.active.foreign_uid===c);$(".tabcontent").find(".influencer-profile").empty().append($("#big_shield").tmpl({name:c,ownTab:a}));$.getScript("//assets.pinterest.com/js/pinit.js");
$(".big_shield.stars-profile .stars > span").tipTip();a=$(".tabcontent");this.getBadge(c,"twitter",function(a){var b=$(".tabcontent"),e="http://api.twitter.com/1/users/profile_image?size=normal&screen_name="+c;$(".avatar",b).attr("src",e);$(".real_name",b).html(a.userhash.u_nm);$("p.biography",b).html(a.userhash.bio);b.find(".spinner").hide();$.post("/ajax/?method=influence.getCommunities",{username:c},function(e){e=e.slice(0,4);for(var k=[],g=0;4>g;g++){var p=e[g]||{},q;q=c.toLowerCase()===window.logged_usr.active.foreign_uid.toLowerCase()?
'<td><div class="share tweet" /><div class="share facebook" /></td>':'<td><div class="addpluskr" /></td>';k.push(p.name?'<td class="comm" data-commid="'+p.id+'" data-nid="'+a.userhash.u_id+'" data-commscore=\'{"user_inf":"'+p.user_inf+'","user_out":"'+p.user_out+"\"}'>"+p.name+'</td><td class="count">'+(p.plus?"+"+p.plus.count:0)+q:'<td class="comm"></td><td></td><td></td>')}k="<tr>"+k[0]+k[1]+"</tr><tr>"+k[2]+k[3]+"</tr>";$(".pluskr table",b).html(k);0===e.length&&$(".pluskr.landing",b).hide()},
"json")},a);a=$(".tabcontent");parseInt((new Date).getTime()/1E3);b.ajaxExtraParams.fetch="all";$.ajaxSetup({data:b.ajaxExtraParams});b.getTransactions(c,a);b.getTransactionCount(c)};$("ul.celebs li a").click(function(){var c=$(this).attr("href").split("/").pop();b.showCeleb(c);return!1});$("#overview-wrapper ul li").mouseover(function(){var c=$(this).attr("name");$("#"+c).is(":visible")||($("#tabs-details > div").filter(":animated").hide().end().fadeOut(),$("#"+c).stop(!0,!0).fadeIn())}).first().trigger("mouseover");
$(".search-form form").submit(function(c){(c=$(".atname",this).val().replace(/@/,""))?window.location="http://kred.com/"+c:$(".search-form form").find(".atname").focus();return!1});$(".signintrigger").click(function(){$("#loginbar a").trigger("click");return!1});$(".partners a").click(function(){var c=$(this).attr("href").match(/\/([^\/]+)$/)[1];Popup.open({type:"infl-kred",uid:c,backgr_col:"#fff"});return!1});$(".celeb-picker li").tipTip({defaultPosition:"bottom"})},init_overview:function(){console.log("ATN: init_overview");
var b=this;this.init_gift();$(".ra-wrapper .act-title a").live("click",function(){var a=$(this).closest(".tabcontent").attr("uid");b.loadAjaxTab("activity",a);return!1});$(".influencer-communities span.dropper").live("click",function(){$(this).closest("span").toggleClass("active");$("ul",this).slideToggle();return!1});this.addTab=function(a){var c=!1;window.logged_usr&&window.logged_usr.active&&(c=window.logged_usr.active.foreign_uid===a);console.log("ADDING TAB: ",a);var f=b.getUserRecord(a);b.ajaxExtraParams.fetch=
"all";$.ajaxSetup({data:b.ajaxExtraParams});var g="@"+a;"twitter"!=f.source&&(g=f.name);var d=$("#user_profile").tmpl({name:g,showshieldcallout:2>~~$.cookie("kredshieldcallout"),ownTab:c}).attr("uid",a).appendTo("#inside-container");$('.tabcontent[uid="'+a+'"]').find(".shield_outer").empty().append($("#big_shield").tmpl({name:a,ownTab:c}));$.getScript("//assets.pinterest.com/js/pinit.js");$(".guide-infl li",d).tipTip({defaultPosition:"top"});$(".kred-services .service.linkedin",d).tipTip();$(".kred-services .facebook").click(function(){window.location=
"http://kred.com/identity"});c?$('.tabcontent[uid="'+a+'"]').find(".pluskr-info").hide():$('.tabcontent[uid="'+a+'"]').find(".pluskr-info").show();"twitter"!=f.source?$(".switcher",d).hide():$(".switcher",d).show();b.getBadge(a,f.source,function(c){$(".top_comm",d).find("ul").remove();$.post("/ajax/?method=influence.getCommunities",{username:a},function(e){e=e.slice(1,4);for(var b=[],f=0;4>f;f++){var g=e[f]||{},p;p=a===window.logged_usr.active.foreign_uid?'<td><div class="share tweet" /><div class="share facebook" /></td>':
'<td><div class="addpluskr" /></td>';b.push(g.name?'<td class="comm" data-commid="'+g.id+'" data-nid="'+c.userhash.u_id+'" data-commscore=\'{"user_inf":"'+g.user_inf+'","user_out":"'+g.user_out+"\"}'>"+g.name+'</td><td class="count">'+(g.plus?"+"+g.plus.count:0)+p:'<td class="comm"></td><td></td><td></td>')}b="<tr>"+b[0]+b[1]+"</tr><tr>"+b[2]+b[3]+"</tr>";$(".pluskr table",d).html(b);0===e.length&&$(".influencer-details .pluskr",d).hide()},"json")},d);$(".statements").length&&(b.getTransactions(a,
d),b.getTransactionCount(a));c=0.987654321<Math.random()?"splines reticulated":"streams analyzed";$(".top_infl, .top_out",d).find("ul").html('<li><center>It will take a few minutes to load all the data.<br/><span class="beancounter">0</span> '+c+"</center></li>");setTimeout(function(){var c=$(".beancounter",d);c.length&&c.each(function(c){c=$(this);var a=~~c.text();c.text(++a)})},30);return d}},init_activity:function(b){console.log("ATN: init_activity");var a=this;$(".activity-earn-now .close-callout").live("click",
function(c){c.stopPropagation();$(this).closest(".activity-earn-now").slideUp().prev(".open-callout").show();$(this).closest(".tabcontent").find(".activity_panel_inner").removeClass("callout-expanded")});$(".open-callout").live("click",function(c){$(this).hide().next(".activity-earn-now").slideDown();$(this).closest(".tabcontent").find(".activity_panel_inner").addClass("callout-expanded")});$(".show-activity ul li").live("click",function(){var c=$(this),b=$(this).text();$(this).closest(".show-activity").find(".show-activity-title").text(b);
var b=a.multiSources?a.Nuids[a.NgetLastUidIndex()].uid:a.uids[a.getLastUidIndex()],g=$('.tabcontent[uid="'+b+'"]'),d=parseInt($(this).attr("ts")),h=$(".statements",g).data("paging_max_days")||10,h=d-86400*h;1===c.index()?(h=1,d=parseInt((new Date).getTime()/1E3),$(".statements",g).data("realtime",1)):$(".statements",g).data("realtime",0);a.killAjaxRequests("act_statement");a.getTransactions(b,g,h,d,!1,null,a.selected_comm_id);$(".show-activity ul").fadeOut();c.addClass("ticked").siblings().removeClass("ticked")});
$(".show-activity-title , .show-activity .kred-drp-down").die("click").live("click",function(){$(".show-activity ul").toggle()});$(".show-community-title , .show-community .kred-drp-down").die("click").live("click",function(){$(".show-community ul").toggle()});$(".fetch li").die("click").live("click",function(){var c=$(this).attr("fetch"),b=$(".fetch li").length,g=$(".fetch li.active").length;if($(this).is(".active")){if(1==g)return!1;$(this).removeClass("active");1<g&&(c=$(".fetch li.active").not($(this)).eq(0).attr("fetch"))}else $(this).addClass("active"),
b==g+1&&(c="all");b=a.multiSources?a.Nuids[a.NgetLastUidIndex()].uid:a.uids[a.getLastUidIndex()];g=$('.tabcontent[uid="'+b+'"]');console.log("fetch:",c);a.ajaxExtraParams.fetch=c;$.ajaxSetup({data:a.ajaxExtraParams});a.getTransactions(b,g)});this.addTab=function(c,f){var g=!1;c===$(".yourTab").text().replace(/@/g,"")&&(g=!0);a.ajaxExtraParams.fetch="all";$.ajaxSetup({data:a.ajaxExtraParams});var d=a.getUserRecord(c),h="@"+c;"twitter"!=d.source&&(h=d.name);f||(f="#inside-container");d=$("#recent_activity").tmpl({name:h}).attr("uid",
c).appendTo(f);$(".statements").height(1500);g||$(".fetch_selector",d).remove();"friends"==b?a.getFriendsTransactions(d,c,50):(a.getTransactions(c,d),a.getTransactionCount(c),a.getOfflineTransactions(c,d),a.getVoteTransactions(c,d),a.getPlusTransactions(c,d),a.getRealtimeTransactions(c,d),$(".commsSelector li").live("click",function(e){e.stopImmediatePropagation();e=parseInt($(this).attr("comm_id"));var b=$(this).closest(".tabcontent");$(".commsSelector li.selected",b).removeClass("selected");$(this).addClass("selected");
var d=$(this).text().replace(/ *\(\d+\) */,"");$(".show-community-title",b).text(d);$(".getMoreTrans",b).text("More");a.selected_comm_id=e;a.getTransactions(c,b,null,null,!1,null,e);$(this).closest("ul").fadeOut()}));return d}},filterByCommunity:function(b,a){var c=$("#activity_statement_filter");if(b){$(".statements",a).addClass("filtering");var f;f=".filtering.show_infl .statement-direction-i.comm_"+b+","+(".filtering.show_outr .statement-direction-o.comm_"+b+" {display:block}");c.text(f)}else $(".statements",
a).removeClass("filtering"),c.empty()},getTransactionCount:function(b,a){var c=this;c.ajaxRequests.generic.push($.ajax({url:"/ajax/?method=influence.getTransactionCount",dataType:"json",type:"POST",data:{username:b},success:function(f){var g=1;f&&(g=Math.min(Math.max(1,parseInt(c.settings.paging_factor/parseInt(f))),45));console.log("transactionCount:",f);console.log("max days:",g);f=$('.tabcontent[uid="'+b+'"]')||$(".tabcontent.active");$(".statements",f).data("paging_max_days",g);a&&a(g)}}))},getBadge:function(b,
a,c,f){var g=this,d=f||$('.tabcontent[uid="'+b+'"]');$(".outreach-max").text(g.settings.max_outreach_level);g.ajaxRequests.generic.push(InfluencePopup.ajax_get_users(b,a,"combined",function(e,b){d.find(".spinner").hide();var f={id:0,user_inf:"object"==typeof e.group?e.group.score:e.values.score,user_out:"object"==typeof e.group?e.group.level:e.values.level,influence:"object"==typeof e.group?e.group.influence:e.values.influence,outreach:"object"==typeof e.group?e.group.outreach:e.values.outreach,name:"Global Kred"};
console.log("Global Kred:",f);$(".influencer-communities span.all",d).data("influencerscores",f);e.userhash.us?0<Influence.leadernames.length&&(-1!=Influence.leadernames.indexOf(e.userhash.us.replace(/@/,"").toLowerCase())?$(".influence-outreach",d).addClass("leader"):$(".influence-outreach.leader",d).removeClass("leader")):$(".influence-outreach.leader",d).removeClass("leader");$community=$("<li />",{text:f.name,comm_id:f.id});$(".badgecommselection ul.communities",d).prepend($community);$community.data("influencerscores",
f);var h={user_inf:0},p;for(p in e.comms)e.comms[p]&&(e.comms[p].user_inf&&e.comms[p].user_inf>h.user_inf)&&(h=e.comms[p]);$(".usr-det-kr",d).data("numeric_id",e.userhash.f_id);$(".usr-det-kr",d).data("source",e.userhash.src);h&&h.user_inf&&($(".influence-count",d).text(h.user_inf),$(".outreach-count",d).text(h.user_out),$(".top_community_score h4.community-name",d).text(h.name).tipTip(),$(".top_community_score .influence-score",d).text(h.user_inf),$(".top_community_score .outreach-score",d).text(h.user_out),
$(".global_score .influence-score",d).text(e.values.score),$(".global_score .outreach-score",d).text(e.values.level),f=d.find(".specificcommunity").text(),g.updateShareText(d,q,h.user_inf,h.user_out,f));f=$(".usr-det-kr",d);$(".usr-dtl").css("display","inline-block");e.userhash.bio&&$(".preview-biography",d).text("BIO: "+e.userhash.bio);switch(e.userhash.src){case "facebook":var q=e.userhash.u_nm;p=b.substring(2);f.find(".usr-img img").show().attr("src","http://graph.facebook.com/"+p+"/picture");
f.find(".atname").empty().hide();f.find(".username").text(q);f.find(".usr-dtl iframe").hide();break;case "twitter":q=e.userhash.us||UID;f.find(".usr-img img").show().attr("src","/ajax/?method=user.gettwavatar&size=bigger&screen_name="+q);f.find(".atname").show().html('<a href="http://kred.com/'+q+'">kred.com/'+q+'</a><span class="kredible">@'+q+'<span class="shield"></span></span>');f.find(".username").text(q).attr("title","@"+q);f.find(".usr-dtl iframe").show();break;default:q=e.userhash.us||UID,
f.find(".usr-img img").hide(),f.find(".username").text(q),f.find(".usr-dtl iframe").hide()}window!==window.top&&f.find(".atname a").attr("target","_blank");"twitter"==a&&g.getFlags(q);if(e.comms){$(".badgecommselection ul.communities",d).empty();var s=[];$.each(e.comms,function(c,e){s.push([c,e.user_inf])});s.sort(function(c,e){return e[1]-c[1]});var r="",l=$("#viral_comms").tmpl({name:q});l.find("tbody").empty();$(".influence-outreach",d).append(l);var v=e.comms;s.unshift([0]);v[0]={id:0,name:"Global Kred",
user_inf:e.values.score,user_out:e.values.level};$.each(s,function(c,a){var b=v[a[0]],f=$("#viral_comms_row").tmpl(b);l.find(".communities tbody").append(f);f.data("influencerscores",b);f.data("nid",e.userhash.u_id);f=$("<li />",{"data-influence":b.user_inf,"data-outreach":b.user_out,text:b.name,comm_id:b.id});"Global Kred"===b.name?$(".badgecommselection ul.communities",d).prepend(f):$(".badgecommselection ul.communities",d).append(f);f.data("influencerscores",b);f="<li><a target='blank' href='http://kred.com/community#"+
b.id+"'>"+b.name+"</a></li>";r="Global Kred"===b.name?f+r:r+f;r+="<li><a target='blank' href='http://kred.com/community#"+b.id+"'>"+b.name+"</a></li>"});Influence.comms_info&&$.each(Influence.comms_info,function(c,a){if(!l.find(".name:contains("+a.name+")").length){var b={name:a.name,id:a.id,user_inf:0,user_out:0},d=$("#viral_comms_row").tmpl(b);l.find(".communities tbody").append(d);d.data("nid",e.userhash.u_id);d.data("influencerscores",b)}});$('.badgecommselection ul.communities input[type="radio"]',
d).length&&$(".badgecommselection ul.communities li:contains(Global Kred)",d).prepend('<input type="radio" name="preferredcommunity" value="0" />');window.logged_usr&&($(d).closest(".tabcontent").attr("uid")===logged_usr.active.foreign_uid&&0===$(".landing").length)&&$(".badgecommselection ul.communities",d).tipTip({defaultPosition:"left"});0===$(".badgecommselection ul li :checked").length&&$(".badgecommselection ul.communities input:first",d).attr("checked","checked");1<$(".badgecommselection ul li").length&&
($(".halp",d).show().tipTip(),$(".badgecommselection",d).show());r="<ul>"+r+"</ul>";$(".top_comm",d).find("ul").remove();$(".top_comm",d).append(r);$(".top_comm .infl_list_head",d).tipTip({maxWidth:"300px",delay:200,defaultPosition:"top"});var w=$(),f=$(),t=$();"twitter"==a&&InfluencePopup.getPreferredCommunity(q,null,function(c){h=c});$(".badgecommselection ul.communities",d).find(" li").each(function(){var c=$(this);if(c.data("influencerscores")){if(c.text()===h)return t=c,!1;"0"===c.attr("comm_id")&&
(w=c)}});t.length?t.trigger("click"):f.length?f.trigger("click"):w.trigger("click");"twitter"==a&&(g.getCommunityVotes(q),g.getPlusCommSummary(e.userhash.u_id,d))}c&&c(e)}));var h=window.logged_usr&&0<logged_usr.id;h||$(".switcher .offlinekred",d).hide();g.ajaxRequests.offline.push($.ajax({url:"/ajax/?method=influence.getOfflineTransactions",dataType:"json",type:"POST",data:{username:b},success:function(c){var a=$(".big_shield ul.offline",d);console.log("processing offline data");(c&&c.length||h)&&
$(".switcher .offlinekred",d).show();if(c&&c.length){a.removeClass("tell").empty();var f=!1,g=0;$.each(c,function(c,e){if(1<g)f=!0;else if("assigned"===e.status){var b=new Date(e.ts);[b.getMonth(),b.getDay(),b.getYear()].join("/");b=$("<span />",{text:e.name,title:e.name,"class":"titlespan"}).wrap("<p />").parent();"1"!=e["private"]&&e.filename?$("<a />",{target:"_blank",href:"/?option=com_pages&view=kr_offline&filename="+e.filename,"class":"certificate",html:'<img src="http://pbcdn.peoplebrowsr.com/components/com_pages/views/images/kred/certificate.png"  title="Click to see certificate"/>'}).prependTo(b):
b.prepend('<img src="http://pbcdn.peoplebrowsr.com/components/com_pages/views/images/kred/certificate.png" title="Waiting for certificate" />');b=$("<li />").prepend(b);a.append(b);g++}});f&&a.append('<li><p class="seemore" title="Click to see more">See more...</li></p>');a.find("li p span.titlespan").tipTip();a.find("li p img").tipTip()}0===a.find("li").length&&(window.logged_usr&&($(d).closest(".tabcontent").attr("uid")===logged_usr.active.username||$(d).closest(".tabcontent").attr("uid")===logged_usr.active.foreign_uid)?
c='<li><p class="addoffline unkredible">Add your Offline Kred!</p></li>':(c='<li class="unkredible"><p class="addoffline unkredible">Ask @'+b+" to add Offline Kred</p></li>",a.addClass("tell")),a.append(c))}}))},getPlusCommSummary:function(b,a){this.ajaxRequests.generic.push($.ajax({url:"/ajax/?method=influence.getPlusCommSummary",dataType:"json",type:"POST",data:{nid:b},success:function(c){var b=$(".badgecommselection li",a);"object"==$.type(c)&&$.each(c.data,function(c,a){var h="data-plus-"+a.direction;
b.attr(h,0).each(function(){var c=$(this),b=c.text();$.each(a.comm_counts,function(a,d){if(b===d.name)return c.attr(h,d.tot),!1})});b.first().attr(h,a.tot)});b.filter(".active").trigger("click")}}))},getCommunityVotes:function(b){b=b.toLowerCase();$('.tabcontent[uid="'+b+'"]');var a=$('.tabcontent[uid="'+b+'"] .badgecommselection');this.ajaxRequests.generic.push($.ajax({url:"/ajax/?method=influence.getCommsVotes",dataType:"json",type:"POST",data:{username:b},success:function(c){$.each(c,function(c,
b){var d=$("li[comm_id="+b.comm_id+"]",a);if(d.length){var h=d.data("influencerscores");b.count&&(b.stars=Math.round(b.sum/b.count));h.vote=b;d.data("influencerscores",h)}})}}))},updateShareText:function(b,a,c,f,g){a||(a=$(".influence-outreach .username:visible:first").text());var d;d=window.active_account&&a.toLowerCase()==window.active_account.username.toLowerCase()?"According to @Kred my score is ":"According to @Kred @"+a+" has a score of ";d+=c+" and an Outreach level of "+f;g&&("Global Kred"===
g&&(g="the Global Community"),d+=" in "+g);d+=", view your score at Kred.com";a=Influence.widget_mode?'<a href="https://twitter.com/share" class="twitter-share-button" data-url="kred.com/'+a+'" data-text="'+d+'" data-count="none">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js">\x3c/script>':'<a href="" class="tweet-badge" data-text="'+d+'">Tweet</a>';b.find(".badge-tw-button, .scores-share-twitter").html(a);b.find(".share-badge").data("share_msg",d)},getVIPs:function(b,
a,c,f){return"deprecated?"},getStats:function(b){var a=$('.tabcontent[uid="'+b+'"]');this.ajaxRequests.generic.push($.ajax({url:"/ajax/?method=influence.getData",dataType:"json",type:"POST",data:{uid:b},success:function(c){if(c){var b=["links","reply","rt","mention","flwrs"];$.each(["in","out"],function(g,d){$.each(b,function(b,e){var f=e+"_"+d;$("."+f,a).find(".counter").text(InfluencePopup.humanise(c[f]))})})}}}))},init_morekred:function(){function b(){var c=$(".highest-offline-kred.zoom").removeClass("zoom");
c.find("img").css("max-width",259);c.find(".zoomer").css({left:0,top:0});$("#generaldarkness").remove()}console.log("ATN: init_morekred");var a=this;$("a.shinyaddoffline, .more-offline-wrapper .add-your, .add-offline-type").live("click",function(){$("body, html").animate({scrollTop:$('a[name="addnowform"]').offset().top-200},600);return!1});$("#kr_popup_offline_button").live("click",function(){Popup.close();$("a.addnow").click()});$("#offline-ufile").change(function(){$("#offline-ufile-button").removeClass("notyetactive")});
$(".blind .close").live("click",function(){$(this).closest(".blind").find(".deets").fadeToggle();return!1});$(".more-offline-slide").live("click",function(c){c.preventDefault();Popup.open({type:"url",url:"http://www.slideshare.net/slideshow/embed_code/10386738"})});$(".more-online-button").live("click",function(){location.hash="online";$(".more-offline-wrapper, .more-slides-button").hide();$(".more-online-wrapper").show();$(".more-online-button").addClass("chosen");$(".more-offline-button").removeClass("chosen")});
$(".more-offline-button").live("click",function(){location.hash="offline";$(".more-online-wrapper").hide();$(".more-offline-wrapper, .more-slides-button").show();$(".more-offline-button").addClass("chosen");$(".more-online-button").removeClass("chosen");if(0==Influence.offline_tab_click){Influence.offline_tab_click=1;var c=window.active_account.username;window.active_account&&"twitter"==window.active_account.source&&(c="@"+c);$("#kr_offline_click_popup").find(".kr_popup_content_header").text("Hi "+
c)}});$(".freshcontent .retweet, .freshcontent .reply").live("click",function(){function c(){Banner.postbox.bind("onAfterPosting",function(){b.fadeOut(1E3,function(){b.remove()})});var c=a.multiSources?a.Nuids[a.NgetLastUidIndex()].uid:a.uids[a.getLastUidIndex()];window.active_account&&c==window.active_account.foreign_uid?Banner.openPostbox(g):Banner.openPostbox("@"+c+" "+g)}var b=$(this).closest(".fresh"),g="RT"+(b.find(".name").text()+" ")+b.find(".tweet .post").text();logged_usr.accounts.twitter?
c():(c(),logged_usr.start())});$(".influencer .close_infl").live("click",function(){var c=$(this).closest(".influencer");c.fadeOut(1E3,function(){c.remove()})});$(".freshcontent .close_fresh").live("click",function(){var c=$(this).closest(".fresh");c.fadeOut(1E3,function(){c.remove()})});$("#score-table-sw").live("click",function(){$(this).toggleClass("active");$("#score-table").slideToggle()});$(".highest-offline-pluskred").live("click",function(){var c=$(this),a=c.closest(".tabcontent"),b=c.data("community_id")||
0,d=c.data("community")||"Global",a=c.data("numeric_id")||$(".usr-det-kr",a).data("numeric_id"),h=c.closest(".highest-offline-kred").find(".highest-offline-atname").text();c.fadeTo(500,0.4);$.post("/ajax/?method=influence.saveCommunityPlus",{comm_id:b,numeric_id:a,source:"twitter"},function(e){e=parseInt(e);-1===e?alert("You have already given this user +Kred in this community"):1<e?(e=["I gave @",h," +Kred in ",d," community influence http://kred.com/?pkid=",e].join(""),Banner.openPostbox(e)):(alert("There has been a problem awarding this +Kred. Please try again."),
c.fadeTo(500,1))})});$(".highest-offline-photo a").live("click",function(){var c=$(this),a=c.find("img"),c=c.closest(".highest-offline-kred");if(c.is(".zoom"))return!1;var g=a.prop("naturalWidth");c.addClass("zoom");g?a.animate({"max-width":g}):a.attr({"max-width":"none"});g-=a.width();a=a.prop("naturalHeight")-a.height();$(".zoomer",c).animate({left:-g,top:-a});$("#generaldarkness").remove();$('<div id="generaldarkness" />').appendTo("#influnecy-wrapper").show().click(b);$.getScript("//assets.pinterest.com/js/pinit.js");
return!1});$(".viralsocial .badge-fb-button").live("click",function(c){c.preventDefault();c.stopPropagation();c="kred.com/"+$(this).closest(".tabcontent").find(".username").text();window.open("http://www.facebook.com/sharer.php?s=100&p[url]="+encodeURIComponent("http://"+c)+"&p[title]="+encodeURIComponent("view your score at Kred.com")+"&p[summary]="+encodeURIComponent(c),"sharer","toolbar=0,status=0,width=626,height=436")});this.addTab=function(c){var b=!1;c===$(".yourTab").text().replace(/@/g,"")&&
(b=!0);var g=$("#morekred").tmpl({name:c,owntab:b}).attr("uid",c).appendTo("#inside-container");a.addBadge($('.tabcontent[uid="'+c+'"]').find(".shield_outer").empty(),c);"#offline"===location.hash&&$(".more-offline-button").trigger("click");(function(){var a=[{kind:"degree",copy:"+ Add Your Degree"},{kind:"sport",copy:"+ Add Your Sport"},{kind:"membership",copy:"+ Add Your Membership"},{kind:"ceremony",copy:"+ Add A Ceremony"},{kind:"charity",copy:"+ Add A Charity"},{kind:"frequent-flyer",copy:"+ Add Your Freq Flyer"}].sort(function(c,
a){return Math.random()-0.5}),b=[{title:"BarackObama",nid:813286,img:"/components/com_pages/views/images/kred/offline-eg-obama.png",openable:!1,points:"500,000",achievement:"President of the United States"},{title:"Ladygaga",nid:14230524,img:"/components/com_pages/views/images/kred/offline-eg-gaga.png",openable:!1,points:"400,000",achievement:"Creative Goddess"},{title:"SerenaWilliams",nid:26589987,img:"/components/com_pages/views/images/kred/offline-eg-serena.png",openable:!1,points:"300,000",achievement:"5 Times Australian Open Champion"},
{title:"BillGates",nid:50393960,img:"/components/com_pages/views/images/kred/offline-eg-gates.png",openable:!1,points:"200,000",achievement:"Founder of the Bill and Melinda Gates Foundation"}];$.ajax({url:"/ajax/?method=influence.getOfflineTransactions",dataType:"json",type:"POST",data:{username:c},success:function(e){var f=[];$.each(e,function(e,a){if("assigned"===a.status){if(!a.filename||!a.filename.match(/\.gif|\.jpg|\.jpeg|\.png/i))a.filename=null;f.push({title:c,img:a.filename?"/?option=com_pages&view=kr_offline&filename="+
a.filename:null,openable:!!a.filename,media_url:a.filename?encodeURIComponent("http://peoplebrowsr.com/?option=com_pages&view=kr_offline&filename="+a.filename):null,media_description:"Offline achievement for @"+c+" at kred.com: "+a.name,media_description_encoded:encodeURIComponent("Offline achievement for @"+c+" at kred.com: "+a.name),points:InfluencePopup&&InfluencePopup.humanise?InfluencePopup.humanise(a.points):a.points,achievement:a.name,community:a.community,community_id:a.community_id})}});
if(f.length){var k=$.trim($(".influence-outreach .username",g).text())||c;$.each(f,function(c,a){a.title=k;var e=$("#offline_celeb").tmpl(a);e.addClass(c%2?"right":"left");$(".more-offline-wrapper",g).append(e);e.find(".highest-offline-desc").tipTip()});e=$(".leading-kred-points",g);$(".more-offline-wrapper",g).append(e);e=$(".add-offline-types",g)}else e=a.pop(),e=$("#add_offline_prompt").tmpl(e).addClass("left"),$(".more-offline-wrapper",g).append(e),e=b.shift(),e=$("#offline_celeb").tmpl(e).addClass("right"),
$(".more-offline-wrapper",g).append(e),e=b.shift(),e=$("#offline_celeb").tmpl(e).addClass("left"),$(".more-offline-wrapper",g).append(e),e=a.pop(),e=$("#add_offline_prompt").tmpl(e).addClass("right"),$(".more-offline-wrapper",g).append(e),e=$(".leading-kred-points",g),$(".more-offline-wrapper",g).append(e),e=b.shift(),e=$("#offline_celeb").tmpl(e).addClass("right"),$(".more-offline-wrapper",g).append(e),e=a.pop(),e=$("#add_offline_prompt").tmpl(e).addClass("right"),$(".more-offline-wrapper",g).append(e),
e=$(".add-offline-types",g).css("float","left"),$(".more-offline-wrapper",g).append(e),e=b.shift(),e=$("#offline_celeb").tmpl(e).addClass("right");$(".more-offline-wrapper",g).append(e);e=$("#offline-email-box",g);$(".more-offline-wrapper",g).append(e)}})})();return g};logged_usr.id||Popup.open({type:"cross_app_login",backgr_col:"#000"})},addBadge:function(b,a,c,f){"function"===typeof c&&(f=c,c="twitter");var g=this,d=!1;window.logged_usr&&window.logged_usr.active&&(d=window.logged_usr.active.foreign_uid===
a);b.append($("#big_shield").tmpl({name:a,ownTab:d}));b.find(".pin-it-holder:visible").length&&$.getScript("//assets.pinterest.com/js/pinit.js");b.find(".kr, .spinner").show().end().find(".influence, .outreach").hide();g.getBadge(a,c,function(c){g.meter(a,b.closest(".tabcontent"));f&&f()},b);g.getCommunities(a,10,function(c){if(c&&c.length){var a=$("ul.commSelect",b.closest(".tabcontent"));a.empty();$.each(c,function(c,b){$("<a />",{"data-id":b.id,text:b.name,href:"#"}).wrap("<li></li>").parent().appendTo(a)});
a.find("li:first a").trigger("click");$(".infl-det a.direction-up").hide();$(".infl-det a.direction-down").show()}})},fillMorePage:function(b,a,c){var f=this,g=b===$(".yourTab").text().replace(/@/g,"");$(".freshcontent",c).html("<p>Loading...</p>");f.getFreshContent(b,a,function(a){if(f.newfreshcontent){$(".freshcontent",c).empty();var b="";$.each(a,function(c,a){var e=a[1],e={user:{avatar:"http://api.twitter.com/1/users/profile_image?size=bigger&screen_name="+e.uid.toLowerCase(),id:e.uid,name:""},
retweets:0,date:e.time,post:e.post,own_tab:g};b+='<div class="fresh">'+$("#fresh_post").tmpl(e).html()+"</div>"});$(".freshcontent",c).html("<div>"+b+"</div>")}else{var e=[],m=$("<div/>");$.each(a,function(c,a){a.own_tab=g;e.push('<div class="fresh">'+$("#fresh_post").tmpl(a).html()+"</div>")});m.html(e.join(""));$(".freshcontent",c).html(m);$(".timestamp",c).timeago()}});$(".followpane .influencers",c).html("<p>Loading...</p>");f.getTopCommInfluencers(a,function(a){var b=[];$.each(a,function(c,a){b.push('<div class="influencer" ext_id="'+
a.ext_id+'"><div class="close_infl">x</div><div class="graphics"><img class="avatar" src="http://api.twitter.com/1/users/profile_image?size=bigger&screen_name='+a.foreign_uid+'" /></div><div class="details"><span class="name">'+a.name+'</span><a target="_blank" href="http://www.twitter.com/'+a.foreign_uid+'">@'+a.foreign_uid+"</a>"+(1!=a.isFriend?'<div class="action"><div class="inf_follow"></div></div>':"")+"</div></div>")});$(".followpane .influencers",c).html("<div>"+b.join("")+"</div>")})},init_ranking:function(){function b(c,
b){b=$(b);var g=Influence.leaders[c];g?(b.find(".ledcomm").text(g.name),b.find(".proclamation").show(),b.find(".commleader").empty(),$.each(g.leaders,function(c,a){var d,g,n;"string"===typeof a?(d=a.replace(/@/,""),g=a,n="http://api.twitter.com/1/users/profile_image?size=normal&screen_name="+d):(d=a.leader.replace(/@/,""),g=a.bio,n=a.avatar);d=$('<div class="leaderfolk"><span class="kredible"><span class="kredible">'+d+'</span><span class="shield"></span></div>');d.find("> .kredible").prepend('<img src="'+
n+"\" title='"+g+"'/>");b.find(".commleader").append(d)}),b.find(".commleader .leaderfolk img").tipTip({defaultPosition:"below"})):(g=b.find(".infl-det .communityname").text(),b.find(".ledcomm").text(g),b.find(".commleader").html(""),b.find(".proclamation").hide());var d=b.find(".community-activity tbody").empty();a.getCommunityTransactions(c,function(a){$.each(a,function(a,b){$.each(b,function(a,e){var b,f,g;e.to?(f=e.user_name,g=e.to):(f=e.from_name,g=e.user_name);switch(e.event){case "rt":b="Retweeted";
break;case "reply":b="Replied to";break;case "mention":b="Mentioned";break;default:console.log("Bozo community transaction",e);return}var h=g;switch(e.dir){case "in":g="<b>"+g+"</b>";break;case "out":f="<b>"+f+"</b>"}var m=$("<tr>");m.append('<td class="date">'+$.timeago(new Date(1E3*e.ts)).replace("mth","mo")+"</td>");m.append("<td>@"+f+'</td><td class="action">'+b+"</td><td>@"+g+"</td>");m.append('<td class="inf">'+e.user_scores.tot_inf+"</td>");m.append('<td class="out">Level '+e.user_scores.tot_out+
"</td>");m.append('<td class="plusk"><div class="addpluskr" /></td>');m.appendTo(d);m.find(".addpluskr").data("comm_id",c).data("nid",e.from_userid||e.user_id);b={user_name:h,what:["@"+f,b.toUpperCase(),"@"+g].join(" "),post:e.post};b=$("#activity-statement-overlay").tmpl(b);m.find("td:first").append(b)})});d.closest(".community-activity-scroller").scrollTop(97)});a.getTopPlusUsers(c,function(a){var e=b.find(".plus-list");e.find("tr").remove();var d=0;$.each(a.data,function(a,b){if(3<d++)return!1;
if(b.userhash.us){if(b.comms[c]){var f={comm_id:c,atname:b.userhash.us,numeric_id:b.userhash.u_id},g=$("<tr />");$('<p class="name"><span class="kredible"><span class="kredible">'+b.userhash.us+'</span><span class="shield"></span></span></p>').appendTo(g).wrap("<td />");$("<p>+"+b.tot+"</p>").appendTo(g).wrap('<td class="plus-score" />');$('<td class="button"><p>Kred</p></td>').appendTo(g).data("pluskr",f);e.append(g)}}else console.log("WHO IS THIS GUY",b)})});a.getRandomUsersByComm(c,function(a){var e=
a[0];a=a[1];if(e&&a){var d=$(".player:first",b),g=$(".player:last",b);d.find(".player-realname").text(e.name);g.find(".player-realname").text(a.name);d.find(".player-username").text(e.screen_name);g.find(".player-username").text(a.screen_name);d.find(".player-bio").text(e.bio);g.find(".player-bio").text(a.bio);d.find(".player-image img").attr("src",e.avatar_url);g.find(".player-image img").attr("src",a.avatar_url);d.find(".player-kredbutton").data("comm_id",c).data("atname",e.screen_name).data("numeric_id",
e.numeric_id);g.find(".player-kredbutton").data("comm_id",c).data("atname",a.screen_name).data("numeric_id",a.numeric_id);d.closest(".versus").fadeTo(800,1)}})}console.log("ATN: init_ranking");var a=this;this.addTab=function(c){c=c.replace(/@/,"");var b=$("#ranking").tmpl({name:"Community"}).attr("uid",c).appendTo("#inside-container"),g=$('.tabcontent[uid="'+c+'"]').find(".shield_outer");$(g).find(".influence-outreach").remove();$('.tabcontent[uid="'+c+'"]').find(".shield_outer").append($("#big_shield").tmpl({name:c,
ownTab:window.logged_usr.active.foreign_uid===c}));$.getScript("//assets.pinterest.com/js/pinit.js");b.find(".leaderboard").tipTip({});b.find(".k_uid").text("@"+c);b.find(".header .score").tipTip();var d=$(".ana-prf ul.communities, .game-nav ul.communities",b);this.getBadge(c,"twitter",function(b){var f=$(),g=$.map(a.comms_info,function(a,c){return a});g.sort(function(a,c){return a.name<c.name?-1:a.name>c.name?1:0});$.each(g,function(a,c){"0"!==c.av_inf&&$("<a />",{"data-id":c.id,text:c.name,href:"#"}).wrap("<li></li>").parent().appendTo(d)});
InfluencePopup.getPreferredCommunity(c,b.comms,function(a){f=d.find('li a[data-id="'+(a&&a.id?a.id:1)+'"]');0===f.length&&(f=d.find("li a:first"));if((a=window.location.hash.match(/community\/(.+)$/))&&a.length)a=d.find("li a:contains("+decodeURI(a[1])+")"),a.length&&(f=a);f.trigger("click")})});var h=b.find(".game-nav .navbar").empty();$.each(Influence.leaders,function(a,c){var b=$("<li />",{text:c.name,"data-comm_id":c.id});h.append(b)});h.find("li:first").trigger("click");return b};$(".game-nav .navbar li").live("click",
function(){var a=$(this);a.data("comm_id");a.closest(".tabcontent").find(".ana-prf ul li a:contains("+a.text()+")").trigger("click");a.addClass("current")});$(".player-kredbutton p").live("click",function(a){var f=$(this),g=f.closest(".player-kredbutton"),d=g.data("comm_id"),h=g.data("atname");a=g.data("numeric_id");var e=f.closest(".tabcontent").find(".ledcomm").text(),m=f.closest(".tabcontent").find(".counter .count"),k=1+parseInt(m.text().match(/(\d+)/)[0]);m.text(k);"Global Kred"===e&&(community_id=
0);$.post("/ajax/?method=influence.saveCommunityPlus",{comm_id:d,numeric_id:a,source:"twitter"},function(a){a=parseInt(a);-1===a?(g.closest(".versus").fadeTo(800,1),alert("You have already given this user +Kred in this community")):1<a?(a=["I gave @",h," +Kred in ",e," community influence http://kred.com/?pkid=",a].join(""),Banner.openPostbox(a),b(d,f.closest(".tabcontent"))):alert("There has been a problem awarding this +Kred. Please try again.")});f.closest(".versus").fadeTo(800,0.4)});$(".plus-list .button").live("click",
function(a){a=$(this);var b=a.data("pluskr"),g=a.closest(".tabcontent").find(".ledcomm").text();"Global Kred"===g&&(community_id=0);$.post("/ajax/?method=influence.saveCommunityPlus",{comm_id:b.comm_id,numeric_id:b.numeric_id,source:"twitter"},function(a){a=parseInt(a);-1===a?alert("You have already given this user +Kred in this community"):1<a?(a=["I gave @",atname," +Kred in ",g," community influence http://kred.com/?pkid=",a].join(""),Banner.openPostbox(a)):alert("There has been a problem awarding this +Kred. Please try again.")})});
$(".ana-prf h1 a").die("click").live("click",function(){$(".ana-prf ul").slideToggle();return!1});$("h3.morecomms a").die("click").live("click",function(){$ul=$(this).closest("div").find("ul.communities");$ul.slideToggle().css("overflow","auto");return!1});$(".ana-prf ul li a, .game-nav ul.communities li a").die("click").live("click",function(){var c=$(this).data("id"),f=a.comms_info[c];if(f){var g=$(this).closest(".tabcontent").attr("uid");InfluencePopup.updatePreferredCommunities(g,f.name);$(this).closest("ul").slideUp();
$(this).closest(".tabcontent").find(".plus-list tr").fadeOut();window.location.hash=encodeURI("community/"+$(this).text());var d=$(this).closest(".tabcontent");d.find(".versus").fadeTo(800,0.4);var h=Influence.leaders[c],e=d.find(".vote-title h1"),m=d.find("h1.infl-det .leader").hide(),k=d.find(".game-nav.running");h&&h.leaders?(h="Leader: ",e.text("Award +Kred to people in this community"),k.find("h3").text("+Kred Community Leaderboard")):(h="Leaders",e.text("Nominate your Community Leader"),k.find("h3").text("Nominated for Community Leader"));
m.html(h).show();d.find(".game-nav .navbar li.current").removeClass("current");d.find(".communityname").text(f.name);d.find(".spinner").hide();if(f.av_inf||f.av_out)d.find(".shield_outer .influence-count, .infl-leaders .score").text(f.av_inf),d.find(".shield_outer .outreach-count, .out-leaders .score ").text(f.av_out),d.is("reclcalculating")||d.find(".kr").hide().end().find(".influence, .outreach").show();$(".lilinfluence, .liloutreach",d).text("");$(".lilshield img.loader",d).show();$.ajax({url:"/ajax/?method=influence.getcommscore",
dataType:"json",data:{username:g,commid:c},success:function(a){0<~~a.inf&&($(".lilshield img.loader",d).hide(),$(".lilinfluence",d).text(a.inf),$(".liloutreach",d).text(a.out))}});var n=function(a){a=$(a);var c=a.find(".inf").text();return c?c:a.text()},p=function(a){var c=$(a),b=c.find(".out").text();console.log("EXTRACTED",b,"FROM",a);return b?~~b:c.text()},q=$('.tabcontent[uid="'+g+'"]');$(".techleaders",q).hide();$("h1.pacify",q).show();a.getTopCommInfluencers(c,function(a){var b=$("table.influencers tbody",
q).empty();b.empty();var e=$("#influencer"),d=1,f;$.each(a,function(a,g){g.screen_name&&(f||(f=g.screen_name.toLowerCase()),g.position=d++,g.atname="@"+g.screen_name,g.comm_id=c,e.tmpl(g).appendTo(b))});b.find("tr").length&&(b.parent().find("thead").remove(),$("#influencer-header").tmpl({}).prependTo(b.closest("table")),b.tablesorter({cssHeader:"sortheader",headers:{7:{sorter:!1}},sortList:[[3,1]],textExtraction:n}),$(".influencers",q).find(".kred_ico").tipTip(),$("h1.pacify",q).hide(),$(".techleaders, .techleaders .infl-leaders",
q).show())});$(".techleaders",q).hide();$("h1.pacify",q).show();a.getTopCommOutreachers(c,function(a){var b=$("table.outreachers tbody",q);b.empty();var e=$("#influencer"),d=1;$.each(a,function(a,g){g.screen_name&&(g.position=d++,g.atname="@"+g.screen_name,g.comm_id=c,e.tmpl(g).appendTo(b))});b.find("tr").length&&(b.parent().find("thead").remove(),$("#influencer-header").tmpl({}).prependTo(b.closest("table")),b.tablesorter({cssHeader:"sortheader",headers:{7:{sorter:!1}},sortList:[[3,1]],textExtraction:p}),
$(".outreachers",q).find(".kred_ico").tipTip(),$("h1.pacify",q).hide(),$(".techleaders, .techleaders .out-leaders",q).show())});$wc=$(".groupsummary .wordcloud",q).empty();a.getCommWordCloud(c,function(a){if(a){var c=[];a=a.splice(0,24);$.each(a,function(a,b){9>=a?c.push('<span class="unkredible freq'+(a+1)+'">'+b[0]+"</span>"):c.push('<span class="unkredible">'+b[0]+"</span>")});$wc.html('<div class="words">'+c.join("")+"</div>")}});$(".viral_counts",q).hide();$(".posts .count",q).text("");$(".rts-in .count",
q).text("");a.getCommCounts(c,"posts",function(a){if(a){var c=0;$.each(a,function(a,b){c+=b[1]});$(".posts .count",q).text(InfluencePopup.humanise(c));$(".viral_counts",q).show()}});a.getCommCounts(c,"rts-in",function(a){if(a){var c=0;$.each(a,function(a,b){c+=b[1]});$(".rts-in .count",q).text(InfluencePopup.humanise(c));$(".viral_counts",q).show()}});b(c,$(this).closest(".tabcontent"));return!1}});$(".compare_toggle").live("click",function(){$(this).closest("table").toggleClass("comparing")});$("#communitySend").live("click",
function(){var a=!0,b=$("#community_add_popup"),g=$("#community_add");""==$("#commname").val()&&(a=!1,$("#commname").addClass("missing"),$("#commname").change(function(){$("#commname").removeClass("missing");$("#commname").unbind("change")}));if(!1===a)return b.find(".msg").html('<p class="alert">Missing Community Name</p>'),!1;var d=0;g.find(":input.required").each(function(){""==$(this).val()&&(console.log("el:",this),d++,console.log("ctr",d))});if(3==d)return a=!1,b.find(".msg").html('<p class="alert">Supply at least one of the highlighted fields</p>'),
g.find(":input.required").each(function(){""==$(this).val()&&($(this).addClass("missing"),$(this).change(function(){$(this).removeClass("missing");$(this).unbind("change")}))}),!1});$(".techleaders .viral_leaders .tweet, .techleaders .viral_leaders .facebook").live("click",function(){var a=$(this),b="Outreach";a.closest(".infl-leaders").length&&(b="Influence");var g=a.closest(".tabcontent").find(".communityname:first").text(),d=a.closest(".infl-leaders, .out-leaders").find("table tr:lt(4) .pos-at-name .kredible .kredible").map(function(){return $(this).text()}).get().join(" "),
b=["Top Kred",b,"Leaders in",g,"are",d,"on #Kred"].join(" ");a.is(".tweet")?Banner.openPostbox(b+" http://kred.com/#community"):(a=encodeURIComponent("http://kred.com/#community"),b=encodeURIComponent(b),a=["http://www.facebook.com/sharer.php?s=100&p[url]=",a,"&p[title]=",b,"&p[summary]=",a].join(""),window.open(a,"sharer","toolbar=0,status=0,width=626,height=436"))});$(".counts .viral_counts .tweet, .counts .viral_counts .facebook").live("click",function(){var a=$(this),b=$(this).closest(".counts"),
g=b.find(".posts .count").text(),b=b.find(".rts-in .count").text(),g=["In the last day",a.closest(".tabcontent").find(".communityname:first").text(),"community on #Kred had",g,"posts and",b,"RTs."].join(" ");a.is(".tweet")?Banner.openPostbox(g+" See on http://kred.com/#community"):(a=encodeURIComponent("http://kred.com/#community"),g=encodeURIComponent(g),a=["http://www.facebook.com/sharer.php?s=100&p[url]=",a,"&p[title]=",g,"&p[summary]=",a].join(""),window.open(a,"sharer","toolbar=0,status=0,width=626,height=436"))});
$(".kr-leaders-slide-link").live("click",function(){Popup.open({type:"url",url:"http://www.slideshare.net/slideshow/embed_code/11772325?rel=0"})})},getCommCounts:function(b,a,c){$.ajax({url:"/ajax/?method=influence.getCommCounts",dataType:"json",type:"POST",data:{comm_id:b,type:a},success:c})},init_analyze:function(){console.log("ATN: init_analyze");var b=this;this.addTab=function(a){var c=$("#analyze").tmpl({name:a}).attr("uid",a).appendTo("#inside-container");b.init_analyze_charts(c,a);$('.tabcontent[uid="'+
a+'"]').find(".shield_outer").empty().append($("#big_shield").tmpl({name:a,ownTab:window.logged_usr.active.foreign_uid===a}));$.getScript("//assets.pinterest.com/js/pinit.js");b.getBadge(a,"twitter",function(f){var g=c.find(".specificcommunity").text();b.updateShareText(c,a,f.influence,f.outreach,g)},c);b.getStats(a);return c}},init_io_chart:function(b,a){console.log("init_io_chart");$.getJSON("/ajax/",{method:"influence.dailyio",username:a},function(a){for(var f=[],g,d=/^(\d{4})-(\d{2})-(\d{2})$/,
h=0;h<a.length;h++)g=d.exec(a[h][0]),f.push([new Date(g[1],g[2]-1,g[3]),a[h][1].influence,a[h][1].outreach]);b.closest(".charts").find(".loading-block").hide();b.width(869).height(270);new Dygraph(b[0],f,{labels:["Date","Influence points","Outreach points"],fillGraph:!0,colors:["#509a1c","#008fb7"],colorSaturation:0.9,highlightCircleSize:5,drawPoints:!0,pointSize:1,strokeWidth:2,includeZero:!0,axisLabelFontSize:11,axisLabelColor:"#999999",width:869,labelsDiv:b.closest(".chart-container").find(".chartLegendIO")[0],
labelsSeparateLines:!0,"Outreach points":{axis:{}},yValueFormatter:function(a){return 0==a?"":parseInt(a).toString().replace(/\B(?=(?:\d{3})+(?!\d))/g,",")},xValueFormatter:function(a){return a?$.PHPDate("M j, Y",new Date(a)):a}})})},init_analyze_charts:function(b,a){console.log("ATN: init_analyze_charts");this.init_io_chart(b.find(".dailyio .data-wrapper"),a);new UserMentionsChart({root:b.find(".usermentions"),width:408,height:200,params:{user:a}});new User24HourChart({root:b.find(".user24hour"),
width:408,height:200,params:{user:a}});new WordCloudChart({root:b.find(".wordcloud"),params:{term:"@"+a}});new FollowersChart({root:b.find(".followers"),width:408,height:200,params:{user:a}});new PostEffectChart({root:b.find(".post-effect"),width:408,height:200,params:{user:a,posts:10}});new KredActivityStatementReportChart({root:b.find(".kred-activity-grid"),width:888,height:400,params:{term:a}})},init_lists:function(){function b(){$(".plist-drop").is(":visible")?$(".plist-bar").addClass("listing"):
$(".plist-bar").removeClass("listing")}function a(a,b){0===$(b).length&&(b=$("#inside-container"));f.listOwner!==window.logged_usr.active.foreign_uid&&b.addClass("readonly");var c=$(".plist-drop-list",b);c.empty().html("<tr><td>Loading...</td></tr>");f.getLists(f.listOwner,function(e){c.empty();!e||!e.length?(c.html('<tr><td class="empty">No lists created yet. You can create one below.</td></tr>'),$(".plist-drop-csv:hidden").show()):$.each(e,function(a,b){var e=$("<a>"+b.name+"</a>").attr({href:"#",
"data-list_id":b.id}).wrap("<td />").parent().append(' <a class="remove" href="#">remove</a>').wrap("<tr />").parent();c.append(e)});if(a){$(".plist-table-box",b).fadeOut(function(){$(this).remove()});e=$();var f=parseInt(window.location.hash.replace(/#/,""));f&&(e=c.find('tr a[data-list_id="'+f+'"]'));e.length||(e=c.find("tr:last a:not(.remove)").trigger("click"));e.trigger("click")}},function(){c.empty().html("<tr><td>There has been an error. Sorry.</td></tr>")})}function c(a,b){f.getMembers(a,
!0,function(c){window.location.hash=a;var e=$("#list-table").tmpl({name:b,list_id:a,avg_inf:c.avg_inf,avg_out:c.avg_out,member_count:c.members.length,owner:f.listOwner});$(".plist-table-box").fadeOut(function(){$(this).remove()});$.each(c.members,function(a,b){var c={position:1+a,user_name:b.user_name.replace(/[:()]/g,""),name:b.userhash.u_nm,top_community:b.values.top_comm,influence:b.values.score,outreach:b.values.level},c=$("#list-table-row").tmpl(c);e.find("table tbody").append(c);c.data("user_id",
b.values.user_id)});$("#list-table-target").after(e);e.find("table").data("list_id",a)})}console.log("ATN: init_lists");$(".plist-title").click(function(){$(".plist-drop-list-wrap").toggle();b()});$(".plist-addnew").click(function(){$(".plist-drop-addnew").hide();$(".plist-drop-csv").toggle();b()});$(".plist-addnew-button").click(function(){$(".plist-drop-csv").hide();$(".plist-drop-addnew").toggle();b()});$("#list-addlist-button").click(function(){$(this);var b=$.trim($("#list-listname").val());
b&&f.createList(b,function(b){$(".plist-drop-csv").fadeOut();var c={id:0};$.each(b,function(a,b){parseInt(b.id)>parseInt(c.id)&&(c=b)});b=!1;if($("#list-myfirstatname").val()){var e=$.trim($("#list-myfirstatname").val()).replace("@","");b=!0;f.addToList(c.id,e,function(){a(!0)},function(){alert("There has been a problem adding this user to your new list: "+e)})}if($("#list-twitterlist").val()){var g=$("#list-twitterlist").val(),k=g.replace("#/","").split("/").slice(-2).join("/");b=!0;f.importTwitterList(c.id,
k,function(){a(!0)},function(){alert("There has been a problem importing this list from Twitter: "+g)})}$("#list-ufile").val()&&(b=$("#csvupload"),b.find(".list_id").val(c.id),b.get(0).submit(),b=!0,setTimeout(function(){a(!0)},3E3));!1===b&&a(!0)},function(){alert("There has been a problem creating your desired list. Sorry.")})});$("#list-ufile").change(function(){$("#list-ufile-button").removeClass("notyetactive")});$(".plist-h-title input").live("click",function(){this.select()});$(".plist-drop-list a:not(.remove)").live("click",
function(){var a=$(this),b=a.data("list_id");c(b,a.text());$(".plist-drop-list-wrap").is(":visible")&&$(".plist-title").click();return!1});$(".plist-plusbox").live("click",function(){var a=$(this).closest("tr"),b=a.closest("table"),h=a.find(".plist-f-new input"),a=h.val(),e=b.data("list_id");a&&(a=$.trim(a.replace(/@/,"")),h.val("").attr("placeholder","Adding..."),f.addToList(e,a,function(){c(e,b.find(".plist-name").text())},function(){h.attr("placeholder","add an @name");alert("There seems to be a problem with the @name you have entered. Please try harder.")}))});
$(".plist-f-new input").live("keypress",function(a){13===a.keyCode&&$(this).closest("tr").find(".plist-plusbox").trigger("click")});$(".plist-drop-list a.remove").live("click",function(b){b.stopPropagation();b=$(this).closest("tr");var c=b.find("a:not(.remove)").data("list_id");confirm("Are you sure you wish to delete this list?")&&(f.removeList(c),b.fadeOut(function(){a(!0)}));return!1});$(".plist-r-name a.remove").live("click",function(){var a=$(this).closest("tr"),b=a.closest("table"),h=b.data("list_id"),
e=a.data("user_id");confirm("Are you sure you wish to remove this user?")&&f.removeUser(h,e,function(){a.fadeOut();c(h,b.find(".plist-name").text())},function(){alert("There was a problem removing this user. Sorry.")});return!1});var f={call:function(a,b,c,e){return $.ajax({url:"/ajax/?method=influence."+a,dataType:"json",type:"POST",data:b,success:function(a){a.error?$.isFunction(e)&&e(a.error,a):$.isFunction(c)&&c(a.data,a)},error:e})},createList:function(a,b,c){return this.call("newList",{name:a},
b,c)},getLists:function(a,b,c){return a?this.call("getLists",{username:a},b,c):this.call("getMyLists",null,b,c)},getMembers:function(a,b,c,e){return this.call("getMembers",{list_id:a},function(a,e){if($.isFunction(c))if(b){var f=[],g=0,q=0;$.each(a,function(a,b){b.values.top_comm="";var c=0;g+=b.values.score;q+=b.values.level;$.each(b.comms,function(a,e){e.user_inf>c&&(c=e.user_inf,b.values.top_comm=e.name)});f.push(b)});var s={avg_inf:f.length?Math.round(g/f.length):0,avg_out:f.length?Math.round(q/
f.length):0,members:f};c(s,e)}else c(a,e)},e)},addToList:function(a,b,c,e){return this.call("addUserByUid",{list_id:a,uid:b},c,e)},importTwitterList:function(a,b,c,e){return this.call("addUsersByTwList",{list_id:a,tw_list_id:b},c,e)},removeList:function(a,b,c){return this.call("removeList",{list_id:a},b,c)},removeUser:function(a,b,c,e){return this.call("removeUserByNid",{list_id:a,nid:b},c,e)},listOwner:window.location.href.match(/[^\/]\/([^\/]+)\/lists/)?window.location.href.match(/[^\/]\/([^\/]+)\/lists/)[1]:
window.logged_usr.active.foreign_uid};$(".plist-title .uid").text(f.listOwner);a(!0)},init_gift:function(){$("#gift_popup").tmpl().appendTo("body")},init_widgets:function(){function b(){var a='/?option=com_pages&view=influence_badge&uid="'+encodeURIComponent(f);$("#full_badge input").each(function(){var b=this.value.replace(g,"");$("#badge_"+this.name).text(b);a+="&"+this.name+"="+encodeURIComponent(b)});$("#kredible-badge-frame").attr("src",a)}function a(){var a="/?option=com_pages&view=influence_popup&uid="+
encodeURIComponent(f);$("#kredentials input").each(function(){var b=this.value.replace(g,"");a+="&"+this.name+"="+encodeURIComponent(b);$("#popup_"+this.name).text(b)});$("#kredentials_preview_frame").attr("src",a)}function c(){var a="/?option=com_pages&view=influence_popup&embed=1&uid="+encodeURIComponent(f);$("#kredentials_embed input").each(function(){var b=this.value.replace(g,"");a+="&"+this.name+"="+encodeURIComponent(b);$("#popup_embed_"+this.name).text(b)});$("#kredentials_preview_embed_frame").attr("src",
a)}var f=logged_usr.active&&logged_usr.active.username||"timoreilly",g=/^#/g;$(".user-uid").text(f);$("#kred_score_badge_preview").html('<a href="http://kred.com/'+f+'" target="_blank"><img src="//peoplebrowsr.com/widget/kredbadge/'+f+'" style="border:0"/></a>');$("#full_badge .save-button").click(b);$("#kredentials .save-button").click(a);$("#kredentials_embed .save-button").click(c);(function(){$.ajax({url:"//kredapi.peoplebrowsr.com:1490/kredproxy/get_users",dataType:"jsonp",jsonp:"jsonp_callback",
type:"GET",data:{nids:f},success:function(a){for(var b in a){var c=[" ",a[b].values.score,"/",a[b].values.level].join("");$("#small_code_score_preview .scores").text(c)}}})})();(function(){var a="http://peoplebrowsr.com/widget/kredshield/"+f;$("#small_code_img").attr("src",a)})();b();a();c();$('<div id="colorpicker"></div>').appendTo("body").farbtastic(function(a){$("#colorpicker").data("input").value=a.substring(1)});$("#full_badge, #kredentials, #kredentials_embed").find("input").focus(function(){function a(){$("#colorpicker").hide();
$(document).unbind(".colorpicker").removeClass("no-user-select")}var b=$("#colorpicker"),c=$(this).closest("div").offset();b.data("input",this).css({left:c.left+70,top:c.top+this.offsetHeight-12}).show();$(document).addClass("no-user-select").bind("mousedown.colorpicker",function(b){0===$(b.target).closest("#colorpicker").length&&a()}).bind("keydown.colorpicker",function(b){27===b.keyCode&&a()})})},addTabLabel:function(b,a,c){a||(a="twitter");c||(c="");if($(".top-user-name[uid="+b+'"]').length)return $('.top-user-name[uid="'+
b+"]");var f="twitter"==a?b:c;$tab=$('<div class="top-user-name" source="'+a+'" uid="'+b+'" title="'+f+'"><span class="tab_label unkredible">'+f+'</span><span class="close">&#10005;</span></div>').insertBefore("#search-at-name");window.active_account&&c.toLowerCase()==window.active_account.foreign_uid.toLowerCase()&&$tab.addClass("yourTab").find(".close").remove();this.squeezeTabs();$tab.tipTip({delay:100});return $tab},getUserRecord:function(b){var a={source:"twitter",uid:b,name:b};this.multiSources&&
$.each(this.Nuids,function(c,f){f.uid==b&&(a=f)});return a},search:function(b){var a=this;$("#another-name").trigger("blur");var c=$(".top-user-name.current").removeClass("current"),f=a.addTabLabel(b,"twitter").addClass("current");console.log("TESTING USERNAME",b);a.isValidUsername(b,function(g){console.log("USERNAME CALLBACK",b);g?(a.multiSources?a.NaddUid(b,"twitter"):a.addUid(b),f.find(".tab_label").trigger("click"),-1==$.inArray(b,a.uids)&&a.addTab&&a.addTab(b)):($("#ajaxMsg").html('<p class="unkredible">Please check your spelling. It looks like this @name is invalid or privacy protected: @'+
b+"</p>").slideDown("fast",function(){}),setTimeout(function(){$("#ajaxMsg").hide()},9E3),f.find(".close").trigger("click"),c.addClass("current"))})},isValidUsername:function(b,a){$.ajax({url:"/ajax/?method=influence.isValidUsername",dataType:"json",type:"POST",data:{username:b},success:a})},meter:function(b,a){$(".kred-meter-descr",a).text("Loading...");this.ajaxRequests.generic.push($.ajax({url:"/ajax/?method=influence.getMeter",dataType:"json",type:"POST",data:{username:b},success:function(b){0===
b.perc&&(b.perc=5);0===b.current_lvl&&(b.current_lvl=parseInt($(".outreach-count",a).text()),isNaN(b.current_lvl)&&(b.current_lvl=0));if(window.logged_usr&&$(a).closest(".tabcontent").attr("uid")===logged_usr.active.foreign_uid)if(0<~~b.current_lvl&&1===~~b.perc){var f=~~$.cookie("levelupcongrats");if(4>f){var g=$(a).closest(".tabcontent").attr("uid"),d="I increased my #Kred Outreach to level "+b.current_lvl+" on http://kred.com/"+g;$(".kred-meter .kred-meter-nextlevel-bg, .kred-meter .levelup",a).show();
$(".levelup .share .tweetthis").bind("click",function(){Banner.openPostbox(d);return!1});$.cookie("levelupcongrats",f+1,{expires:365})}}else $.cookie("levelupcongrats",0,{expires:365});$(".kred-meter-descr",a).text("Outreach Meter");$(".meter-status",a).addClass("preanimateXXX").addClass("perc"+b.perc).load(function(){$(this).removeClass("preanimateXXX")}).attr("src","/components/com_pages/views/images/kred/needle"+b.perc+".png")},error:function(a){console.log("Error loading the meter for",b)}}))},
show_moremenu:function(){return!1},init_events:function(){function b(a){var c=$(".celebs");a||(c.stop(!0,!0),$(".celeb-picker .arrow.right").trigger("click"));0<c.length&&3083<=c[0].scrollLeft&&c.animate({scrollLeft:0})&&h--;h&&(d=setTimeout(b,4E3))}function a(a,b){c.ajaxRequests.generic.push($.ajax({url:"/ajax/?method=user.addFriends",dataType:"json",type:"POST",data:{owner:logged_usr.active.ext_id,extids:a},success:b,error:function(a){}}))}console.log("ATN: init_events");var c=this;InfluencePopup.initEvents();
$("#kr-more-menu").live("click",function(){$(".kr-menu-list").toggleClass("displayed")});$(".tweet-score").live("click",function(){Banner.openPostbox("I have Kred Influence "+InfluenceViral.new_inf+" and an Outreach level of "+InfluenceViral.new_out+" in the Global Community, view at http://kred.com/"+window.active_account.username)});$("#landing-header input.atname").focus(function(){$(this).addClass("focus")}).blur(function(){""===$(this).val()&&$(this).removeClass("focus")});if(c.ajaxTabs){var f=
Influence.getLoadHash();f&&c.loadAjaxTab(f);var g=function(a){c.killAjaxRequests();window.location.hash=c.filename_to_hash(a);_gaq.push(["_trackEvent","Kred - tab","load",a]);var b=$(".landing:visible .k_uid:first").text();c.loadAjaxTab(a,b)};$(".landing .monthly-activity-statements a").live("click",function(){var a=$(this).closest(".tabcontent").attr("uid");g("activity");c.search(a);return!1});$(".networks .facebook").click(function(){$("#infl_header li a[tabname=identity]").click()});$("#infl_header li a").click(function(){var a=
$(this).attr("tabname");if("identity"!=a)return g(a),!1})}c.init_tabs_events();$(".getMoreTrans").live("click",function(){c.getMoreTransactions(this)});$(".celeb-picker .arrow").click(function(a,b){a.stopPropagation();var c=4*($("ul.celebs li:first").outerWidth(!0)+4);b||(b=$(this).is(".left")?"-="+c:"+="+c);$("ul.celebs").stop(!0).animate({scrollLeft:b},300)});var d,h=2;$("ul.celebs").length&&b(!0);$(".celeb-picker").mouseover(function(){$(this).unbind("mouseover");$(".celebs").stop(!0,!0);clearTimeout(d)});
$(".guide-infl input").live("click",function(){var a=$(this),b=a.attr("direction");a.closest(".tabcontent").find(".statements").toggleClass("show_"+b,a.is(":checked"))});$(".big_shield, .influencer-summary .avatar").live("click",function(){console.log("shield clicked!");if(!$(this).closest(".groupsummary").length&&!$(this).is(".offline-profile")){console.log("should show pupup here...");var a=$(this).closest(".tabcontent").attr("uid");window.self===window.top?Popup.open({type:"infl-kred",uid:a}):
window.parent.Popup.open({type:"infl-kred",uid:a})}});$(".blind .close").click(function(){$(this).closest(".blind").slideUp();return!1});$(".commSelect a").live("click",function(a){a.stopPropagation();a=$(this).closest(".tabcontent").attr("uid");var b=$('.tabcontent[uid="'+a+'"]');$(this).data("id");var d=$(this).text();c.fillMorePage(a,parseInt($(this).attr("data-id")),b);$(".infl-det .commname",b).text(d);$(".infl-det a.direction-up").hide();$(".infl-det a.direction-down").show();$("ul.commSelect",
b).slideUp();return!1});$(".infl-det > a").live("click",function(){var a=$(this).closest(".tabcontent");$("ul.commSelect",a).slideToggle();$(".infl-det a.direction-up, .infl-det a.direction-down",a).toggle();return!1});$(".influencers .inf_follow").live("click",function(){var b=$(this).closest(".influencer"),c=b.attr("ext_id");b.find(".action").html("Following...");var d=function(a){a&&b.find(".action").html("Followed!");b.fadeOut(1E3,function(){b.remove()})};logged_usr.active.ext_id?a(c,d):logged_usr.start(function(){a(c,
d)})});$(".infl_list .inf_follow").live("click",function(){var b=$(this).closest("li"),c=b.attr("ext_id"),d=$(this);d.fadeOut(1E3,function(){b.find(".action").html("Following...")});var f=function(a){b.find(".action").html("Followed!");d.fadeOut(1E3,function(){d.remove()})};logged_usr.active.ext_id?a(c,f):logged_usr.start(function(){a(c,f)})});$(".infl-leaders .reach-out, .out-leaders .reach-out").live("click",function(){var b=$(this).closest("tr"),c=b.attr("ext_id");b.find(".reach-out").fadeOut(1E3);
b.find(".reach-out").closest("td").append('<span class="stat_followed">Following...</span>');var d=function(a){a?b.find(".reach-out").closest("td").find(".stat_followed").text("Followed"):(b.find(".reach-out").fadeIn(1E3),b.find(".reach-out").closest("td").find(".stat_followed").text(""))};logged_usr.active.ext_id?a(c,d):logged_usr.start(function(){a(c,d)})});$(".kred-popup-close").live("click",function(a){a.stopImmediatePropagation();a=$.cookie("kredshieldcallout")||1;$.cookie("kredshieldcallout",
~~a+1,{expires:1E3});$(this).closest(".kred-popup-maindiv").hide()});$(".contact_button").live("click",function(){Popup.open({type:"cross_app_contact"});return!1});$(".offline_statements .statement .stat_tweet, .plus_statements .statement .stat_tweet").live("click",function(){var a=$(this).data("tweet");Banner.openPostbox(a)});$(".statement .stat_tweet").live("click",function(){if(!$(this).closest(".offline_statements, .plus_statements, ").length){$("#top_banner:hidden").length&&(clearTimeout(d),
$("#influence-top").css("z-index",10).find("#top_banner").show().find("> *").hide().filter("#crossAppBanner").show(),Banner.postbox.bind("onAfterPosting",function(){$("#top_banner").hide()}));var a=$(this).closest(".statement").data("transaction"),b="mentioned"===a.action?"mentioning":"retweeted"===a.action?"RTing":"replied to"===a.action?"replying to":"followed"===a.action?"following":a.action;post="i"===a.direction?"@"+a.othername+" Thanks! By "+b+" me, you increased my Kred Influence & your Outreach went up. Get your @Kred at http://kred.com":
"@"+a.othername+" Get your @Kred at http://kred.com";$(".yourTab.current").length||(post=a.othername+" I'm sending this tweet from @Kred influence and outreach measure based on 1000 days of data http://kred.com");"fb"===a.source?(b="i"===a.direction?"My Kred Influence just increased. Get your Kred at Kred.com":"My Kred Outreach just increased. Get your Kred at Kred.com",a=encodeURIComponent("http://kred.com/"+window.logged_usr.active.foreign_uid),b=encodeURIComponent(b),a=["http://www.facebook.com/sharer.php?s=100&p[url]=",
a,"&p[title]=",b,"&p[summary]=",a].join(""),window.open(a,"sharer","toolbar=0,status=0,width=626,height=436")):Banner.openPostbox(post.replace(/@+/g,"@"))}});$(".activity-earn-now, .activity-statement-overlay .tweet").live("click",function(){$("#quickPostTextArea").val("");Banner.openPostbox("#kred")});$(".badge-fb-button").live("click",function(a){a.preventDefault();$('.tabcontent[uid="'+name+'"]');a="kred.com/"+$(this).closest(".tabcontent").find(".username").text();console.log("fb:","view your score at Kred.com");
window.open("http://www.facebook.com/sharer.php?s=100&p[url]="+encodeURIComponent("http://"+a)+"&p[title]="+encodeURIComponent("view your score at Kred.com")+"&p[summary]="+encodeURIComponent(a),"sharer","toolbar=0,status=0,width=626,height=436")});$(".tweet-badge").live("click",function(){var a;if($(this).closest(".groupsummary").length){var b=$(this).closest(".tabcontent");a=$(".communityname:first",b).text();var c=$(".influence-count",b).text(),b=$(".outreach-count",b).text();a=[a,"Community has Kred Influence",
c,"Outreach level",b+",","see kred.com/#community #kred"].join(" ")}else a=$(this).attr("data-text");Banner.openPostbox(a);return!1});$(".badgecommselection > a, .big_shield .opener").live("click",function(a){a.stopImmediatePropagation();if($(this).closest(".tabcontent.preview").length)Popup.open({type:"cross_app_login"});else return a=$(this).closest(".usr-det-kr"),$(".badgecommselection ul.communities",a).slideToggle(),$(".badgecommselection > a",a).toggle(),!1});$("ul.communities input").live("click",
function(a){a.stopImmediatePropagation();a=$(this).val();$.post("/ajax/?method=influence.saveCommunityPref",{comm_id:a,numeric_id:logged_usr.active.numeric_id,source:logged_usr.active.source})});$(".big_shield.offline-profile").live("click",function(a){a.stopImmediatePropagation();a.stopPropagation();a=$(this);var b=a.closest(".tabcontent, .landing").find(".k_uid:first").text();b||(b="timoreilly");0<a.find("ul.tell").length&&0===a.find("li:contains(points)").length?Banner.openPostbox("@"+b+" add your offline achievements to #Kred to increase your Influence and Outreach scores http://kred.com/#offline"):
(window.location.hash="offline",Influence.loadAjaxTab("more"));return!1});$(".big_shield.stars-profile .vote").live("click",function(a){a.stopImmediatePropagation();a=$(this);var b=a.closest(".stars-profile").find(".stars .selected:last").index()||0,c=a.closest(".tabcontent").find(".badgecommselection ul.communities li.active").data("influencerscores").id,d=a.closest(".stars-profile").find(".votes"),f=~~d.text(),g=a.closest(".tabcontent").attr("uid"),h=a.closest(".stars-profile").find(".specificcommunity:first").text();
if(0>~~b)return!1;"Global Kred"===h&&(c=0);d.text(1+f);$.get("/ajax/",{method:"influence.saveCommunityVote",comm_id:c,numeric_id:$(this).closest(".tabcontent").find(".usr-det-kr").data("numeric_id"),source:$(this).closest(".tabcontent").find(".usr-det-kr").data("source"),vote:++b});Banner.openPostbox("I voted @"+g+" "+b+" stars in "+h+" on #Kred http://kred.com/"+g);a.closest(".stars-profile").find(".stars").addClass("votedone");a.hide().after('<p class="thanks">'+(f+1)+" vote"+(0===f?"":"s")+"</p>");
Influence.votes||(Influence.votes={});Influence.votes[g]||(Influence.votes[g]={});Influence.votes[g][c]=b});$(".big_shield .addpluskr").live("click",function(a){a.stopImmediatePropagation();a=$(this);var b=a.closest(".tabcontent").find(".badgecommselection ul.communities li.active").data("influencerscores").id||0,c=a.closest(".tabcontent").attr("uid"),d=a.closest(".tabcontent").find(".usr-det-kr").data("numeric_id"),f=a.closest(".influence-outreach").find(".specificcommunity:first").text();"Global Kred"===
f&&(community_id=0);$.post("/ajax/?method=influence.saveCommunityPlus",{comm_id:b,numeric_id:d,source:"twitter"},function(a){a=parseInt(a);-1===a?alert("You have already given this user +Kred in this community"):1<a?(a=["I gave @",c," +Kred in ",f," community influence http://kred.com/?pkid=",a].join(""),Banner.openPostbox(a)):alert("There has been a problem awarding this +Kred. Please try again.")})});$(".influencers .addpluskr, .outreachers .addpluskr").live("click",function(a){a.stopImmediatePropagation();
a=$(this);var b=a.closest("tr").find(".pos-at-name .kredible .kredible").text().replace(/@/,""),c=a.data("comm_id")||0,d=a.data("nid"),f=a.closest(".tabcontent").find(".communityname:first").text();a.is(".submitted")||(a.addClass("submitted"),$.post("/ajax/?method=influence.saveCommunityPlus",{comm_id:c,numeric_id:d,source:"twitter"},function(a){a=parseInt(a);-1===a?alert("You have already given this user +Kred in this community"):1<a?(a=["I gave @",b," +Kred in ",f," community influence http://kred.com/?pkid=",
a].join(""),Banner.openPostbox(a)):alert("There has been a problem awarding this +Kred. Please try again.")}))});$(".community-activity .plusk .addpluskr").live("click",function(a){a.stopImmediatePropagation();a=$(this);var b=a.closest("tr").find(".kredible:first .kredible").text().replace(/@/,""),c=a.data("comm_id")||0,d=a.data("nid"),f=a.closest(".tabcontent").find(".communityname:first").text();a.is(".submitted")||(a.addClass("submitted"),$.post("/ajax/?method=influence.saveCommunityPlus",{comm_id:c,
numeric_id:d,source:"twitter"},function(a){a=parseInt(a);-1===a?alert("You have already given this user +Kred in this community"):1<a?(a=["I gave @",b," +Kred in ",f," community influence http://kred.com/?pkid=",a].join(""),Banner.openPostbox(a)):alert("There has been a problem awarding this +Kred. Please try again.")}))});$("table .addpluskr").live("click",function(){var a=$(this);if(!a.is(".submitted")){a.addClass("submitted");var b=a.closest("td").prevAll(".comm:first, .community:first"),c=a.closest("td").prevAll(".count:first"),
d=parseInt(c.text());c.text("+"+(d+1));var f=b.data("commid"),g=b.data("nid");$.ajax({type:"POST",url:"/ajax/?method=influence.saveCommunityPlus",data:{comm_id:f,numeric_id:g,source:"twitter"},dataType:"json",success:function(f){f=parseInt(f);if(-1===f)c.text(d),alert("You have already given this user +Kred in this community");else if(1<f){var g=a.closest(".tabcontent").find(".username").text(),h=b.text();f=["I gave @",g," +Kred in ",h," community influence http://kred.com/?pkid=",f].join("");Banner.openPostbox(f)}else alert("There has been a problem awarding this +Kred. Please try again.")},
error:function(){c.text(d);alert("Error adding your +Kred. Please try again later")}})}});$(".badgecommselection li").live("click",function(a){var b=$(this),d=b.closest(".tabcontent"),f=b.text();a.stopImmediatePropagation();d.find(".switcher a:first").not(".current").trigger("mouseenter");"Global Kred"===b.text()?(d.find(".top_community_score").show(),d.find(".global_score").hide()):(d.find(".top_community_score").hide(),d.find(".global_score").show());if(b.is(".descriptive"))return!1;d.find(".influencer-communities, ul.communities").find(".active").removeClass("active");
b.addClass("active");!1===$("body").is(".kredv2_wide")?($(".influencer-communities ul, ul.communities").slideUp(),$(".badgecommselection a.direction-down").show(),$(".badgecommselection a.direction-up").hide()):(b.siblings().removeClass("active"),b.addClass("active"));d.find(".specificcommunity").text(f);a=b.attr("data-influence");var g=b.attr("data-outreach"),h=b.attr("data-plus-i");b.attr("data-plus-o");if(a||g){var s=b.closest(".influence-outreach"),r=s.parent();s.detach();s.find(".influence-count").html(a);
s.find(".outreach-count").html(g);s.find(".plus-kred-received .count").text(h||0);r.append(s)}var l=b.data("influencerscores");if(l){l.vote||(l.vote={votes:0,count:0,stars:5});b=d.find(".k_uid:first").text();h="@"+b+" has been rated "+l.vote.stars+" stars "+f+" by "+l.vote.count+" people";d.find(".big_shield.stars-profile span.descripty").tipTip({defaultPosition:"top",content:h});d.find(".big_shield.stars-profile .stars > span").tipTip();d.find(".big_shield.stars-profile .vote").tipTip({defaultPosition:"bottom"});
d.find(".stars-profile .starcount").text(l.vote.stars);d.find(".stars-profile .selected").removeClass("selected");d.find(".descripty").css("opacity",0);d.find(".stars-profile .copy").text("Vote");d.find("span.stars span.dim").removeClass("dim");d.find("span.stars span").eq(l.vote.stars-1).nextAll("span").addClass("dim");d.find(".stars-profile .votes").text(l.vote.count);d.find(".commname").text("Global Kred"===f?"Across All Communities":"In The "+f+" Community");h=d.find("ul.commSelect li a:contains("+
f+")");0===h.length&&(h=d.find("ul.commSelect li a:first"));h.trigger("click");Influence.votes&&Influence.votes[b]&&Influence.votes[b][l.id]?(d.find(".stars-profile .thanks").remove(),d.find(".stars-profile .vote").hide(),d.find(".stars-profile .stars span:lt("+Influence.votes[b][l.id]+")").addClass("selected"),d.find(".stars-profile .descripty").css("opacity",1).find(".starcount").text(Influence.votes[b][l.id])):(d.find(".stars-profile .thanks").remove(),d.find(".stars-profile .stars.votedone").removeClass("votedone"),
d.find(".stars-profile .vote").find(".copy.prompt").removeClass("prompt").end().show(),d.find(".stars-profile .stars .selected").removeClass("selected"));l&&(a=l.user_inf||0,g=l.user_out||0);window.kred_slider&&!d.is(".recalculating")&&(new kred_slider({root:d.find(".slider1"),max:1E3,min:0,x:a,title:"Influence",width:497,height:57}),new kred_slider({root:d.find(".slider2"),max:g>c.settings.max_outreach_level?g:c.settings.max_outreach_level,min:0,x:g,show_next:!0,color:"blue",title:"Outreach",width:497,
height:57}));if(d.find(".meter-status").length)if(d.find(".kred-meter .current-level, .levelup .level").text(l.user_out),d.find(".kred-meter .next-level").text(1+l.user_out),"Global Kred"===f)c.meter(b,d);else{var v=d.find(".meter-status");0===l.user_out_perc&&(l.user_out_perc=1);d.find(".kred-meter .current-level, .levelup .current-level").text(l.user_out);d.find(".kred-meter .next-level").text(1+l.user_out);setTimeout(function(){v.attr("src","/components/com_pages/views/images/kred/needle"+l.user_out_perc+
".png")},200)}d.find(".influence-count").text(a);d&&d.find(".outreach-count").text(g);!a||d.is(".recalculating")?d.find(".kr").show().end().find(".influence, .outreach").hide():d.find(".kr").hide().end().find(".influence, .outreach").show();InfluencePopup.updatePreferredCommunities(d.attr("uid"),f);g||(g=d.find(".outreach-count").text());c.updateShareText(d,d.attr("uid"),a,g,f)}});$(".viralcomms td.community").live("click",function(a){var b=$(this),d=b.closest("tr"),f=$(".tabcontent.active"),g=b.find(".name").text();
0===f.length&&(f=$(".tabcontent:visible"));a.stopImmediatePropagation();f.find(".switcher a:first").not(".current").trigger("mouseenter");"Global Kred"===b.text()?(f.find(".top_community_score").show(),f.find(".global_score").hide()):(f.find(".top_community_score").hide(),f.find(".global_score").show());f.find(".influencer-communities, ul.communities").find(".active").removeClass("active").end().find(":contains("+g+")").addClass("active");b.addClass("active");f.find(".specificcommunity").text(g);
(a=d=d.data("influencerscores"))||(d={});d.vote||(d.vote={votes:0,count:0,stars:5});var h="@"+f.find(".k_uid:first").text()+" has been rated "+d.vote.stars+" stars "+g+" by "+d.vote.count+" people";f.find(".big_shield.stars-profile span.descripty").tipTip({defaultPosition:"top",content:h});f.find(".big_shield.stars-profile .stars > span").tipTip();f.find(".big_shield.stars-profile .vote").tipTip({defaultPosition:"bottom"});f.find(".stars-profile .starcount").text(d.vote.stars);f.find(".stars-profile .selected").removeClass("selected");
f.find(".descripty").css("opacity",0);f.find(".stars-profile .copy").text("Vote");f.find("span.stars span.dim").removeClass("dim");f.find("span.stars span").eq(d.vote.stars-1).nextAll("span").addClass("dim");f.find(".stars-profile .votes").text(d.vote.count);f.find(".commname").text("Global Kred"===g?"Across All Communities":"In The "+g+" Community");g=f.find("ul.commSelect li a:contains("+g+")");0===g.length&&(g=f.find("ul.commSelect li a:first"));g.trigger("click");d=g=0;a&&(g=a.user_inf||0,d=a.user_out||
0);f.find(".influence-count").text(g);f.find(".outreach-count").text(d);window.kred_slider&&(new kred_slider({root:f.find(".slider1"),max:1E3,min:0,x:g,title:"Influence",width:497,height:57}),new kred_slider({root:f.find(".slider2"),max:d>c.settings.max_outreach_level?d:c.settings.max_outreach_level,min:0,x:d,color:"blue",title:"Outreach",width:497,height:57}));b.closest(".viralcomms").find(".kr-pop-close").trigger("click")});$(".pluskr td.comm").live("click",function(a){var b=$(this);b.closest("tr");
var d=b.closest(".tabcontent"),f=b.text();d.length||(d=$(".tabcontent.active"));d.length||(d=$(".tabcontent"));var g=b.data("commscore");a.stopImmediatePropagation();d.find(".switcher a:first").not(".current").trigger("mouseenter");"Global Kred"===b.text()?(d.find(".top_community_score").show(),d.find(".global_score").hide()):(d.find(".top_community_score").hide(),d.find(".global_score").show());d.find(".influencer-communities, ul.communities").find(".active").removeClass("active");b.addClass("active");
d.find(".specificcommunity").text(f);d.find(".k_uid:first").text();d.find(".commname").text("Global Kred"===f?"Across All Communities":"In The "+f+" Community");a=d.find("ul.commSelect li a:contains("+f+")");0===a.length&&(a=d.find("ul.commSelect li a:first"));a.trigger("click");var h,s;g&&(h=g.user_inf||0,s=g.user_out||0);window.kred_slider&&(new kred_slider({root:d.find(".slider1"),max:1E3,min:0,x:h,title:"Influence",width:497,height:57}),new kred_slider({root:d.find(".slider2"),max:c.settings.max_outreach_level,
max:s>c.settings.max_outreach_level?s:c.settings.max_outreach_level,min:0,x:s,color:"blue",title:"Outreach",width:497,height:57}));d.find(".influence-count").text(h);d&&d.find(".outreach-count").text(s);h?d.find(".kr").hide().end().find(".influence, .outreach").show():d.find(".kr").show().end().find(".influence, .outreach").hide();InfluencePopup.updatePreferredCommunities(d.attr("uid"),f);s||(s=d.find(".outreach-count").text());c.updateShareText(d,d.attr("uid"),h,s,f);$(".viralcomms:visible a.close").trigger("click")});
$(".landing div.share, .overview div.share").live("click",function(){var a=$(this);a.closest("tr");var b=a.closest(".tabcontent").find(".uid").text().replace(/@/,""),c=a.parent("td").prevAll(".comm").first().text().replace(/\s?community/i,""),c=["I have",~~a.parent("td").prevAll(".count").first().text(),"+Kred in the",c,"community"].join(" ");a.is(".tweet")?Banner.openPostbox(c+" http://kred.com/"+b):a.is(".facebook")&&(a=encodeURIComponent("http://kred.com/@"+b),b=encodeURIComponent(c),a=["http://www.facebook.com/sharer.php?s=100&p[url]=",
a,"&p[title]=",b].join(""),window.open(a,"sharer","toolbar=0,status=0,width=626,height=436"))});$(".offline_statements .off_delete").live("click",function(){$(this).closest(".tabcontent");var a=$(this).closest(".statement"),b=a.data("data");a.remove();$.ajax({url:"/ajax/?method=influence.deleteRequest",dataType:"json",type:"POST",data:{id:b.id},success:function(a){console.log("offline points deleted!")}})});$(".offline_statements .off_reject").live("click",function(){$(this).closest(".tabcontent");
var a=$(this).closest(".statement"),b=a.data("data");$(this).text("Loading...");$.ajax({url:"/ajax/?method=influence.rejectRequest",dataType:"json",type:"POST",data:{id:b.id},success:function(c){b.status="reject";b.ago=$.timeago(new Date(1E3*b.ts)).replace("mth","mo");c=$("#offline_statement").tmpl(b);c.length&&a.replaceWith(c);c.data("data",b);console.log("offline points rejected!")}})});$(".offline_statements .off_approve").live("click",function(){$(this).closest(".tabcontent");var a=$(this).closest(".statement"),
b=a.data("data");$(this).text("Loading...");$.ajax({url:"/ajax/?method=influence.approveRequest",dataType:"json",type:"POST",data:{id:b.id},success:function(c){b.status="assigned";b.ago=$.timeago(new Date(1E3*b.ts)).replace("mth","mo");c=$("#offline_statement").tmpl(b);c.length&&a.replaceWith(c);c.data("data",b);console.log("offline points approved!")}});var c=a.find(".gained_points").text().replace(/[^0-9]+/g,""),d=a.find(".stat_desc").text().replace(/  /g," ");Banner.openPostbox("I've just received "+
c+" Offline #Kred points for "+d)});$(".offline_points_form").live("submit",function(){var a=$(this);if(a.data("submitting"))return!1;a.find(".offline-ufile-button");a.data("submitting",!0);a.find(':input[name="points_to_claim"]').val();var b=a.find(':input[name="username"]').val(),c=a.find('select[name="off_community"] :selected').text();a.find('[name="name_of_certificate"]').val();var d="I requested Offline @Kred for "+b+" in the "+c+" Community for their achievement. Share one of your own  at Kred.com/#offline";
b==="@"+logged_usr.active.foreign_uid&&(d="I requested Offline @Kred in the "+c+" Community for my achievement. Share one of your own at Kred.com/#offline");Banner.openPostbox(d);_gaq.push(["_trackEvent","Kred - offline","submit",d]);a.parent().find("iframe").load(function(){a.data("submitting",!1)})});$(".box-foot .ajaxTab").click(function(){var a=$(this).attr("tabname");c.loadAjaxTab(a);return!1});$(".statement .object").live("click",function(){"Anonymous"===$(this).text()&&(window.location="http://kred.com/privacy")});
$(".starprompt").live("mouseover",function(){$(this).closest(".tabcontent").find(".switcher .starvoting").trigger("mouseover")});$(".whoelse").live("click",function(){$('a[tabname="activity"]').trigger("click");$("#kred-notifications .close").trigger("click")})},showAvailableSubtabs:function(b){var a=[];switch(b){case "facebook":a=["friends","ranking","analyze"];$(".friends-activity-tab").hide();break;default:$(".friends-activity-tab").show()}$("#infl_header li").show();$.each(a,function(a,b){$("#infl_header a[tabname="+
b+"]").closest("li").hide()})},init_game:function(){},getLoadHash:function(){var b=window.location.hash.replace("#","").replace(/community\/.*/,"community"),a=this.hash_to_filename(b),c=null;$("#infl_header li a").each(function(){if($(this).attr("tabname")===a)return c=a,!1});return c},loadAjaxTab:function(b,a){var c=this;$("#infl_header li").removeClass("active");$("#infl_header li a[tabname="+b+"]").closest("li").addClass("active");c.subpage=b;$("#inside-container-wrapper #subtab").html("<center><br/><br/>Loading...</center>");
$.ajax({url:"/ajax/?method=influence.getSubpage",dataType:"text",type:"GET",data:{subpage:b},success:function(b){$("#inside-container-wrapper #subtab").html("<div>"+b+"</div>");window.scrollTo(0,0);c.init_tabs();a&&c.search(a)}})},wrapper:function(b){function a(b){"function"===typeof b.contents&&$.each(b.contents(),function(){if(1!=this.nodeType){var b=this.data;c.test(b)&&$(this).replaceWith("<span>"+b.replace(c,f)+"</span>")}else a($(this))})}var c=/(^|\s)@(\w+)/g,f='<span class="uid">$&</span>';
a(b)},getRealtimeTransactions:function(b,a){var c=this;$(".statements",a).data("realtime",1);setInterval(function(){var f=$(".statements",a),g=f.data("most_recent_ts")+1,d=parseInt((new Date).getTime()/1E3);f.data("realtime")&&$(a).is(".active")&&g&&c.getTransactions(b,a,g,d,null,!0)},3E4)},getMoreTransactions:function(b){b=$(b).closest(".tabcontent");var a=b.attr("uid"),c=$(".statements",b).data("paging")||{},f=$(".statements",b).data("paging_max_days"),f=f?parseInt(f):!1;if(1<c.first){console.log("FIRST found:",
c.first);var g=c.first,c=c.first-86400*(f||this.statement_paging_days);if(this.statement_start_ts){if(g<=this.statement_start_ts)return;c=Math.max(this.statement_start_ts,c)}console.log("GET MORE from "+c+" ("+$.timeago(new Date(1E3*c))+") to "+g+" ("+$.timeago(new Date(1E3*g))+")");this.getTransactions(a,b,c,g,!0)}},getTransactions:function(b,a,c,f,g,d,h){function e(a,b){a.attr("title",b).tipTip({maxWidth:"300px",delay:200,fadeIn:500,fadeOut:500,defaultPosition:"top"})}var m=this;void 0===a&&(a=
$(".tabcontent.active"));!g&&!d?$(".statements",a).html("<p>Loading...</p>"):$(".getMoreTrans",a).text("Loading...");var k={};k.last=f?f:this.statement_end_ts?this.statement_end_ts:Math.round(Date.getServerTime()/1E3);k.first=c?c:k.last-86400*m.statement_paging_days;d||$(".statements",a).data("paging",k);d||(k.last_running_inf=$(".statements",a).data("last_running_inf"),k.last_running_out=$(".statements",a).data("last_running_out"));var n=!0;h&&(k.cid=h,n=!1);console.log((d?"RealTime ":"")+"getTransactions for "+
b+" from "+k.first+" ("+$.timeago(new Date(1E3*k.first))+") to "+k.last+" ("+$.timeago(new Date(1E3*k.last))+")");c=$.ajax({url:"/ajax/?method=influence.getTransactions&username="+escape(b),dataType:"json",data:k,success:function(c){!g&&!d?$(".statements",a).empty():$(".getMoreTrans",a).remove();d||c.reverse();$(".statements",a).find(".section_title").remove().end().prepend('<div class="statement section_title sources">Twitter Transactions</div>');var f=$(".section_title.sources",a),h=$(".statements",
a).data("most_recent_ts")||0,r=$(".statements",a).data("comms");r||(r=[]);var l=$(".commsSelector li.selected",a).attr("comm_id")||0,l=parseInt(l),v=0;l&&(v=$(".comm_"+l,a).length);var w=[],t=$("#statement");parseInt((new Date).getTime()/1E3);$.each(c,function(b,c){if("@MISSING"===c.othername)return"carry on";f&&"fb"===c.source&&(f.html("Twitter &amp; Facebook Transactions"),f=null);h<c.ts&&(h=c.ts);c.show_tweet&&""===c.post&&w.push(c.msgid);"Anonymous"===c.othername&&(c.post="");c.ago=$.timeago(new Date(1E3*
c.ts)).replace("mth","mo");c.tweeter="error";if(c.description){var g=c.description.match(/@\w+/);g&&g.length&&(c.tweeter=g[0])}else c.description="";c.description=c.description.replace(/[:()]/g,"").replace(/(@\w+)[^ <]*/g,"$1").replace(/(@(\w+))/g,'<a class="twitter_uid" target="_blank" href="http://twitter.com/$2"><span class="kredible">@$2<span class="shield"></span></span></a>');c.myname&&(c.myname=c.myname.replace(/[:()]/g,""));c.classes="";if(c.comm){var k;$.each(c.comm,function(a,b){k=!1;$.each(r,
function(a,c){c.id==b&&(k=!0,c.tot+=1)});k||r.push({tot:1,id:b});c.classes+=" comm_"+b})}10<c.s&&(c.classes+=" significant");-1<Influence.leadernames.indexOf(c.tweeter.replace(/@/,"").toLowerCase())&&(c.classes+=" leader");g=t.tmpl(c).data("transaction",c);c.post&&e(g,c.post);g.length?d?g.prependTo($(".statements",a)):g.appendTo($(".statements",a)):console.log("Templating fail for transaction",c);g.find(".flag_influence_levelup").attr("title","Influence score increased").tipTip();g.find(".flag_outreach_levelup").attr("title",
"Outreach level increased").tipTip()});m.updateTransCommSelector(a,r);$(".statements",a).data("comms",r);$(".statements",a).data("most_recent_ts",h);!d&&c.length&&(k.first=c[c.length-1].ts-1,$(".statements",a).data("paging",k),$(".statements",a).data("last_running_inf",c[c.length-1].running_inf),$(".statements",a).data("last_running_out",c[c.length-1].running_out),console.log("last post found for "+b+": ",c[c.length-1]));m.updateStatementsTs(a);w.length&&m.getTweets(b,w,function(b){b&&$.each(b,function(b,
c){var d=$(".statement[data-msgid="+b+"]",a);d.find(".tweet").text(c);e(d,c)})});var x=$('<div class="getMoreTrans">More</div>');x.appendTo($(".statements",a));if(0<l){var y=$(".comm_"+l,a).length;x.text(c.length+" new entries, "+(y-v)+' in community "'+m.comms_info[l].name+'" - Get More')}!d&&(10>=c.length&&n)&&(1!=k.first&&k.first<parseInt((new Date).getTime()/1E3)-15552E3?((!c||0===c.length)&&0===$(".statement",a).length&&$(".statements",a).html('<p class="no-statements">There is no Twitter activity in the last several months for @'+
b+"</p>"),$('#infl_header .active [tabname="overview"]').length&&(c=$('<div class="inactive_holder"><div class="inactive_notice"><a class="kill" href="#">&times;</a>There is no Twitter activity in the last several months for @'+b+"</div></div>"),a.closest(".tabcontent").append(c),$(".inactive_notice a.kill").click(function(){$(".inactive_holder:visible").fadeOut(function(){$(this).remove()})}))):m.getMoreTransactions(a))},error:function(a){console.log("Error receiving transactions for",b,a)}});m.ajaxRequests.act_statement.push(c);
return c},updateTransCommSelector:function(b,a){function c(a,b){return a.tot-b.tot}var f=this;if(f.comms_info){a.sort(c);a.reverse();var g='<li comm_id="0">Global Kred</li>';$.each(a,function(a,b){0<b.tot&&f.comms_info[b.id]&&(g+='<li comm_id="'+b.id+'">'+f.comms_info[b.id].name+"</li>")});$(".commsSelector li",b).attr("comm_id");$(".commsSelector ul",b).empty().append(g).hide()}},getOfflineTransactions:function(b,a){void 0===a&&(a=$(".tabcontent.active"));this.ajaxRequests.offline.push($.ajax({url:"/ajax/?method=influence.getOfflineTransactions&username="+
escape(b),dataType:"json",success:function(c){function f(b){$(".offline_statements",a).show();b.ago=$.timeago(new Date(1E3*b.ts)).replace("mth","mo");var c=$("#offline_statement").tmpl(b);c.length&&c.appendTo($(".offline_statements",a)).find(".stat_desc").tipTip();c.data("data",b)}var g=0;window.active_account&&b.toLowerCase()==window.active_account.foreign_uid.toLowerCase()&&(g=1);$.each(c,function(a,b){b.isYours=g;b.isFromYou=parseInt(b.owner)==logged_usr.id;b.community=b.community?"Community: "+
b.community:'<a href="/more#offline">Offline Kred</a>';g&&!b.isFromYou?-1<$.inArray(b.status,["assigned","pending","rejected"])&&f(b):-1<$.inArray(b.status,["assigned"])&&f(b)})},error:function(a){console.log("Error receiving transactions for",b,a)}}))},getFriendsTransactions:function(b,a,c){var f=this;void 0===b&&(b=$(".tabcontent.active"));var g={};$(".statements",b).html("<p>Loading...</p>");$(".statements",b).data("paging",g);f.ajaxRequests.friends_act_statement.push($.ajax({url:"/ajax/?method=influence.getFriendsTransactions&username="+
escape(a),dataType:"json",data:g,success:function(c){$(".statements",b).empty();if(c){var h=[];$.each(c,function(a,c){h.push(c.msgid);c.ago=$.timeago(new Date(1E3*c.ts)).replace("mth","mo");switch(c.event){case "rt":c.event="retweeted";break;case "mention":c.event="mentioned";break;case "reply":c.event="replied";break;case "tag":case "link":c=null}c&&"undefined"===typeof c.dir&&(c=null);if(c&&("dir"in c&&"in"===c.dir&&!c.from_name||"out"===c.dir&&!c.to_name))console.log("BAD DATA",c),c=null;if(c){var d=
$("#friend_statement").tmpl(c).data("transaction",c);d.length&&d.appendTo($(".statements",b))}});c.length&&(g.first=c[c.length-1].ts);$(".statements",b).data("paging",g);console.log("keep paging from: ",g.first);f.updateStatementsTs(b)}0===$(".statements .statement",b).length&&$('<p class="sorry">We are fetching @'+a+"'s friends list. This may take up to 30 minutes.</p>").appendTo($(".statements",b))},error:function(b){console.log("Error receiving transactions for",a,b)}}))},getTweets:function(b,
a,c){this.ajaxRequests.act_statement.push($.ajax({url:"/ajax/?method=influence.bulklookups",dataType:"json",type:"POST",data:{username:b,ids:a.join(",")},success:c,error:function(a){console.log("Error loading the tweets for",b)}}))},getVoteTransactions:function(b,a){void 0===a&&(a=$(".tabcontent.active"));this.ajaxRequests.offline.push($.ajax({url:"/ajax/?method=influence.getVotesTransactions&username="+escape(b),dataType:"json",success:function(c){c&&c.length&&$(".vote_statements",a).show();$(".vote_statements",
a).empty();var f=0;window.active_account&&b==window.active_account.foreign_uid&&(f=1);c&&$.each(c,function(c,d){d.isYours=f;try{if(d.name&&(d.community||(d.community="Global Kred"),d.ago=$.timeago(new Date(1E3*d.ts)).replace("mth","mo"),d.subject=b,d.points=[30,40,50,60,70][~~d.vote-1],d.points)){console.log("vote:",d);var h=$("#vote_statement").tmpl(d);h.length&&h.appendTo($(".vote_statements",a))}}catch(e){console.log("jQuery tmpl() has cacked itself again with",d)}})},error:function(a){console.log("Error receiving vote transactions for",
b,a)}}))},getPlusTransactions:function(b,a){void 0===a&&(a=$(".tabcontent.active"));$(".statement.doublelove .plus_community a").die("mouseenter").live("mouseenter",function(){var a=$('<span class="hearts">&#x2665;</span>').appendTo("body");a.css({position:"absolute",color:"#900",right:20+80*Math.random()+"%",top:50*Math.random()+"%"}).animate({"font-size":"3000%",opacity:0},function(){a.remove()})});this.ajaxRequests.offline.push($.ajax({url:"/ajax/?method=influence.getPlusTransactions",data:{username:b,
start_ts:this.statement_start_ts,end_ts:this.statement_end_ts},dataType:"json",success:function(c){c&&c.length&&$(".plus_statements",a).show();$(".plus_statements",a).find("> *:not(.section_title)").remove();var f=0;window.active_account&&b.toLowerCase()==window.active_account.foreign_uid.toLowerCase()&&(f=1);"array"==$.type(c)&&$.each(c,function(c,d){d.isYours=f;try{if(d.name&&(d.points_inf||d.points_out)){d.fromMe=!1;d.toMe=!1;-1<Influence.leadernames.indexOf(d.name.replace(/@/,"").toLowerCase())&&
(d.classes="leader");d.community||(d.community="Global");d.doublelove="klout"==d.source&&140==d.points_inf?!0:!1;d.ago=$.timeago(new Date(1E3*d.ts)).replace("mth","mo");d.subject=b;window.active_account&&window.active_account.foreign_uid.toLowerCase()===d.name.toLowerCase()&&(d.fromMe=!0);window.active_account&&window.active_account.foreign_uid.toLowerCase()===d.subject.toLowerCase()&&(d.toMe=!0);d.points=70;var h=$("#plus_statement").tmpl(d);h.length&&h.appendTo($(".plus_statements",a))}}catch(e){console.log("jQuery tmpl() has cacked itself again with",
d,e)}})},error:function(a){console.log("Error receiving plus transactions for",b,a)}}))},getCommunities:function(b,a,c){this.ajaxRequests.communities.push($.ajax({url:"/ajax/?method=influence.getCommunities",dataType:"json",type:"POST",data:{username:b,limit:a},success:c,error:function(a){console.log("Error loading the communities for",b)}}))},getOutreachers:function(b,a){this.ajaxRequests.generic.push($.ajax({url:"/ajax/?method=influence.getOutreachers",dataType:"json",type:"POST",data:{username:b},
success:a,error:function(a){console.log("Error loading outreachers for",b)}}))},getTopCommInfluencers:function(b,a){this.ajaxRequests.generic.push($.ajax({url:"/ajax/?method=influence.getTopCommInfluencers",dataType:"json",type:"POST",data:{comm_id:b},success:a,error:function(a){console.log("Error loading top influencers for community ID",b)}}))},getTopCommOutreachers:function(b,a){this.ajaxRequests.generic.push($.ajax({url:"/ajax/?method=influence.getTopCommOutreachers",dataType:"json",type:"POST",
data:{comm_id:b},success:a,error:function(a){console.log("Error loading top outreachers for community ID",b)}}))},getCommunityTransactions:function(b,a){this.ajaxRequests.generic.push($.ajax({url:"/ajax/?method=influence.getCommsTransactions",dataType:"json",type:"POST",data:{cids:b},success:a,error:function(a){console.log("Error loading community transactions for community ID(s)",b)}}))},getTopPlusUsers:function(b,a){this.ajaxRequests.generic.push($.ajax({url:"/ajax/?method=influence.getTopPlus",
dataType:"json",type:"POST",data:{comm_id:b,limit:4},success:a,error:function(a){console.log("Error loading top +Kredders for community ID",b)}}))},getRandomUsersByComm:function(b,a){this.ajaxRequests.generic.push($.ajax({url:"/ajax/?method=influence.getRandomUsers",dataType:"json",type:"POST",data:{comm_id:b,limit:2,min:500},success:a,error:function(a){console.log("Error loading random users for community ID",b)}}))},getWordCloud:function(b,a){me.ajaxRequests.generic.push($.ajax({url:"/ajax/?method=influence.getWordCloud",
dataType:"json",type:"POST",data:{username:b},success:a,error:function(a){console.log("Error loading influencers for",b)}}))},getInfluencers:function(b,a){this.ajaxRequests.generic.push($.ajax({url:"/ajax/?method=influence.getInfluencers",dataType:"json",type:"POST",data:{username:b},success:a,error:function(a){console.log("Error loading influencers for",b)}}))},getCommWordCloud:function(b,a){this.ajaxRequests.generic.push($.ajax({url:"/ajax/?method=influence.getCommWordCloud",dataType:"json",type:"POST",
data:{community:b},success:a,error:function(a){console.log("Error ",b)}}))},getFreshContent:function(b,a,c){this.ajaxRequests.generic.push($.ajax({url:"/ajax/?method=influence.getFreshContent"+(this.newfreshcontent?"New":""),dataType:"json",type:"POST",data:{community:a,username:b},success:c,error:function(b){console.log("Error loading the freshest content for",a)}}))},getFlags:function(b,a){b&&(b=b.toLowerCase().replace(/^@/,""),console.log("getting flags for:",b),this.ajaxRequests.generic.push($.ajax({url:"/ajax/?method=influence.getFlags",
dataType:"json",type:"POST",data:{username:b,exclude_bot:a},success:function(a){var f=$('.tabcontent[uid="'+b+'"]');a.flagged_by_you?$(".km-flags",f).addClass("flagged").find("div").text("Flagged Spam"):$(".km-flags",f).removeClass("flagged").find("div").text("")}})))},killAjaxRequests:function(b){if(b){var a=this.ajaxRequests[b];a&&($.each(a,function(a,b){b.abort()}),this.ajaxRequests[b]=[])}else for(b in this.ajaxRequests)this.killAjaxRequests(b)},hash_dict:{getmore:"more",offline:"more",community:"ranking"},
hash_to_filename:function(b){return this.hash_dict[b]?this.hash_dict[b]:b},filename_to_hash:function(b){var a=b;$.each(this.hash_dict,function(c,f){b==f&&(a=c)});return a},startTest:function(){var b=this;b.stressTest=1;$("#infl_header ul li").eq(0).find("a").click();setInterval(function(){if(b.stressTest){var a=$("#infl_header ul li.active").next();a.is(".last")?$("#infl_header ul li.first").find("a").click():a.find("a").click()}},3E4);setInterval(function(){b.stressTest&&($next_user=$("#overview-top .top-user-name.current").next(),
$next_user.is("#search-at-name")?$("#overview-top .top-user-name .tab_label").eq(0).click():$next_user.find(".tab_label").click())},7E3);setInterval(function(){if(b.stressTest){var a=$(".shield").length,a=Math.floor(Math.random()*(a-1));$(".tabcontent .shield").eq(a).click();setTimeout(function(){$("#kr-expand").click();setTimeout(function(){$("#ifr_popup #close_button").click()},1E4);var a=$("#kred-top .k_uid").text().toLowerCase();-1==$.inArray(a,b.uids)&&($(".top-user-name .close").eq(0).click(),
b.search(a))},3E3)}},6E4)},stopTest:function(){this.stressTest=0}};
$(document).ready(function(){$("#give-more-icon, #gift-kred").click(function(){$("#gift-form-wrapper").append($("#gift-form"));$("#gift-form").show()});$("span#community-selected, #drp-down, span#drp-down-btn").click(function(){$("ul#comm-list").show()});$("ul#comm-list li").click(function(){var b=$(this).text();$("#community-selected").html(b);$("ul#comm-list").hide()});$("#another-name").focus(function(){"Search another @name"==$(this).val()&&$(this).val("")});$("#another-name").blur(function(){""==
$(this).val()&&$(this).val("Search another @name")});$("#close-gift-form").click(function(){$("#gift-form").fadeOut("slow")})});$(function(){$("#another-name").focus(function(){$(this).val("")});$("#another-name").focus(function(){""==$(this).value&&($(this).value=val)});$("#another-name").focus(function(){"Search another @name"==$(this).val()&&$(this).val("")});$("#another-name").blur(function(){""==$(this).val()&&$(this).val("Search another @name")});$("#see-more").click(function(){alert("this is test")})});
$(function(){$("#another-name").focus(function(){$(this).val("")});$("#another-name").focus(function(){""==$(this).value&&($(this).value=val)});$("#kr-atname").focus(function(){""==$(this).value&&($(this).value=val)});$("#kr-atname").focus(function(){"@name"==$(this).val()&&$(this).val("")});$("#kr-atname").blur(function(){""==$(this).val()&&$(this).val("@name")})});$(function(){$("#see-more").click(function(){$("#comm-leader").toggleClass("show-all")});$(window).bind("beforeunload",function(b){$("body").empty()})});
$(document).ready(function(){function b(){$("#generaldarkness").hide();$(".viralcomms:visible").hide().remove();return!1}"undefined"!=typeof $("#another-name").autocomplete&&$("#another-name").autocomplete({minLength:3,appendTo:"#txt-container form",source:function(a,b){$.ajax({url:"/ajax/?method=utility.autocomplete",data:{term:a.term},dataType:"json",success:function(a){b($.map(a.data,function(a){return{label:a,value:a}}))}})}});$(".badgecommselection > a").live("click",function(){$(".usr-det-kr ul.communities").css("display",
"none!important");$("#generaldarkness").length||$('<div id="generaldarkness" />').appendTo("body");$(this).closest(".influence-outreach").find(".viralcomms").clone(!0).appendTo("body").show();$("#generaldarkness").show()});$(".viralcomms .kr-pop-close").live("click",b);$(".viralcomms .showmore").live("click",function(){var a=$(this);a.closest(".viralcomms").find(".extra").toggle();a.text().match(/more/)?a.html("Show less &laquo;"):a.html("Show more &raquo;")});$(".viralcomms td div.share").live("click",
function(){var a=$(this),c=a.closest("tr"),f=a.closest(".viralcomms").find(".uid").text().replace(/@/,""),g=c.find(".community .name").text().replace(/\s?community/i,""),d=c.find(".scores").text().split("/"),h=$.trim(d[0]),d=$.trim(d[1]);if("undefined"!=typeof c.data("influencerscores"))var e=f.toLowerCase()===window.logged_usr.active.foreign_uid.toLowerCase()?"I have":"According to @Kred @"+f+" has",m=c.data("influencerscores").id,h=[e,"Kred Influence",h,"and an Outreach level of",d,"in the",g,"community"].join(" ");
else h=f.toLowerCase()===window.logged_usr.active.foreign_uid.toLowerCase()?"I would like to get influence in the "+g+" community, give me +Kred now":"@"+f+" needs influence in the "+g+" community, give +Kred now";c=c.data("nid");a.is(".tweet")?(b(),Banner.openPostbox(h+" http://kred.com/"+f)):a.is(".facebook")?(b(),a=encodeURIComponent("http://kred.com/@"+f),m=encodeURIComponent(h),a=["http://www.facebook.com/sharer.php?s=100&p[url]=",a,"&p[title]=",m].join(""),window.open(a,"sharer","toolbar=0,status=0,width=626,height=436")):
a.is(".pluskr")&&(a.addClass("submitted"),$.post("/ajax/?method=influence.saveCommunityPlus",{comm_id:m,numeric_id:c,source:"twitter"},function(a){a=parseInt(a);-1===a?alert("You have already given this user +Kred in this community"):1<a?(a=["I gave @",f," +Kred in ",g," community influence http://kred.com/?pkid=",a].join(""),b(),Banner.openPostbox(a)):alert("There has been a problem awarding this +kred. Please try again.")}))})});
$(document).ready(function(){function b(){window.logged_usr&&(window.logged_usr.active&&window.logged_usr.active.foreign_uid)&&!(window.logged_usr&&"twitter"!=window.logged_usr.active.source)&&($("#kred-notifications").is(":visible")||$.ajax({url:"/ajax/?method=notification.get",data:{types:"plus_kred",source:"twitter",limit:10,uid:window.logged_usr.active.foreign_uid},dataType:"json",success:function(b){if(!$("#kred-notifications").is(":visible")){var c=b.data.plus_kred;if(b&&(b.data&&c)&&0!==c.length){var d=
[];$.each(c,function(a,b){d.push(b.id)});d=d.join(",");b=c.pop();b=JSON.parse(b.data);a(b.author,b.community,d,c.length);$(".kred-notifications").fadeIn()}}}}))}function a(a,b,c,h){var e=$("#kred-notifications");h=~~h;0<h?e.find(".butwait").show().find(".count").text(1+h):e.find(".butwait").hide();if(!b||"null"===b)b="Global";a=("@"+a).replace(/@@/,"@");e.find(".whom").text(a).attr("title",a);e.find(".avatar").attr("src","http://img.tweetimag.es/i/"+a.replace(/@/g,"")+"_b");e.find(".where").text(b);
e.data("id",c)}$(".kred-notifications, #kred-notifications .close").click(function(){var a=$("#kred-notifications"),b=$("#influence-top");a.is(":visible")?(b.animate({top:0}),a.slideUp(),$(".kred-notifications").hide().find(".someone").show(),a=a.data("id"),$.get("/ajax/?method=notification.kill",{ids:a})):(a.find("#pluskred-notification-body").show(),a.find("#facebook-notification-body").hide(),b.animate({top:200}),a.slideDown(),$(".kred-notifications .someone").hide())});$("#infl_header li a").live("click",
function(){b()});$("#pluskred-notification-body .viral .yatwitter").click(function(){var a="Hooray! "+$("#pluskred-notification-body .whom").text()+" gave me +Kred in "+$("#pluskred-notification-body .where").text()+". Give +Kred to people who you feel are influential at http://Kred.com/";Banner.openPostbox(a);return!1});$("#pluskred-notification-body .viral .yafacebook").click(function(){var a="Hooray! "+$("#pluskred-notification-body .whom").text()+" gave me +Kred in "+$("#pluskred-notification-body .where").text()+
". Give +Kred to people who you feel are influential at http://Kred.com/",b=encodeURIComponent("http://kred.com/"),a=["http://www.facebook.com/sharer.php?s=100&p[url]=",b,"&p[title]=",encodeURIComponent(a),"&p[summary]=",b].join("");window.open(a,"sharer","toolbar=0,status=0,width=626,height=436");return!1});$("#facebook-notification-body .viral .yatwitter").click(function(){Banner.openPostbox("I've just added Facebook to my Kred. Add it to your Kred too at kred.com/identity");return!1});$("#facebook-notification-body .viral .yafacebook").click(function(){var a=
encodeURIComponent("http://kred.com/identity"),a=["http://www.facebook.com/sharer.php?s=100&p[url]=",a,"&p[title]=",encodeURIComponent("I've just added Facebook to my Kred. Add it to your Kred too at kred.com/identity"),"&p[summary]=",a].join("");window.open(a,"sharer","toolbar=0,status=0,width=626,height=436");return!1});var c="Microsoft Internet Explorer"==navigator.appName;document.domain===location.host&&!c&&(c=/\w+\.\w+$/.exec(location.host),document.domain=c&&c[0]||location.host)});
